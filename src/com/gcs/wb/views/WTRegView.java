/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

/*
 * WTRegView.java
 *
 * Created on 10-04-2010, 10:06:26
 */
package com.gcs.wb.views;

import com.gcs.wb.WeighBridgeApp;
import com.gcs.wb.bapi.helper.SAP2Local;
import com.gcs.wb.bapi.service.SAPService;
import com.gcs.wb.base.constant.Constants;
import com.gcs.wb.jpa.JPAConnector;
import com.gcs.wb.jpa.JReportConnector;
import com.gcs.wb.jpa.controller.WeightTicketJpaController;
import com.gcs.wb.jpa.entity.Customer;
import com.gcs.wb.jpa.entity.CustomerPK;
import com.gcs.wb.jpa.entity.OutbDel;
import com.gcs.wb.jpa.entity.OutbDelPK;
import com.gcs.wb.jpa.entity.SAPSetting;
import com.gcs.wb.jpa.entity.Vehicle;
import com.gcs.wb.jpa.entity.Vendor;
import com.gcs.wb.jpa.entity.VendorPK;
import com.gcs.wb.jpa.entity.WeightTicket;
import com.gcs.wb.jpa.entity.WeightTicketPK;
import com.gcs.wb.jpa.entity.VehicleValid;
import com.gcs.wb.jpa.entity.VehicleValidPK;
import com.gcs.wb.model.AppConfig;
import com.gcs.wb.base.util.Conversion_Exit;
import com.sap.conn.jco.JCoException;
import java.awt.Color;
import java.math.BigDecimal;
import java.sql.Connection;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.Date;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.logging.Level;
import java.util.regex.Matcher;
import javax.swing.DefaultListCellRenderer;
import javax.swing.JOptionPane;
import net.sf.jasperreports.engine.JasperFillManager;
import net.sf.jasperreports.engine.JasperPrint;
import net.sf.jasperreports.engine.data.JRTableModelDataSource;
import net.sf.jasperreports.view.JasperViewer;
import org.apache.log4j.Logger;
import org.hibersap.HibersapException;
import org.jdesktop.application.Action;
import org.jdesktop.application.Task;
import java.awt.Component;
import javax.swing.JList;
import com.gcs.wb.jpa.entity.Material;
import com.gcs.wb.jpa.entity.MaterialPK;
import com.gcs.wb.jpa.entity.OutbDetailsV2;
import com.gcs.wb.jpa.procedures.WTRegRepository;
import com.gcs.wb.jpa.repositorys.MaterialRepository;
import com.gcs.wb.jpa.repositorys.WeightTicketRepository;
import java.awt.Toolkit;
import java.awt.datatransfer.Clipboard;
import java.awt.datatransfer.StringSelection;
import javax.persistence.EntityManager;
import javax.swing.DefaultComboBoxModel;
import net.sf.jasperreports.engine.JasperCompileManager;
import net.sf.jasperreports.engine.JasperReport;

/**
 *
 * @author vunguyent
 */
public class WTRegView extends javax.swing.JInternalFrame {

    /** Creates new form WTRegView */
    public String sVendor = "";
    public String sPO = "";
    public double dKldk = 0;
    WTRegRepository wTRegRepository = new WTRegRepository();
    EntityManager entityManager = JPAConnector.getInstance();
    MaterialRepository materialRepository = new MaterialRepository();
    WeightTicketRepository weightTicketRepository = new WeightTicketRepository();
    SAPService sapService = new SAPService();

    public WTRegView(String _mode) {
        this.mode = _mode;
        initComponents();
        weightTicketList = new ArrayList<WeightTicket>();
        ListWeightTicketsTask t = new ListWeightTicketsTask(WeighBridgeApp.getApplication());
        t.execute();
        
        if (getMode().equalsIgnoreCase(Constants.WTRegView.MODE_RPT)) {
            this.setTitle("Báo cáo ngày");
        }
        cbxTimeTo.setSelectedIndex(23);
        txtRegItem.setVisible(false);
        String client = WeighBridgeApp.getApplication().getConfig().getsClient();
        String plant = WeighBridgeApp.getApplication().getConfig().getwPlant();
        List matnr = materialRepository.getListMaterial(client, plant);
        DefaultComboBoxModel result = new DefaultComboBoxModel();
        for (Object obj : matnr) {
            Object[] wt = (Object[]) obj;
            MaterialPK matPK = new MaterialPK();
            Material mat = new Material();
            matPK.setMandt(WeighBridgeApp.getApplication().getConfig().getsClient());
            matPK.setWplant(WeighBridgeApp.getApplication().getConfig().getwPlant());
            matPK.setMatnr(wt[2].toString());
            mat.setMaterialPK(matPK);
            mat.setMaktx(wt[3].toString());
            if (result.getIndexOf(mat) < 0) {
                result.addElement(mat.getMaktx());
            }
        }
        txtRegItem1.setModel(result);
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {
        bindingGroup = new org.jdesktop.beansbinding.BindingGroup();

        rbtRegCatGroup = new javax.swing.ButtonGroup();
        newWeightTicket = new com.gcs.wb.jpa.entity.WeightTicket();
        selectedRow = new com.gcs.wb.jpa.entity.WeightTicket();
        outbDel = new com.gcs.wb.jpa.entity.OutbDel();
        jTextField1 = new javax.swing.JTextField();
        buttonGroup1 = new javax.swing.ButtonGroup();
        pnFilter = new javax.swing.JPanel();
        jPanel1 = new javax.swing.JPanel();
        lblFrom = new javax.swing.JLabel();
        dpFrom = new org.jdesktop.swingx.JXDatePicker();
        lblTo = new javax.swing.JLabel();
        dpTo = new org.jdesktop.swingx.JXDatePicker();
        cbxType = new javax.swing.JComboBox();
        lblType = new javax.swing.JLabel();
        jPanel2 = new javax.swing.JPanel();
        lblState = new javax.swing.JLabel();
        rbtStateAll = new javax.swing.JRadioButton();
        rbtPosted = new javax.swing.JRadioButton();
        rbtDissolved = new javax.swing.JRadioButton();
        btnFind = new javax.swing.JButton();
        lblType1 = new javax.swing.JLabel();
        txtTaixe = new javax.swing.JTextField();
        lblType2 = new javax.swing.JLabel();
        txtNguoitao = new javax.swing.JTextField();
        lblBienSo = new javax.swing.JLabel();
        txtBienSo = new javax.swing.JTextField();
        lblGio = new javax.swing.JLabel();
        cbxTimeFrom = new javax.swing.JComboBox();
        lblGioden = new javax.swing.JLabel();
        cbxTimeTo = new javax.swing.JComboBox();
        pnWTs = new javax.swing.JScrollPane();
        tabWTs = new org.jdesktop.swingx.JXTable();
        pnPrintControl = new javax.swing.JPanel();
        btnReprint = new javax.swing.JButton();
        btnPrintRpt = new javax.swing.JButton();
        pnWTicket = new javax.swing.JPanel();
        lblDName = new javax.swing.JLabel();
        txtDName = new javax.swing.JTextField();
        lblCMNDBL = new javax.swing.JLabel();
        txtCMNDBL = new javax.swing.JTextField();
        lblLicPlate = new javax.swing.JLabel();
        txtLicPlate = new javax.swing.JTextField();
        lblTrailerPlate = new javax.swing.JLabel();
        lblRegCat = new javax.swing.JLabel();
        rbtInward = new javax.swing.JRadioButton();
        rbtOutward = new javax.swing.JRadioButton();
        lblRegItem = new javax.swing.JLabel();
        txtRegItem = new javax.swing.JTextField();
        lblRegQty = new javax.swing.JLabel();
        lblUnit = new javax.swing.JLabel();
        txfRegQty = new javax.swing.JFormattedTextField();
        lblDelNum = new javax.swing.JLabel();
        txtDelNum = new javax.swing.JTextField();
        txtSoRomooc = new javax.swing.JTextField();
        txtRegItem1 = new javax.swing.JComboBox();
        btnCheckDO = new javax.swing.JButton();
        txfRegQty1 = new javax.swing.JFormattedTextField();
        lblLicPlate1 = new javax.swing.JLabel();
        lblDName1 = new javax.swing.JLabel();
        jButton1 = new javax.swing.JButton();
        txtDName1 = new javax.swing.JTextField();
        pnControl = new javax.swing.JPanel();
        jSeparator1 = new javax.swing.JSeparator();
        btnNew = new javax.swing.JButton();
        btnClear = new javax.swing.JButton();
        btnMany = new javax.swing.JButton();
        btnSave = new javax.swing.JButton();
        jLabel1 = new javax.swing.JLabel();
        txtSodangtai = new javax.swing.JTextField();

        org.jdesktop.application.ResourceMap resourceMap = org.jdesktop.application.Application.getInstance(com.gcs.wb.WeighBridgeApp.class).getContext().getResourceMap(WTRegView.class);
        jTextField1.setText(resourceMap.getString("jTextField1.text")); // NOI18N
        jTextField1.setName("jTextField1"); // NOI18N

        setClosable(true);
        setMaximizable(true);
        setResizable(true);
        setTitle(resourceMap.getString("Form.title")); // NOI18N
        setName("Form"); // NOI18N

        pnFilter.setBorder(javax.swing.BorderFactory.createTitledBorder(resourceMap.getString("pnFilter.border.title"))); // NOI18N
        pnFilter.setMinimumSize(new java.awt.Dimension(12, 35));
        pnFilter.setName("pnFilter"); // NOI18N
        pnFilter.setPreferredSize(new java.awt.Dimension(315, 35));
        pnFilter.setLayout(new javax.swing.BoxLayout(pnFilter, javax.swing.BoxLayout.Y_AXIS));

        jPanel1.setName("jPanel1"); // NOI18N
        jPanel1.setPreferredSize(new java.awt.Dimension(300, 10));

        lblFrom.setText(resourceMap.getString("lblFrom.text")); // NOI18N
        lblFrom.setName("lblFrom"); // NOI18N

        dpFrom.setDate(Calendar.getInstance().getTime());
        dpFrom.setName("dpFrom"); // NOI18N
        dpFrom.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                dpFromActionPerformed(evt);
            }
        });

        lblTo.setText(resourceMap.getString("lblTo.text")); // NOI18N
        lblTo.setName("lblTo"); // NOI18N

        dpTo.setDate(Calendar.getInstance().getTime());
        dpTo.setName("dpTo"); // NOI18N

        cbxType.setModel(getMatsModel());
        cbxType.setName("cbxType"); // NOI18N
        cbxType.setRenderer(new DefaultListCellRenderer() {
            @Override
            public Component getListCellRendererComponent(
                JList list, Object value, int index, boolean isSelected, boolean cellHasFocus) {
                super.getListCellRendererComponent(list, value, index, isSelected, cellHasFocus);
                if (value instanceof Material) {
                    Material mat = (Material)value;
                    setText(mat.getMaktx());
                    setToolTipText(mat.getMaterialPK().getMatnr());
                }
                return this;
            }
        });

        lblType.setLabelFor(cbxType);
        lblType.setText(resourceMap.getString("lblType.text")); // NOI18N
        lblType.setName("lblType"); // NOI18N

        jPanel2.setName("jPanel2"); // NOI18N
        jPanel2.setPreferredSize(new java.awt.Dimension(612, 10));

        lblState.setText(resourceMap.getString("lblState.text")); // NOI18N
        lblState.setName("lblState"); // NOI18N

        buttonGroup1.add(rbtStateAll);
        rbtStateAll.setText(resourceMap.getString("rbtStateAll.text")); // NOI18N
        rbtStateAll.setName("rbtStateAll"); // NOI18N

        buttonGroup1.add(rbtPosted);
        rbtPosted.setText(resourceMap.getString("rbtPosted.text")); // NOI18N
        rbtPosted.setName("rbtPosted"); // NOI18N

        buttonGroup1.add(rbtDissolved);
        rbtDissolved.setText(resourceMap.getString("rbtDissolved.text")); // NOI18N
        rbtDissolved.setName("rbtDissolved"); // NOI18N

        javax.swing.ActionMap actionMap = org.jdesktop.application.Application.getInstance(com.gcs.wb.WeighBridgeApp.class).getContext().getActionMap(WTRegView.class, this);
        btnFind.setAction(actionMap.get("listWeightTickets")); // NOI18N
        btnFind.setText(resourceMap.getString("btnFind.text")); // NOI18N
        btnFind.setName("btnFind"); // NOI18N

        lblType1.setLabelFor(txtNguoitao);
        lblType1.setText(resourceMap.getString("lblType1.text")); // NOI18N
        lblType1.setName("lblType1"); // NOI18N

        txtTaixe.setName("txtTaixe"); // NOI18N

        lblType2.setLabelFor(txtNguoitao);
        lblType2.setText(resourceMap.getString("lblType2.text")); // NOI18N
        lblType2.setName("lblType2"); // NOI18N

        txtNguoitao.setText(resourceMap.getString("txtNguoitao.text")); // NOI18N
        txtNguoitao.setName("txtNguoitao"); // NOI18N

        lblBienSo.setText(resourceMap.getString("lblBienSo.text")); // NOI18N
        lblBienSo.setName("lblBienSo"); // NOI18N

        txtBienSo.setText(resourceMap.getString("txtBienSo.text")); // NOI18N
        txtBienSo.setName("txtBienSo"); // NOI18N

        lblGio.setText(resourceMap.getString("lblGio.text")); // NOI18N
        lblGio.setName("lblGio"); // NOI18N

        cbxTimeFrom.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "00", "01", "02", "03", "04", "05", "06", "07", "08", "09", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23" }));
        cbxTimeFrom.setName("cbxTimeFrom"); // NOI18N

        lblGioden.setText(resourceMap.getString("lblGioden.text")); // NOI18N
        lblGioden.setName("lblGioden"); // NOI18N

        cbxTimeTo.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "00", "01", "02", "03", "04", "05", "06", "07", "08", "09", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23" }));
        cbxTimeTo.setName("cbxTimeTo"); // NOI18N
        cbxTimeTo.addItemListener(new java.awt.event.ItemListener() {
            public void itemStateChanged(java.awt.event.ItemEvent evt) {
                cbxTimeToItemStateChanged(evt);
            }
        });

        javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
        jPanel2.setLayout(jPanel2Layout);
        jPanel2Layout.setHorizontalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addComponent(lblState)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(rbtDissolved)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(rbtPosted)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(rbtStateAll)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(lblBienSo))
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addContainerGap()
                        .addComponent(lblGio)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(cbxTimeFrom, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(18, 18, 18)
                        .addComponent(lblGioden)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(cbxTimeTo, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(lblType1)))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(txtBienSo)
                    .addComponent(txtTaixe, javax.swing.GroupLayout.DEFAULT_SIZE, 161, Short.MAX_VALUE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(lblType2)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(txtNguoitao, javax.swing.GroupLayout.PREFERRED_SIZE, 174, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btnFind, javax.swing.GroupLayout.PREFERRED_SIZE, 76, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap(74, Short.MAX_VALUE))
        );
        jPanel2Layout.setVerticalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblType1)
                    .addComponent(txtTaixe, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(lblType2)
                    .addComponent(txtNguoitao, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(lblGio)
                    .addComponent(cbxTimeFrom, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(lblGioden)
                    .addComponent(cbxTimeTo, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblBienSo)
                    .addComponent(txtBienSo, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(lblState)
                    .addComponent(rbtDissolved)
                    .addComponent(rbtPosted)
                    .addComponent(rbtStateAll)
                    .addComponent(btnFind))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        lblState.getAccessibleContext().setAccessibleParent(jPanel2);

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addComponent(lblFrom)
                        .addGap(28, 28, 28)
                        .addComponent(dpFrom, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(18, 18, 18)
                        .addComponent(lblTo)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(dpTo, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(lblType)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(cbxType, 0, 357, Short.MAX_VALUE))
                    .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, 791, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap())
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(dpFrom, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(lblTo)
                    .addComponent(dpTo, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(lblType)
                    .addComponent(cbxType, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(lblFrom))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, 65, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(20, Short.MAX_VALUE))
        );

        pnFilter.add(jPanel1);

        if(this.mode.equalsIgnoreCase(this.MODE_REG)){
            pnWTs.setBorder(javax.swing.BorderFactory.createTitledBorder(resourceMap.getString("pnWTs.border.title"))); // NOI18N
        }else if(this.mode.equalsIgnoreCase(this.MODE_RPT)){
            pnWTs.setBorder(javax.swing.BorderFactory.createTitledBorder("Kết quả")); // NOI18N
        }
        pnWTs.setName("pnWTs"); // NOI18N

        tabWTs.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {},
                {},
                {},
                {}
            },
            new String [] {

            }
        ));
        tabWTs.setEditable(false);
        tabWTs.setName("tabWTs"); // NOI18N
        tabWTs.setShowGrid(true);
        pnWTs.setViewportView(tabWTs);

        pnPrintControl.setName("pnPrintControl"); // NOI18N
        pnPrintControl.setLayout(new javax.swing.BoxLayout(pnPrintControl, javax.swing.BoxLayout.LINE_AXIS));

        btnReprint.setAction(actionMap.get("reprintRecord")); // NOI18N
        btnReprint.setText(resourceMap.getString("btnReprint.text")); // NOI18N
        btnReprint.setName("btnReprint"); // NOI18N
        pnPrintControl.add(btnReprint);
        btnReprint.setVisible(this.mode.equalsIgnoreCase(this.MODE_REG));

        btnPrintRpt.setAction(actionMap.get("printReport")); // NOI18N
        btnPrintRpt.setText(resourceMap.getString("btnPrintRpt.text")); // NOI18N
        btnPrintRpt.setName("btnPrintRpt"); // NOI18N
        pnPrintControl.add(btnPrintRpt);
        btnPrintRpt.setVisible(this.mode.equalsIgnoreCase(this.MODE_RPT));

        pnWTicket.setName("pnWTicket"); // NOI18N

        lblDName.setText(resourceMap.getString("lblDName.text")); // NOI18N
        lblDName.setName("lblDName"); // NOI18N

        txtDName.setName("txtDName"); // NOI18N

        org.jdesktop.beansbinding.Binding binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ_WRITE, newWeightTicket, org.jdesktop.beansbinding.ELProperty.create("${tenTaiXe}"), txtDName, org.jdesktop.beansbinding.BeanProperty.create("text"));
        bindingGroup.addBinding(binding);
        binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ_WRITE, this, org.jdesktop.beansbinding.ELProperty.create("${formEditable}"), txtDName, org.jdesktop.beansbinding.BeanProperty.create("enabled"));
        bindingGroup.addBinding(binding);

        txtDName.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtDNameActionPerformed(evt);
            }
        });
        txtDName.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txtDNameKeyReleased(evt);
            }
        });

        lblCMNDBL.setText(resourceMap.getString("lblCMNDBL.text")); // NOI18N
        lblCMNDBL.setName("lblCMNDBL"); // NOI18N

        txtCMNDBL.setName("txtCMNDBL"); // NOI18N

        binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ_WRITE, newWeightTicket, org.jdesktop.beansbinding.ELProperty.create("${cmndBl}"), txtCMNDBL, org.jdesktop.beansbinding.BeanProperty.create("text"));
        bindingGroup.addBinding(binding);
        binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ_WRITE, this, org.jdesktop.beansbinding.ELProperty.create("${formEditable}"), txtCMNDBL, org.jdesktop.beansbinding.BeanProperty.create("enabled"));
        bindingGroup.addBinding(binding);

        txtCMNDBL.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtCMNDBLActionPerformed(evt);
            }
        });
        txtCMNDBL.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txtCMNDBLKeyReleased(evt);
            }
        });

        lblLicPlate.setText(resourceMap.getString("lblLicPlate.text")); // NOI18N
        lblLicPlate.setName("lblLicPlate"); // NOI18N

        txtLicPlate.setName("txtLicPlate"); // NOI18N

        binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ_WRITE, newWeightTicket, org.jdesktop.beansbinding.ELProperty.create("${soXe}"), txtLicPlate, org.jdesktop.beansbinding.BeanProperty.create("text"));
        bindingGroup.addBinding(binding);
        binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ_WRITE, this, org.jdesktop.beansbinding.ELProperty.create("${formEditable}"), txtLicPlate, org.jdesktop.beansbinding.BeanProperty.create("enabled"));
        bindingGroup.addBinding(binding);

        txtLicPlate.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtLicPlateActionPerformed(evt);
            }
        });
        txtLicPlate.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txtLicPlateKeyReleased(evt);
            }
        });

        lblTrailerPlate.setText(resourceMap.getString("lblTrailerPlate.text")); // NOI18N
        lblTrailerPlate.setName("lblTrailerPlate"); // NOI18N

        lblRegCat.setText(resourceMap.getString("lblRegCat.text")); // NOI18N
        lblRegCat.setName("lblRegCat"); // NOI18N

        rbtRegCatGroup.add(rbtInward);
        rbtInward.setText(resourceMap.getString("rbtInward.text")); // NOI18N
        rbtInward.setName("rbtInward"); // NOI18N

        binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ_WRITE, this, org.jdesktop.beansbinding.ELProperty.create("${rbtEnabled}"), rbtInward, org.jdesktop.beansbinding.BeanProperty.create("enabled"));
        bindingGroup.addBinding(binding);

        rbtInward.addItemListener(new java.awt.event.ItemListener() {
            public void itemStateChanged(java.awt.event.ItemEvent evt) {
                rbtInwardItemStateChanged(evt);
            }
        });

        rbtRegCatGroup.add(rbtOutward);
        rbtOutward.setText(resourceMap.getString("rbtOutward.text")); // NOI18N
        rbtOutward.setName("rbtOutward"); // NOI18N

        binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ_WRITE, this, org.jdesktop.beansbinding.ELProperty.create("${rbtEnabled}"), rbtOutward, org.jdesktop.beansbinding.BeanProperty.create("enabled"));
        bindingGroup.addBinding(binding);

        rbtOutward.addItemListener(new java.awt.event.ItemListener() {
            public void itemStateChanged(java.awt.event.ItemEvent evt) {
                rbtOutwardItemStateChanged(evt);
            }
        });

        lblRegItem.setText(resourceMap.getString("lblRegItem.text")); // NOI18N
        lblRegItem.setName("lblRegItem"); // NOI18N

        txtRegItem.setName("txtRegItem"); // NOI18N

        binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ_WRITE, newWeightTicket, org.jdesktop.beansbinding.ELProperty.create("${regItemText}"), txtRegItem, org.jdesktop.beansbinding.BeanProperty.create("text"));
        bindingGroup.addBinding(binding);
        binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ_WRITE, this, org.jdesktop.beansbinding.ELProperty.create("${formEditable}"), txtRegItem, org.jdesktop.beansbinding.BeanProperty.create("enabled"));
        bindingGroup.addBinding(binding);

        txtRegItem.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtRegItemActionPerformed(evt);
            }
        });
        txtRegItem.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txtRegItemKeyReleased(evt);
            }
        });

        lblRegQty.setText(resourceMap.getString("lblRegQty.text")); // NOI18N
        lblRegQty.setName("lblRegQty"); // NOI18N

        lblUnit.setText(resourceMap.getString("lblUnit.text")); // NOI18N
        lblUnit.setName("lblUnit"); // NOI18N

        txfRegQty.setFormatterFactory(new javax.swing.text.DefaultFormatterFactory(new javax.swing.text.NumberFormatter()));
        txfRegQty.setName("txfRegQty"); // NOI18N

        binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ_WRITE, this, org.jdesktop.beansbinding.ELProperty.create("${formEditable}"), txfRegQty, org.jdesktop.beansbinding.BeanProperty.create("enabled"));
        bindingGroup.addBinding(binding);

        txfRegQty.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txfRegQtyActionPerformed(evt);
            }
        });
        txfRegQty.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txfRegQtyKeyReleased(evt);
            }
        });

        lblDelNum.setText(resourceMap.getString("lblDelNum.text")); // NOI18N
        lblDelNum.setName("lblDelNum"); // NOI18N

        txtDelNum.setEditable(false);
        txtDelNum.setAction(actionMap.get("checkDO")); // NOI18N
        txtDelNum.setName("txtDelNum"); // NOI18N

        binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ_WRITE, newWeightTicket, org.jdesktop.beansbinding.ELProperty.create("${delivNumb}"), txtDelNum, org.jdesktop.beansbinding.BeanProperty.create("text"));
        bindingGroup.addBinding(binding);
        binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ_WRITE, this, org.jdesktop.beansbinding.ELProperty.create("${formEditable}"), txtDelNum, org.jdesktop.beansbinding.BeanProperty.create("enabled"));
        bindingGroup.addBinding(binding);

        txtDelNum.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtDelNumActionPerformed(evt);
            }
        });
        txtDelNum.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txtDelNumKeyReleased(evt);
            }
        });

        txtSoRomooc.setName("txtSoRomooc"); // NOI18N

        binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ_WRITE, newWeightTicket, org.jdesktop.beansbinding.ELProperty.create("${soRomooc}"), txtSoRomooc, org.jdesktop.beansbinding.BeanProperty.create("text"));
        bindingGroup.addBinding(binding);
        binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ_WRITE, this, org.jdesktop.beansbinding.ELProperty.create("${formEditable}"), txtSoRomooc, org.jdesktop.beansbinding.BeanProperty.create("enabled"));
        bindingGroup.addBinding(binding);

        txtSoRomooc.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtSoRomoocActionPerformed(evt);
            }
        });
        txtSoRomooc.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txtSoRomoocKeyReleased(evt);
            }
        });

        txtRegItem1.setEditable(true);
        txtRegItem1.setModel(new javax.swing.DefaultComboBoxModel(new String[] { " " }));
        txtRegItem1.setName("txtRegItem1"); // NOI18N

        binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ_WRITE, this, org.jdesktop.beansbinding.ELProperty.create("${formEditable}"), txtRegItem1, org.jdesktop.beansbinding.BeanProperty.create("enabled"));
        bindingGroup.addBinding(binding);

        txtRegItem1.addItemListener(new java.awt.event.ItemListener() {
            public void itemStateChanged(java.awt.event.ItemEvent evt) {
                txtRegItem1ItemStateChanged(evt);
            }
        });
        txtRegItem1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtRegItem1ActionPerformed(evt);
            }
        });
        txtRegItem1.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txtRegItem1KeyReleased(evt);
            }
        });

        btnCheckDO.setAction(actionMap.get("checkDO")); // NOI18N
        btnCheckDO.setText(resourceMap.getString("btnCheckDO.text")); // NOI18N
        btnCheckDO.setName("btnCheckDO"); // NOI18N
        btnCheckDO.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnCheckDOActionPerformed(evt);
            }
        });

        txfRegQty1.setEditable(false);
        txfRegQty1.setFormatterFactory(new javax.swing.text.DefaultFormatterFactory(new javax.swing.text.NumberFormatter()));
        txfRegQty1.setName("txfRegQtyTruck"); // NOI18N
        txfRegQty1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txfRegQty1ActionPerformed(evt);
            }
        });
        txfRegQty1.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txfRegQty1KeyReleased(evt);
            }
        });

        lblLicPlate1.setText(resourceMap.getString("lblLicPlate1.text")); // NOI18N
        lblLicPlate1.setName("lblLicPlate1"); // NOI18N

        lblDName1.setText(resourceMap.getString("lblDName1.text")); // NOI18N
        lblDName1.setName("lblDName1"); // NOI18N

        jButton1.setActionCommand(resourceMap.getString("btnLoad.actionCommand")); // NOI18N
        jButton1.setLabel(resourceMap.getString("btnLoad.label")); // NOI18N
        jButton1.setName("btnLoad"); // NOI18N
        jButton1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton1ActionPerformed(evt);
            }
        });

        txtDName1.setName("txtDName1"); // NOI18N
        txtDName1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtDName1ActionPerformed(evt);
            }
        });
        txtDName1.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txtDName1KeyReleased(evt);
            }
        });

        javax.swing.GroupLayout pnWTicketLayout = new javax.swing.GroupLayout(pnWTicket);
        pnWTicket.setLayout(pnWTicketLayout);
        pnWTicketLayout.setHorizontalGroup(
            pnWTicketLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pnWTicketLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(pnWTicketLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(lblTrailerPlate)
                    .addComponent(lblLicPlate)
                    .addComponent(lblCMNDBL)
                    .addComponent(lblDName)
                    .addComponent(lblDName1))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(pnWTicketLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(txtCMNDBL, javax.swing.GroupLayout.PREFERRED_SIZE, 313, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(pnWTicketLayout.createSequentialGroup()
                        .addGroup(pnWTicketLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                            .addComponent(txtLicPlate)
                            .addComponent(txtSoRomooc, javax.swing.GroupLayout.DEFAULT_SIZE, 116, Short.MAX_VALUE))
                        .addGap(49, 49, 49)
                        .addComponent(lblLicPlate1)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(txfRegQty1, javax.swing.GroupLayout.PREFERRED_SIZE, 84, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(pnWTicketLayout.createSequentialGroup()
                        .addGroup(pnWTicketLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                            .addComponent(txtDName, javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(txtDName1, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, 218, Short.MAX_VALUE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(jButton1)))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 149, Short.MAX_VALUE)
                .addGroup(pnWTicketLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(pnWTicketLayout.createSequentialGroup()
                        .addGroup(pnWTicketLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addComponent(lblRegItem)
                            .addComponent(lblRegCat)
                            .addComponent(lblRegQty)
                            .addComponent(lblDelNum))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(pnWTicketLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(pnWTicketLayout.createSequentialGroup()
                                .addComponent(rbtInward)
                                .addGap(18, 18, 18)
                                .addComponent(rbtOutward))
                            .addComponent(txtRegItem1, 0, 197, Short.MAX_VALUE)
                            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, pnWTicketLayout.createSequentialGroup()
                                .addComponent(txtDelNum, javax.swing.GroupLayout.DEFAULT_SIZE, 117, Short.MAX_VALUE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(btnCheckDO, javax.swing.GroupLayout.PREFERRED_SIZE, 73, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(pnWTicketLayout.createSequentialGroup()
                                .addComponent(txfRegQty, javax.swing.GroupLayout.PREFERRED_SIZE, 108, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(lblUnit))))
                    .addGroup(pnWTicketLayout.createSequentialGroup()
                        .addGap(88, 88, 88)
                        .addComponent(txtRegItem, javax.swing.GroupLayout.DEFAULT_SIZE, 189, Short.MAX_VALUE)))
                .addContainerGap())
        );
        pnWTicketLayout.setVerticalGroup(
            pnWTicketLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pnWTicketLayout.createSequentialGroup()
                .addGroup(pnWTicketLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addGroup(pnWTicketLayout.createSequentialGroup()
                        .addGroup(pnWTicketLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(txtRegItem, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addGroup(pnWTicketLayout.createSequentialGroup()
                                .addGap(13, 13, 13)
                                .addComponent(lblDName1)))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 11, Short.MAX_VALUE))
                    .addGroup(pnWTicketLayout.createSequentialGroup()
                        .addContainerGap()
                        .addGroup(pnWTicketLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(txtDName1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jButton1))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)))
                .addGroup(pnWTicketLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblDName)
                    .addComponent(lblRegCat)
                    .addComponent(rbtInward)
                    .addComponent(rbtOutward)
                    .addComponent(txtDName, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(pnWTicketLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(pnWTicketLayout.createSequentialGroup()
                        .addGroup(pnWTicketLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(lblCMNDBL)
                            .addComponent(txtCMNDBL, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(pnWTicketLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(pnWTicketLayout.createSequentialGroup()
                                .addGroup(pnWTicketLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                    .addComponent(lblLicPlate)
                                    .addComponent(txtLicPlate, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addGroup(pnWTicketLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                    .addComponent(lblTrailerPlate)
                                    .addComponent(txtSoRomooc, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
                            .addGroup(pnWTicketLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                .addComponent(txfRegQty1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addComponent(lblLicPlate1, javax.swing.GroupLayout.PREFERRED_SIZE, 17, javax.swing.GroupLayout.PREFERRED_SIZE))))
                    .addGroup(pnWTicketLayout.createSequentialGroup()
                        .addGroup(pnWTicketLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(lblRegItem)
                            .addComponent(txtRegItem1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(pnWTicketLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(lblRegQty)
                            .addComponent(lblUnit)
                            .addComponent(txfRegQty, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(pnWTicketLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(lblDelNum)
                            .addComponent(txtDelNum, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(btnCheckDO)))))
        );

        pnControl.setName("pnControl"); // NOI18N
        pnControl.setLayout(new javax.swing.BoxLayout(pnControl, javax.swing.BoxLayout.LINE_AXIS));

        jSeparator1.setName("jSeparator1"); // NOI18N
        pnControl.add(jSeparator1);

        btnNew.setAction(actionMap.get("newRecord")); // NOI18N
        btnNew.setText(resourceMap.getString("btnNew.text")); // NOI18N
        btnNew.setName("btnNew"); // NOI18N

        btnClear.setAction(actionMap.get("clearForm")); // NOI18N
        btnClear.setText(resourceMap.getString("btnClear.text")); // NOI18N
        btnClear.setName("btnClear"); // NOI18N

        btnMany.setText(resourceMap.getString("btnMany.text")); // NOI18N
        btnMany.setEnabled(false);
        btnMany.setName("btnMany"); // NOI18N
        btnMany.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnManyActionPerformed(evt);
            }
        });

        btnSave.setAction(actionMap.get("saveRecord")); // NOI18N
        btnSave.setText(resourceMap.getString("btnSave.text")); // NOI18N
        btnSave.setName("btnSave"); // NOI18N
        btnSave.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnSaveActionPerformed(evt);
            }
        });

        jLabel1.setText(resourceMap.getString("jLabel1.text")); // NOI18N
        jLabel1.setName("jLabel1"); // NOI18N

        txtSodangtai.setEditable(false);
        txtSodangtai.setText(resourceMap.getString("txtSodangtai.text")); // NOI18N
        txtSodangtai.setAutoscrolls(false);
        txtSodangtai.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        txtSodangtai.setName("txtSodangtai"); // NOI18N

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(pnFilter, javax.swing.GroupLayout.DEFAULT_SIZE, 866, Short.MAX_VALUE)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(btnNew)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(btnClear)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(btnMany)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(btnSave)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jLabel1)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(txtSodangtai, javax.swing.GroupLayout.PREFERRED_SIZE, 400, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(pnControl, javax.swing.GroupLayout.DEFAULT_SIZE, 1, Short.MAX_VALUE)
                .addContainerGap())
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(pnWTs, javax.swing.GroupLayout.DEFAULT_SIZE, 842, Short.MAX_VALUE)
                .addContainerGap())
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(pnWTicket, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(pnPrintControl, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, 842, Short.MAX_VALUE))
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addComponent(pnFilter, javax.swing.GroupLayout.PREFERRED_SIZE, 141, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(pnWTs, javax.swing.GroupLayout.PREFERRED_SIZE, 232, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addComponent(pnPrintControl, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(pnWTicket, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(5, 5, 5)
                        .addComponent(pnControl, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(18, 18, 18)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(btnNew)
                            .addComponent(btnClear)
                            .addComponent(btnMany)
                            .addComponent(btnSave)
                            .addComponent(jLabel1)
                            .addComponent(txtSodangtai, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))))
                .addContainerGap(73, Short.MAX_VALUE))
        );

        pnWTicket.setVisible(this.mode.equalsIgnoreCase(this.MODE_REG));
        pnControl.setVisible(this.mode.equalsIgnoreCase(this.MODE_REG));

        bindingGroup.bind();

        pack();
    }// </editor-fold>//GEN-END:initComponents

    // <editor-fold defaultstate="collapsed" desc="Event methods">
    private void txtDNameKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtDNameKeyReleased
        //setSaveNeeded(isValidated());
}//GEN-LAST:event_txtDNameKeyReleased

    private void txtCMNDBLKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtCMNDBLKeyReleased
        //setSaveNeeded(isValidated());
}//GEN-LAST:event_txtCMNDBLKeyReleased

    private void rbtInwardItemStateChanged(java.awt.event.ItemEvent evt) {//GEN-FIRST:event_rbtInwardItemStateChanged
        setSaveNeeded(isValidated());
}//GEN-LAST:event_rbtInwardItemStateChanged

    private void rbtOutwardItemStateChanged(java.awt.event.ItemEvent evt) {//GEN-FIRST:event_rbtOutwardItemStateChanged
        setSaveNeeded(isValidated());
}//GEN-LAST:event_rbtOutwardItemStateChanged

    private void txtRegItemKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtRegItemKeyReleased
//        setSaveNeeded(isValidated());
}//GEN-LAST:event_txtRegItemKeyReleased

    private void txfRegQtyKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txfRegQtyKeyReleased
        //setSaveNeeded(isValidated());
}//GEN-LAST:event_txfRegQtyKeyReleased

    private void txtDelNumKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtDelNumKeyReleased
//        if (WeighBridgeApp.getApplication().isOfflineMode()) {
//            return;
//        } else {
//            if (txtDelNum.getText().trim() == null) {
//                return;
//            }
//            String valDO = txtDelNum.getText().trim();
//            //val = Conversion_Exit.Conv_output_num(val, 10); //+20100112#01 conversion number output
//            if (valDO.length() == 0 || (validDO && valDO.length() >= 7 && validDO && valDO.length() <= 10)) {
//                if ((evt.isControlDown() && evt.getKeyCode() == KeyEvent.VK_V) || (evt.isShiftDown() && evt.getKeyCode() == KeyEvent.VK_INSERT)) {
//                    validDO = false;
//                    lblDelNum.setForeground(Color.red);
//                } else {
//                    lblDelNum.setForeground(Color.black);
//                }
//            } else {
//                validDO = false;
//                lblDelNum.setForeground(Color.red);
//            }
//            if (valDO.length() == 0) {
//                validDO = true;
//                setRbtEnabled(true);
//            } else {
////            setRbtEnabled(false);
//            }
//            if (valDO.length() != 0) {
//                txtRegItem.setEditable(false);
//                txfRegQty.setEditable(false);
//            } else {
//                txtRegItem.setEditable(true);
//                txfRegQty.setEditable(true);
//            }
//            //setSaveNeeded(isValidated() && validDO);
////        setSaveNeeded(validDO);
//            if (validDO) {
//                setSaveNeeded(isValidated());
//            }
//        }
}//GEN-LAST:event_txtDelNumKeyReleased

    private void txtLicPlateKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtLicPlateKeyReleased
        /* if (!evt.isActionKey() && evt.getKeyCode() != KeyEvent.VK_ENTER && evt.getKeyCode() != KeyEvent.VK_ESCAPE) {
        //-{20110119#01 bo qua viec kiem tra hop le khi nhap so xe
        //setSaveNeeded(isValidated());
        //-}20110119#01 bo qua viec kiem tra hop le khi nhap so xe
        }
         * 
         */
        //   if (!evt.isActionKey() && evt.getKeyCode() != KeyEvent.VK_ENTER) 
        //      setSaveNeeded(isValidated()); 
    }//GEN-LAST:event_txtLicPlateKeyReleased

    private void txtLicPlateActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtLicPlateActionPerformed
        // TODO add your handling code here:
        setSaveNeeded(isValidated());
    }//GEN-LAST:event_txtLicPlateActionPerformed

private void txtDNameActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtDNameActionPerformed
// TODO add your handling code here:
    setSaveNeeded(isValidated());
}//GEN-LAST:event_txtDNameActionPerformed

private void txtCMNDBLActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtCMNDBLActionPerformed
// TODO add your handling code here:
    setSaveNeeded(isValidated());
}//GEN-LAST:event_txtCMNDBLActionPerformed

private void txtRegItemActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtRegItemActionPerformed
// TODO add your handling code here:
    setSaveNeeded(isValidated());
}//GEN-LAST:event_txtRegItemActionPerformed

private void txfRegQtyActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txfRegQtyActionPerformed
// TODO add your handling code here:
    setSaveNeeded(isValidated());
}//GEN-LAST:event_txfRegQtyActionPerformed

private void txtDelNumActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtDelNumActionPerformed
// TODO add your handling code here:
//    setSaveNeeded(isValidated());
}//GEN-LAST:event_txtDelNumActionPerformed

private void txtSoRomoocActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtSoRomoocActionPerformed
// TODO add your handling code here:
}//GEN-LAST:event_txtSoRomoocActionPerformed

private void txtSoRomoocKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtSoRomoocKeyReleased
// TODO add your handling code here:
}//GEN-LAST:event_txtSoRomoocKeyReleased

private void cbxTimeToItemStateChanged(java.awt.event.ItemEvent evt) {//GEN-FIRST:event_cbxTimeToItemStateChanged
// TODO add your handling code here:
    if (cbxTimeTo.getSelectedIndex() < cbxTimeFrom.getSelectedIndex()) {
        cbxTimeTo.setSelectedIndex(cbxTimeFrom.getSelectedIndex());
    }
}//GEN-LAST:event_cbxTimeToItemStateChanged

private void txtRegItem1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtRegItem1ActionPerformed
// TODO add your handling code here:

    txtRegItem.setText(txtRegItem1.getSelectedItem().toString());

    setSaveNeeded(isValidated());
}//GEN-LAST:event_txtRegItem1ActionPerformed

private void txtRegItem1ItemStateChanged(java.awt.event.ItemEvent evt) {//GEN-FIRST:event_txtRegItem1ItemStateChanged
// TODO add your handling code here:

    txtRegItem.setText(txtRegItem1.getSelectedItem().toString());
    setSaveNeeded(isValidated());
}//GEN-LAST:event_txtRegItem1ItemStateChanged

private void txtRegItem1KeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtRegItem1KeyReleased
// TODO add your handling code here:
    txtRegItem.setText(txtRegItem1.getSelectedItem().toString());
    setSaveNeeded(isValidated());
}//GEN-LAST:event_txtRegItem1KeyReleased

private void btnManyActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnManyActionPerformed
// TODO add your handling code here:
    String soDO = JOptionPane.showInputDialog(this.getRootPane(), "Nhập số Delivery Order(DO): ");
    boolean isNumber = false;
    if (soDO == null) {
        isNumber = false;
    } else if (soDO != null || !soDO.equals("")) {
        soDO = soDO.trim();
        for (int i = 0; i < soDO.length(); i++) {
            if (!Character.isDigit(soDO.charAt(i))) {
                isNumber = false;
            } else {
                isNumber = true;
            }
        }
        if (isNumber && soDO.length() >= 8 && soDO.length() <= 10) {
            if (txtDelNum.getText().equals("")) {
                txtDelNum.setText(Conversion_Exit.Conv_output_num(soDO, 10));
                
            } else {
                String inputDO = (soDO.length() == 8 ) ? Conversion_Exit.Conv_output_num(soDO, 8): Conversion_Exit.Conv_output_num(soDO, 10);
                // String inputDO2 = Conversion_Exit.Conv_output_num(soDO, 8);
                if (txtDelNum.getText().indexOf(inputDO) == -1 ) {
                    txtDelNum.setText(txtDelNum.getText() + "-" + inputDO);
                } else {
                    JOptionPane.showMessageDialog(this.getRootPane(), resourceMapMsg.getString("msg.duplicateDo"));
                }
            }
        } else {
            JOptionPane.showMessageDialog(this.getRootPane(), resourceMapMsg.getString("msg.falseDo"));
            txtDelNum.setText(""); 
        }
        
    }
}//GEN-LAST:event_btnManyActionPerformed
private boolean CheckTaiTrong( )
{
     String bsxe = "" ; 
 String bsRoomoc  ="" ; 
 String fTrongtai = ""; 
 int answer = 1 ; 
         
        WeightTicketJpaController con = new WeightTicketJpaController();
  
    txtLicPlate.setText(txtLicPlate.getText().trim().toUpperCase());
    
    if(txtSoRomooc.getText() == "" )
         txtSoRomooc.setText(""); 
    else 
        txtSoRomooc.setText(txtSoRomooc.getText().trim().toUpperCase());

    bsxe = txtLicPlate.getText() ; 
    bsRoomoc = txtSoRomooc.getText();     
    txtDName.setText(txtDName.getText().trim().toUpperCase());
    txtCMNDBL.setText(txtCMNDBL.getText().trim().toUpperCase());
    //  txtSoRomooc.setText(txtSoRomooc.getText().trim().toUpperCase());
    
    if (bsxe != "" || bsRoomoc != "" ) 
    {            
        fTrongtai = con.getRegQtyOfVehicle(bsxe, bsRoomoc); 
        txfRegQty1.setText(fTrongtai);   
        
       // if (  bCheckTrongTai(fTrongtai, txfRegQty.getText().toString() ))
            if (  Double.parseDouble( fTrongtai ) <  Double.parseDouble(txfRegQty.getText().toString())) 
             answer = iMessage(" Lưu ý ! Khối lượng hàng đăng ký vượt quá trọng tải của phương tiện. Có muốn tiếp tục thực hiện không ? ") ;        
     }
    
    return (answer <=0 )? false : true ; 
}
        
private void btnCheckDOActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnCheckDOActionPerformed
// TODO add your handling code here:
    //  txtLicPlate = 

       
    //if (!CheckTaiTrong( ) ) 
       //    return ; 

    setSaveNeeded(isValidated());
    flag_check = true;
}//GEN-LAST:event_btnCheckDOActionPerformed
private boolean bCheckTrongTai( String Trongtai, String  Kldk )         
{
   
     return ( Double.parseDouble( Trongtai ) <  Double.parseDouble (Kldk)) ? false : true ; 
      
}

private int  iMessage(String messg )        
{
     int answer = 0 ;      
     answer = JOptionPane.showConfirmDialog( this.getRootPane(),messg ,                  
                    JOptionPane.MESSAGE_PROPERTY,
                    JOptionPane.YES_NO_OPTION,
                    JOptionPane.QUESTION_MESSAGE); 
              if( answer ==  JOptionPane.NO_OPTION)
                  return answer ; 
              
              return 1 ;
}

private void btnSaveActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnSaveActionPerformed

         
   // if (!CheckTaiTrong( ) ) 
   //        return ; 
           
}//GEN-LAST:event_btnSaveActionPerformed

    private void txfRegQty1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txfRegQty1ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txfRegQty1ActionPerformed

    private void txfRegQty1KeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txfRegQty1KeyReleased
        // TODO add your handling code here:
    }//GEN-LAST:event_txfRegQty1KeyReleased

    private void txtDName1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtDName1ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txtDName1ActionPerformed

    private void txtDName1KeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtDName1KeyReleased
        // TODO add your handling code here:
    }//GEN-LAST:event_txtDName1KeyReleased

    private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton1ActionPerformed
        try {
            String pRegId = txtDName1.getText().toString().trim();
            if (pRegId == null) {
                pRegId = "";
            }
            List wts = this.wTRegRepository.getDangtaiV2(pRegId);
            if (wts != null) {
                for (Object obj : wts) {
                    Object[] wt = (Object[]) obj;
                    txtDName.setText(wt[4].toString());
                    txtCMNDBL.setText(wt[5].toString());
                    txtLicPlate.setText(wt[2].toString());
                    txtSoRomooc.setText(wt[3].toString());
                    txtDelNum.setText(wt[30].toString());
                    sPO = wt[33].toString();
                    txfRegQty.setText(wt[32].toString());
                    dKldk = Double.parseDouble(wt[32].toString());
                    if (txtDName1.getText().startsWith("N")) {
                        rbtOutward.setSelected(true);
                        txtRegItem.setText(wt[35].toString());
                    }
                    cPara.G_POSTO = sPO;
                    cPara.G_REGID = txtDName1.getText().trim();
                    cPara.G_PLANT_TRANS = wt[34].toString();
                    cPara.G_VENDOR = sVendor;
                    sVendor = wt[31].toString();
                }
            }

        } catch (Exception ex) {
            logger.error(ex.toString());

        }
         
        
    }//GEN-LAST:event_jButton1ActionPerformed

private void dpFromActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_dpFromActionPerformed
// TODO add your handling code here:
}//GEN-LAST:event_dpFromActionPerformed
    private DefaultComboBoxModel getMatsModel() {
        DefaultComboBoxModel result = new DefaultComboBoxModel();
        String client = WeighBridgeApp.getApplication().getConfig().getsClient();
        String plant = WeighBridgeApp.getApplication().getConfig().getwPlant();
        List wts = weightTicketRepository.getMatsModel(client, plant);
        MaterialPK matPK1 = new MaterialPK();
        Material mat1 = new Material();
        matPK1.setMandt(WeighBridgeApp.getApplication().getConfig().getsClient());
        matPK1.setMatnr("-2");
        mat1.setMaktx("Tất cả");
        mat1.setMaterialPK(matPK1);
        result.addElement(mat1);
        for (Object obj : wts) {
            Object[] wt = (Object[]) obj;
            MaterialPK matPK = new MaterialPK();
            Material mat = new Material();
            matPK.setMandt(WeighBridgeApp.getApplication().getConfig().getsClient());
            if (wt[0] == null) {
                matPK.setMatnr("-1");
                mat.setMaktx("Linh tinh");
            } else {
                matPK.setMatnr(wt[0].toString());
                mat.setMaktx(wt[1].toString());
            }
            mat.setMaterialPK(matPK);
            if (result.getIndexOf(mat) < 0) {
                result.addElement(mat);
            }
        }

        return result;
    }

    @Action(block = Task.BlockingScope.ACTION)
    public Task listWeightTickets() {
                
        return new ListWeightTicketsTask(WeighBridgeApp.getApplication());
    }

    @Action(block = Task.BlockingScope.ACTION)
    public Task reprintRecord() {
        if (tabWTs.getSelectedRow() == -1) {
            return null;
        } else {
            return new ReprintRecordTask(WeighBridgeApp.getApplication());
        }
    }

    @Action(block = Task.BlockingScope.ACTION)
    public Task printReport() {
        if (tabWTs.getModel().getRowCount() == 0) {
            return null;
        } else {
            return new PrintReportTask(org.jdesktop.application.Application.getInstance(com.gcs.wb.WeighBridgeApp.class));
        }
    }

    @Action(block = Task.BlockingScope.ACTION)
    public Task checkDO() {

        // upper & trim  -- tuanna add 28.11.fc2012 
        txtLicPlate.setText(txtLicPlate.getText().trim().toUpperCase());
        txtDName.setText(txtDName.getText().trim().toUpperCase());
        txtCMNDBL.setText(txtCMNDBL.getText().trim().toUpperCase());
        // End add  
        
        // Fix bug đơn hàng sai mã vật tư - 01/04/2013 
          
        // end fix
        

        if (WeighBridgeApp.getApplication().isOfflineMode()) {
            return new CheckDOOFFTask(WeighBridgeApp.getApplication());
            //setSaveNeeded(isValidated() && validDO);
            //return null;
        } else {
            String val[] = txtDelNum.getText().trim().split("-");
            for (int i = 0; i < val.length; i++) {
                if (val[i].length() > 0) {
                    //+20100106 convert DO number to SAP format
                    val[i] = Conversion_Exit.Conv_output_num(val[i], 10);
                    //+20100106 convert DO number to SAP format
                    return new CheckDOTask(WeighBridgeApp.getApplication());
                } else if (val[i].length() == 0) {
                    lblDelNum.setForeground(Color.black);
                    validDO = true;
                    setSaveNeeded(isValidated() && validDO);
                    return null;
                } else {
                    lblDelNum.setForeground(Color.red);
                    validDO = false;
                    setSaveNeeded(isValidated() && validDO);
                }
                continue;
            }
            return null;
        }
    }

    @Action(enabledProperty = "creatable")
    public void newRecord() {
        setFormEditable(true);
        setRbtEnabled(true);
        setCreatable(false);
        setClearable(true);
        setSaveNeeded(isValidated());
        txtSodangtai.setText("");
        //txtRegId.setText("");
        txtRegItem.setEditable(true);
        txtRegItem1.setEditable(true);
        txfRegQty.setEditable(true);
        btnMany.setEnabled(true);
        btnCheckDO.setEnabled(true);
        btnSave.setEnabled(false);
        jButton1.setEnabled(true); 
        // Nha may FICO Hiep Phuoc only 
       if( WeighBridgeApp.getApplication().getConfig().getwPlant().contentEquals("1411"))
       {
        rbtOutward.setSelected(true);
        rbtInward.setEnabled(false); 
       }
        
        
        
    }

    @Action(enabledProperty = "clearable")
    public void clearForm() {
        cleanData();
        setCreatable(true);
        setFormEditable(false);
        setRbtEnabled(false);
        setSaveNeeded(false);
        setClearable(false);
//        txtSodangtai.setText("");
        btnMany.setEnabled(false);
        btnCheckDO.setEnabled(false);
        sVendor = ""; 
        sPO = "";
        dKldk = 0; 
        cPara.G_POSTO = ""; 
        cPara.G_REGID ="";
          
    }

    @Action(enabledProperty = "saveNeeded")
    public Task saveRecord() {
        //+20110119#01
        btnMany.setEnabled(false);
        btnCheckDO.setEnabled(false);
        btnSave.setEnabled(false); 
        
        if (!(isValidated() && validDO)) {
            return null;
        }
        //+20110119#01

        int answer = -1;
        if (txtDelNum.getText().trim().isEmpty() || txtDelNum.getText() == null) {
            answer = JOptionPane.showConfirmDialog(
                    this.getRootPane(),
                    "Bạn có muốn tiếp lục lưu phiếu đăng tài không có số D.O ?",
                    JOptionPane.OPTIONS_PROPERTY,
                    JOptionPane.YES_NO_OPTION,
                    JOptionPane.QUESTION_MESSAGE);
        } else {
            answer = JOptionPane.YES_OPTION;
        }
        if (answer == JOptionPane.YES_OPTION) {
            btnSave.setEnabled(false); 
            return new SaveRecordTask(WeighBridgeApp.getApplication());           
            
        } else {
            btnMany.setEnabled(true);
            btnCheckDO.setEnabled(true);
            
            btnSave.setEnabled(true);
            return null;
        }
         
    }
    // </editor-fold>
    // <editor-fold defaultstate="collapsed" desc="Task Classes">

    private class ListWeightTicketsTask extends org.jdesktop.application.Task<Object, Void> {

        ListWeightTicketsTask(org.jdesktop.application.Application app) {
            // Runs on the EDT.  Copy GUI state that
            // doInBackground() depends on from parameters
            // to ListWeightTicketsTask fields, here.
            super(app);
        }

        @SuppressWarnings("unchecked")
        @Override
        protected Object doInBackground() {
            try {
                setProgress(0, 0, 4);
                weightTicketList.clear();

                setProgress(1, 0, 4);
                setMessage(resourceMapMsg.getString("msg.getData"));
                AppConfig config = WeighBridgeApp.getApplication().getConfig();
                //Tuanna add to protected data as folowing IT security policy -- 20/05/2013         
                int days = (int)((dpTo.getDate().getTime() - dpFrom.getDate().getTime()) / (1000 * 60 * 60 * 24));               
                    Date Now = new Date();
                int days2 = (int)((Now.getTime() - dpTo.getDate().getTime()) / (1000 * 60 * 60 * 24));                
//                if ( days >1 || days2 > 1 || 1>1 )   
//                {
//                    JOptionPane.showMessageDialog(rootPane, "Thông báo ! Yêu cầu truy vấn dữ liệu vượt khoảng thời gian cho phép."  );
//                      return null; 
//                }                    
               //End add 
              
                WeightTicketJpaController conWTicket = new WeightTicketJpaController();
                //filter modified by hoangvv
                Object[] select = cbxType.getSelectedObjects();
                com.gcs.wb.jpa.entity.Material selecttext = (com.gcs.wb.jpa.entity.Material) select[0];
                SimpleDateFormat format = new SimpleDateFormat("yyyy-MM-dd");
                String fFrom = format.format(dpFrom.getDate());
                String fTo = format.format(dpTo.getDate());
                System.out.println("dpFrom : " + fFrom + " to " + fTo);

                List<WeightTicket> result = conWTicket.findByMandtWPlantDateFull(fFrom, fTo, txtNguoitao.getText().trim(), txtTaixe.getText().trim(), selecttext.getMaterialPK().getMatnr(), txtBienSo.getText().trim());;
                List<WeightTicket> data = conWTicket.findByMandtWPlantDateFull(fFrom, fTo, txtNguoitao.getText().trim(), txtTaixe.getText().trim(), selecttext.getMaterialPK().getMatnr(), txtBienSo.getText().trim());
                result = filterHours(data, cbxTimeFrom.getSelectedItem().toString(), cbxTimeTo.getSelectedItem().toString());
                if (selecttext.getMaktx().equals("Linh tinh")) {
                    data = conWTicket.findByMandtWPlantDateNull(fFrom, fTo, txtNguoitao.getText().trim(), txtTaixe.getText().trim(), txtBienSo.getText().trim());
                    result = filterHours(data, cbxTimeFrom.getSelectedItem().toString(), cbxTimeTo.getSelectedItem().toString());
                    if (rbtDissolved.isSelected()) {
                        data = conWTicket.findByMandtWPlantDateDissolvedNull(fFrom, fTo, txtNguoitao.getText().trim(), txtTaixe.getText().trim(), txtBienSo.getText().trim());
                        result = filterHours(data, cbxTimeFrom.getSelectedItem().toString(), cbxTimeTo.getSelectedItem().toString());
                    } else if (rbtPosted.isSelected()) {
                        data = conWTicket.findByMandtWPlantDatePostedNull(fFrom, fTo, txtNguoitao.getText().trim(), txtTaixe.getText().trim(), txtBienSo.getText().trim());
                        result = filterHours(data, cbxTimeFrom.getSelectedItem().toString(), cbxTimeTo.getSelectedItem().toString());
                    } else if (rbtStateAll.isSelected()) {
                        data = conWTicket.findByMandtWPlantDateAllNull(fFrom, fTo, txtNguoitao.getText().trim(), txtTaixe.getText().trim(), txtBienSo.getText().trim());
                        result = filterHours(data, cbxTimeFrom.getSelectedItem().toString(), cbxTimeTo.getSelectedItem().toString());
                    }
                } else if (selecttext.getMaktx().equals("Tất cả")) {
                    data = conWTicket.findByMandtWPlantDateNullAll(fFrom, fTo, txtNguoitao.getText().trim(), txtTaixe.getText().trim(), txtBienSo.getText().trim());
                    result = filterHours(data, cbxTimeFrom.getSelectedItem().toString(), cbxTimeTo.getSelectedItem().toString());
                    if (rbtDissolved.isSelected()) {
                        data = conWTicket.findByMandtWPlantDateDissolvedNullAll(fFrom, fTo, txtNguoitao.getText().trim(), txtTaixe.getText().trim(), txtBienSo.getText().trim());
                        result = filterHours(data, cbxTimeFrom.getSelectedItem().toString(), cbxTimeTo.getSelectedItem().toString());
                    } else if (rbtPosted.isSelected()) {
                        data = conWTicket.findByMandtWPlantDatePostedNullAll(fFrom, fTo, txtNguoitao.getText().trim(), txtTaixe.getText().trim(), txtBienSo.getText().trim());
                        result = filterHours(data, cbxTimeFrom.getSelectedItem().toString(), cbxTimeTo.getSelectedItem().toString());
                    } else if (rbtStateAll.isSelected()) {
                        data = conWTicket.findByMandtWPlantDateAllNullAll(fFrom, fTo, txtNguoitao.getText().trim(), txtTaixe.getText().trim(), txtBienSo.getText().trim());
                        result = filterHours(data, cbxTimeFrom.getSelectedItem().toString(), cbxTimeTo.getSelectedItem().toString());
                    }
                } else {
                    if (rbtDissolved.isSelected()) {
                        data = conWTicket.findByMandtWPlantDateDissolved(fFrom, fTo, txtNguoitao.getText().trim(), txtTaixe.getText().trim(), selecttext.getMaterialPK().getMatnr(), txtBienSo.getText().trim());
                        result = filterHours(data, cbxTimeFrom.getSelectedItem().toString(), cbxTimeTo.getSelectedItem().toString());
                    } else if (rbtPosted.isSelected()) {
                        data = conWTicket.findByMandtWPlantDatePosted(fFrom, fTo, txtNguoitao.getText().trim(), txtTaixe.getText().trim(), selecttext.getMaterialPK().getMatnr(), txtBienSo.getText().trim());
                        result = filterHours(data, cbxTimeFrom.getSelectedItem().toString(), cbxTimeTo.getSelectedItem().toString());
                    } else if (rbtStateAll.isSelected()) {
                        data = conWTicket.findByMandtWPlantDateAll(fFrom, fTo, txtNguoitao.getText().trim(), txtTaixe.getText().trim(), selecttext.getMaterialPK().getMatnr(), txtBienSo.getText().trim());
                        result = filterHours(data, cbxTimeFrom.getSelectedItem().toString(), cbxTimeTo.getSelectedItem().toString());
                    }
                }

                setProgress(2, 0, 4);
                setMessage(resourceMapMsg.getString("msg.handleDate"));
                weightTicketList.addAll(result);
                if (getMode().equalsIgnoreCase(Constants.WTRegView.MODE_REG)) {
                    wtData = new Object[weightTicketList.size()][wtCols.length];
                } else if (getMode().equalsIgnoreCase(Constants.WTRegView.MODE_RPT)) {
                    wtRptData = new Object[weightTicketList.size()][wtRptCols.length];

                }
                for (int i = 0; i < weightTicketList.size(); i++) {
                    WeightTicket item = weightTicketList.get(i);
                    if (getMode().equalsIgnoreCase(Constants.WTRegView.MODE_REG)) {
                        WeightTicketPK pk = item.getWeightTicketPK();
                        if (!pk.getMandt().equalsIgnoreCase(config.getsClient()) && !pk.getWPlant().equalsIgnoreCase(config.getwPlant().toString())) {
                            continue;
                        }
                        wtData[i][0] = pk.getSeqByDay();
                        wtData[i][1] = item.getTenTaiXe();
                        wtData[i][2] = item.getCmndBl();
                        wtData[i][3] = item.getSoXe();
                        wtData[i][4] = item.getSoRomooc();
                        wtData[i][5] = item.getRegCategory();
                        wtData[i][6] = item.getRegItemText();
                        wtData[i][7] = item.getRegItemQty();
                        wtData[i][8] = item.getDelivNumb();
                        wtData[i][9] = item.getCreator();
                        wtData[i][10] = item.getSeqByMonth();
                        wtData[i][11] = item.getCreateDate();
                        String hh;
                        String mm;
                        String ss;
                        hh = item.getCreateTime().substring(0, 2);
                        mm = item.getCreateTime().substring(2, 4);
                        ss = item.getCreateTime().substring(4);
                        wtData[i][12] = hh + ":" + mm + ":" + ss;
                        wtData[i][13] = item.getDissolved();
                        if (item.getPosted() == 1) {
                            wtData[i][14] = true;
                        } else {
                            wtData[i][14] = false;
                        }

                    } else if (getMode().equalsIgnoreCase(Constants.WTRegView.MODE_RPT)) {
                        WeightTicketPK pk = item.getWeightTicketPK();
                        if (!pk.getMandt().equalsIgnoreCase(config.getsClient()) && !pk.getWPlant().equalsIgnoreCase(config.getwPlant().toString())) {
                            continue;
                        }
                        String hh;
                        String mm;
                        String ss;
                        hh = item.getCreateTime().substring(0, 2);
                        mm = item.getCreateTime().substring(2, 4);
                        ss = item.getCreateTime().substring(4);
                        Calendar create_date = Calendar.getInstance();
                        create_date.setTime(item.getCreateDate());
                        create_date.set(Calendar.HOUR_OF_DAY, Integer.valueOf(hh));
                        create_date.set(Calendar.MINUTE, Integer.valueOf(mm));
                        create_date.set(Calendar.SECOND, Integer.valueOf(ss));
                        SimpleDateFormat df = new SimpleDateFormat("dd/MM/yyyy HH:mm");
                        String ct = df.format(create_date.getTime());
                        wtRptData[i][0] = i + 1;// item.getSeqByMonth();
                        wtRptData[i][1] = item.getWeightTicketPK().getSeqByDay();
                        wtRptData[i][2] = item.getTenTaiXe();
                        wtRptData[i][3] = item.getCmndBl();
                        wtRptData[i][4] = item.getSoXe();
                        wtRptData[i][5] = item.getSoRomooc();
                        wtRptData[i][6] = item.getCreator();
                        wtRptData[i][7] = ct;
                        wtRptData[i][8] = item.getRegCategory();
                        wtRptData[i][9] = item.getRegItemText();
                        if (item.getFTime() != null) {
                            Calendar cf = Calendar.getInstance();
                            cf.setTime(item.getFTime());
                            String ft = df.format(cf.getTime());
                            wtRptData[i][10] = ft;//item.getFTime();
                        } else {
                            wtRptData[i][10] = item.getFTime();
                        }
                        wtRptData[i][11] = item.getFScale() == null ? item.getFScale() : item.getFScale().doubleValue() / 1000d;
                        if (item.getSTime() != null) {
                            Calendar sf = Calendar.getInstance();
                            sf.setTime(item.getSTime());
                            String st = df.format(sf.getTime());
                            wtRptData[i][12] = st;//item.getSTime();
                        } else {
                            wtRptData[i][12] = item.getSTime();
                        }
                        wtRptData[i][13] = item.getSScale() == null ? item.getSScale() : item.getSScale().doubleValue() / 1000d;
                        wtRptData[i][14] = item.getGQty();
                        wtRptData[i][15] = item.getDelivNumb();
                        wtRptData[i][16] = item.getMatDoc();
                        wtRptData[i][17] = item.getDissolved();
                        if (item.getPosted() == 1) {
                            wtRptData[i][18] = true;
                        } else {
                            wtRptData[i][18] = false;
                        }
//                        wtRptData[i][18] = item.getPosted();
                        
                        // Tuanna 2018 07 22 set transport vendor 
                        /*
                        Vehicle v = entityManager.find(Vehicle.class, item.getSoXe());
                        if (v != null && v.getTaAbbr() != null) {
                            TransportAgent tagent = entityManager.find(TransportAgent.class, v.getTaAbbr());
                            if (tagent != null) {
                                wtRptData[i][19] = tagent.getName();
                            }
                        }
                         * 
                         */
                       
                        
                         wtRptData[i][20] = item.getEbeln();
                         wtRptData[i][19] = sVendor;  
/*
 //tuanna add 24.12.2012 to show ID Ticket on grid ;
                        int seq = item.getWeightTicketPK().getSeqByDay() ; 
                        String sseq = "" ;       
                        sseq =(seq <10 )?"00":((seq >= 10 && seq <100)?"0":"");
                        sseq += Integer.toString(seq); 
                        
                        /*
                        if (seq <10 )
                            sseq = "00" + Integer.toString(seq);
                        else if (seq >= 10 && seq <100 )
                             sseq = "0" + Integer.toString(seq); 
                        else 
                            sseq =  Integer.toString(seq);
                        */
  //                      wtRptData[i][21] = item.getWeightTicketPK().getId()+sseq;


                    }
                }
                setProgress(3, 0, 4);
                editable = new boolean[getMode().equalsIgnoreCase(Constants.WTRegView.MODE_REG) ? wtCols.length : wtRptCols.length];
                for (int i = 0; i < editable.length; i++) {
                    editable[i] = false;
                }
                setProgress(4, 0, 4);
            } catch (Exception ex) {
                failed(ex);
            }
            return null; // return your result
        }

        @Override
        protected void succeeded(Object result) {
            // Runs on the EDT.  Update the GUI based on
            // the result computed by doInBackground().
        }

        @Override
        protected void finished() {
            setMessage(resourceMapMsg.getString("msg.finished"));
            if (getMode().equalsIgnoreCase(Constants.WTRegView.MODE_REG)) {
                WeighBridgeApp.getApplication().bindJTableModel(tabWTs, wtData, wtCols, wtTypes, editable);
            } else if (getMode().equalsIgnoreCase(Constants.WTRegView.MODE_RPT)) {
                WeighBridgeApp.getApplication().bindJTableModel(tabWTs, wtRptData, wtRptCols, wtRptTypes, editable);
            }
            setCreatable(true);
            setFormEditable(false);
//            setRbtEnabled(false);
            setClearable(false);
            setSaveNeeded(false);
            clearForm();
        }

        @Override
        protected void failed(Throwable cause) {
            logger.error(null, cause);
            JOptionPane.showMessageDialog(rootPane, cause.getMessage());
        }
    }

    private class ReprintRecordTask extends org.jdesktop.application.Task<Object, Void> {

        ReprintRecordTask(org.jdesktop.application.Application app) {
            // Runs on the EDT.  Copy GUI state that
            // doInBackground() depends on from parameters
            // to ReprintRecordTask fields, here.
            super(app);
        }

        @Override
        protected Object doInBackground() {
            selectedRow = weightTicketList.get(tabWTs.convertRowIndexToModel(tabWTs.getSelectedRow()));
            if (selectedRow != null) {
                try {
                    // if (selectedRow.getDissolved() == null)
                    //  {
                    //      selectedRow.setDissolved(false);
                    // }
                    if ((selectedRow.getDissolved() == null) || (selectedRow.getDissolved() == false)) { //+20100112#01 Không cho in khi phiếu đăng tài bị hủy
                        setMessage(resourceMapMsg.getString("msg.rePrinting"));
                        txtSodangtai.setText(selectedRow.getWeightTicketPK().getId().toString()
                                + String.format("%03d", selectedRow.getWeightTicketPK().getSeqByDay())); //+20100303


                        // tuanna add -- copy ticket ID to clipboard. 28.11.2012 

                        StringSelection stringSelection = new StringSelection(txtSodangtai.getText());
                        Clipboard clipboard = Toolkit.getDefaultToolkit().getSystemClipboard();
                        clipboard.setContents(stringSelection, null);

                        // End add. 
                        printWT(selectedRow, true); 
                    } else { //+20100112#01  Không cho in khi phiếu đăng tài bị hủy
                        setMessage(resourceMapMsg.getString("msg.ticketDestroy"));
                    } //+20100112#01  Không cho in khi phiếu đăng tài bị hủy
                } catch (Exception ex) {
                    failed(ex);
                }
            }
            return null;  // return your result
        }

        @Override
        protected void failed(Throwable cause) {
            JOptionPane.showMessageDialog(rootPane, cause);
        }

        @Override
        protected void succeeded(Object result) {
            // Runs on the EDT.  Update the GUI based on
            // the result computed by doInBackground().
        }

        @Override
        protected void finished() {
            setMessage(resourceMapMsg.getString("msg.finished"));
        }
    }

    private class PrintReportTask extends org.jdesktop.application.Task<Object, Void> {

        PrintReportTask(org.jdesktop.application.Application app) {
            // Runs on the EDT.  Copy GUI state that
            // doInBackground() depends on from parameters
            // to PrintReportTask fields, here.
            super(app);
        }

        @Override
        protected Object doInBackground() {
            try {
                SimpleDateFormat format = new SimpleDateFormat("yyyy-MM-dd");
                String kFrom = format.format(dpFrom.getDate());
                String kTo = format.format(dpTo.getDate());
                System.out.println("dpFrom : " + kFrom + " to " + kTo);
                Map<String, Object> params = new HashMap<String, Object>();
                params.put("P_PNAME_RPT", WeighBridgeApp.getApplication().getSapSetting().getNameRpt());
                params.put("P_PADDRESS", WeighBridgeApp.getApplication().getSapSetting().getAddress());
                params.put("P_PPHONE", WeighBridgeApp.getApplication().getSapSetting().getPhone());
                params.put("P_PFAX", WeighBridgeApp.getApplication().getSapSetting().getFax());
                params.put("P_FROM", kFrom);
                params.put("P_TO", kTo);
                String reportName = null;
                if (WeighBridgeApp.getApplication().getConfig().getModeNormal()) {
                    reportName = "./rpt/rptBT/WTList.jasper";
                } else {
                    reportName = "./rpt/rptPQ/WTList.jasper";
                }
                JasperPrint jasperPrint = JasperFillManager.fillReport(reportName, params, new JRTableModelDataSource(tabWTs.getModel()));
                JasperViewer jv = new JasperViewer(jasperPrint, false);
                jv.setVisible(true);
            } catch (Exception ex) {
                failed(ex);
            }
            return null;  // return your result
        }

        @Override
        protected void failed(Throwable cause) {
            logger.error(null, cause);
            JOptionPane.showMessageDialog(rootPane, cause.getMessage());
        }
    }

    private class CheckDOTask extends org.jdesktop.application.Task<Object, Void> {

        private OutbDel outb = null;
        private OutbDelPK outbPK = null;
        private String mode = null;
        private Customer kunnr = null;
        private Customer kunag = null;
        private Vendor lifnr = null;
        private Customer sapKunnr = null;
        private Customer sapKunag = null;
        private Vendor sapLifnr = null;
        private String ship_point = null;

        CheckDOTask(org.jdesktop.application.Application app) {
            // Runs on the EDT.  Copy GUI state that
            // doInBackground() depends on from parameters
            // to CheckDOTask fields, here.
            super(app);
            outbDel = null;
        }

        @Override
        protected Object doInBackground() {
            String oldKunnr = "";
            String oldSoxe = "";
            String[] val = txtDelNum.getText().trim().split("-");
            for (int k = 0; k < val.length; k++) {
                setMessage(resourceMapMsg.getString("msg.checkDOInDB"));
                setProgress(1, 1, 4);
                //+20100106 convert DO number to SAP format
//            System.out.println(val);
//            System.out.println(val.length());
                val[k] = Conversion_Exit.Conv_output_num(val[k], 10);
//                System.out.println(val[k]);
                //+20100106 convert DO number to SAP format
//            System.out.println(val);
//            System.out.println(val.length());
                outbPK = new OutbDelPK(WeighBridgeApp.getApplication().getConfig().getsClient(), val[k]);
                outb = entityManager.find(OutbDel.class, outbPK);
                setMessage(resourceMapMsg.getString("checkDOInSap"));
                setProgress(2, 1, 4);
                OutbDel sapOutb = sapService.getOutboundDelivery(val[k], true);
                if (sapOutb != null) {
                    if (sapOutb.getKunnr() != null && !sapOutb.getKunnr().trim().isEmpty()) {
                        kunnr = entityManager.find(
                                Customer.class,
                                new CustomerPK(WeighBridgeApp.getApplication().getConfig().getsClient(), sapOutb.getKunnr()));
                        sapKunnr = sapService.getCustomer(sapOutb.getKunnr());
                    }
                    if (sapOutb.getKunag() != null && !sapOutb.getKunag().trim().isEmpty()) {
                        kunag = entityManager.find(
                                Customer.class,
                                new CustomerPK(WeighBridgeApp.getApplication().getConfig().getsClient(), sapOutb.getKunag()));
                        sapKunag = sapService.getCustomer(sapOutb.getKunag());
                    }
                    if (sapOutb.getLifnr() != null && !sapOutb.getLifnr().trim().isEmpty()) {
                        lifnr = entityManager.find(
                                Vendor.class,
                                new VendorPK(WeighBridgeApp.getApplication().getConfig().getsClient(), sapOutb.getLifnr()));
                        sapLifnr = sapService.getVendor(sapOutb.getLifnr());
                        // abbr = sapLifnr.getVendorPK().getLifnr();
                    }

                }
                setMessage(resourceMapMsg.getString("msg.saveDataToDb"));
                setProgress(3, 1, 4);
                if (!entityManager.getTransaction().isActive()) {
                    entityManager.getTransaction().begin();
                }
                //Store Ship to party Info
                if (sapKunnr != null && kunnr == null) {
                    entityManager.persist(sapKunnr);
                } else if (sapKunnr != null && kunnr != null) {
                    entityManager.merge(sapKunnr);
                } else if (sapKunnr == null && kunnr != null) {
                    entityManager.remove(kunnr);
                }
                //Store Sold to party Info
                if (sapKunag != null && kunag == null && !sapOutb.getKunnr().equalsIgnoreCase(sapOutb.getKunag())) {
                    entityManager.persist(sapKunag);
                } else if (sapKunag != null && kunag != null) {
                    entityManager.merge(sapKunag);
                } else if (sapKunag == null && kunag != null && !sapOutb.getKunnr().equalsIgnoreCase(sapOutb.getKunag())) {
                    entityManager.remove(kunag);
                }
                //Store Vendor Info
                if (sapLifnr != null && lifnr == null) {
                    entityManager.persist(sapLifnr);
                } else if (sapLifnr != null && lifnr != null) {
                    entityManager.merge(sapLifnr);
                } else if (sapLifnr == null && lifnr != null) {
                    entityManager.remove(lifnr);
                }
                if (sapOutb != null && outb == null) {
                    entityManager.persist(sapOutb);
                    outb = sapOutb;
                    validDO = true;
                } else if (sapOutb != null && outb != null) {
                    entityManager.merge(sapOutb);
                    outb = sapOutb;
                    validDO = true;
                } else {
                    if (outb != null) {
                        entityManager.remove(outb);
                        outb = null;
                    }
                    validDO = false;
                    String msg = "Số D.O \" " + val[k] + " \" không tồn tại!";
                    setMessage(msg);
                    JOptionPane.showMessageDialog(rootPane, msg);
                }
                entityManager.getTransaction().commit();
                entityManager.clear();
//                Check kunnr
                if (outb != null &&
                        !oldKunnr.equals("") &&
                        !oldKunnr.equals(outb.getKunnr())) {
                    validDO = false;
                    String msg = resourceMapMsg.getString("msg.notDuplicateCode");
                    setMessage(msg);
                    JOptionPane.showMessageDialog(rootPane, msg);
                } else if (outb != null) {
                    oldKunnr = outb.getKunnr();
                }
//                Check bien so xe
                if (outb != null &&
                        !oldSoxe.equals("") &&
                        !oldSoxe.equals(outb.getTraid())) {
                    validDO = false;
                    String msg = resourceMapMsg.getString("msg.notDuplicateLicensePlate");
                    setMessage(msg);
                    JOptionPane.showMessageDialog(rootPane, msg);
                } else if (outb != null) {
                    oldSoxe = outb.getTraid();
                }                                        
                
                //Set Mode
                if (validDO && outb != null) {
                    /**
                     * At this screen, if enter D.O type LF => Outward mode
                     * Otherwise, Inward mode.
                     */
                    if (outb.getLfart().equalsIgnoreCase("LF") || outb.getLfart().equalsIgnoreCase("ZTLF")) {
//                    rbtOutward.setSelected(true);
                        mode = "xuất";
                    } else {
//                    rbtInward.setSelected(true);
                        mode = "nhập";
                    }
                }
                //Check suitable plant from D.O for In/Outward mode against working plant.
                if (validDO && outb != null) {
                    String msg = null;
                    //{-20101203#01 - comment logic to check plant
                /*
                    if (((outb.getLfart().equalsIgnoreCase("LF") || outb.getLfart().equalsIgnoreCase("LR")||outb.getLfart().equalsIgnoreCase("ZTLF") || outb.getLfart().equalsIgnoreCase("ZTLR")) && (outb.getWerks() != null && !outb.getWerks().equalsIgnoreCase(WeighBridgeApp.getApplication().getConfig().getwPlant())))
                    || ((!outb.getLfart().equalsIgnoreCase("LF") && !outb.getLfart().equalsIgnoreCase("LR") && !outb.getLfart().equalsIgnoreCase("ZTLF") && !outb.getLfart().equalsIgnoreCase("ZTLR")) && (outb.getRecvPlant() != null && !outb.getRecvPlant().equalsIgnoreCase(WeighBridgeApp.getApplication().getConfig().getwPlant())))) {
                    
                    
                    msg = "D.O \" " + val + " \" không được phép dùng để " + mode
                    + " hàng trong Plant \" "
                    + WeighBridgeApp.getApplication().getConfig().getwPlant() + " \" !";
                    setMessage(msg);
                    JOptionPane.showMessageDialog(rootPane, msg);
                    validDO = false;
                    outb = null;
                    } */
                    //}-20101203#01 - comment logic to check plant
                }
                //Check if D.O was used already or not???
                if (validDO && outb != null) {
                    WeightTicket wt = null;
                    String client = WeighBridgeApp.getApplication().getConfig().getsClient();
                    String plant = WeighBridgeApp.getApplication().getConfig().getwPlant();
                    String delivNumb = outb.getOutbDelPK().getDelivNumb();
                    wt = weightTicketRepository.findByMandtWPlantDelivNumb(client, plant, delivNumb);
                    String wplant = "";
                    wplant = WeighBridgeApp.getApplication().getConfig().getwPlant().toString();
                    String sDoType = "LF,LR,NL,ZTLF,ZTLR";
                    String Lfart = "";
                    try {
                        Lfart = outb.getLfart();

                    } catch (Exception ex) {
                    }

                    if ((sDoType.indexOf(Lfart) >= 0 && outb.getWbstk() == 'X' && outb.getWerks().toString().equalsIgnoreCase(wplant))
                            || (wt != null && (wt.getDissolved() == null || wt.getDissolved() == false))) {
                        validDO = false;
                        outb = null;
                        String msg = "D.O \" " + val[k] + " \" đã được dùng để " + mode + " hàng, vui lòng tự  kiểm tra trước khi liên hệ đường dây nóng Dịch vụ khách hàng 0919 49 59 69 ";
                        setMessage(msg);
                        JOptionPane.showMessageDialog(rootPane, msg);
                    } else {
                        flag_revert = true;
                        outb_number = outb.getOutbDelPK().getDelivNumb().toString().trim();
                    }
                }
//<< 20120712#01 - check shipping point -------
                
              
                if (validDO && outb != null) {
                    // Tạm thời sử dụng đầu tây ninh
                    //ship_point = "(?i).*" + outb.getShipPoint() + "*";
                    // if (WeighBridgeApp.getApplication().getConfig().getShId().toString().matches(ship_point)){
                    //--------- Tuấn sửa ngày 050812  ------------------    
                    ship_point = outb.getShipPoint();
                    String tmpShippoint = WeighBridgeApp.getApplication().getConfig().getShId().toString(); 
                    String WbID = WeighBridgeApp.getApplication().getConfig().getWbId().toString();
                    
                    String Matname  = outb.getArktx().toUpperCase();
                   
                    String sp =  ship_point.toString(); 
                    Boolean ship =true  ;
                     //--------- Tuấn sửa ngày 04.04.2013  ------------------ 
                    //-- Checking SALE ORDER wrong material - plant 
                    
                    String mymode = "";
                    
                    if( rbtInward.isSelected()==true ) 
                        
                            mymode = "Nhập"; 
                    else 
                       if (rbtOutward.isSelected()==true) 
                            mymode = "Xuất"; 
                       else 
                           mymode = "..."; 
                    
                    if (mymode.indexOf("...")>=0)
                    {
                         String msg = resourceMapMsg.getString("msg.plzChooseIO");
                            setMessage(msg);
                            JOptionPane.showMessageDialog(rootPane, msg);
                    }
            /*       
                    if (tmpShippoint.indexOf(sp) < 0) 
                    {                        
                        ship = false ;
                    }
                    if ( Matname.indexOf("XI")>=0 ) 
                        {                               
                           if ( ((sp.equals("1208") || sp.equals("141D")) && ( Matname.indexOf("NM FICO") < 0 ) )   
                                   ||    ((sp.equals("1208") || sp.equals("141D")) && ( Matname.indexOf("NMFICO") < 0 ) )
                              || ( sp.equals("131D")  && ( Matname.indexOf("NM TN") < 0)  ) 
                              || ( sp.equals("1201")  && ( Matname.indexOf("GC DIC") < 0)  ) 
                              || ( !sp.equals("1201")  && ( Matname.indexOf("GC DIC") >= 0)  )
                              || ( sp.equals("1213")  && ( Matname.indexOf("DICBP") < 0)  )  
                              || ( ! sp.equals("1213")  && ( Matname.indexOf("DICBP") >= 0)  )
                              || ( ( sp.equals("1209") ||sp.equals("151D") ) && (  Matname.indexOf("NM TN") < 0 )   ) 
                               
                            )
                                   ship = false ; 
                                                      
                          }   
                    if (  ( sp.equals("131D") ) && (  Matname.indexOf("NM TN") >= 0 ) && ( WbID.indexOf("1511")>=0 && mode.indexOf("nh") >= 0 ) && mymode.indexOf("Nhập")>=0 && mymode.indexOf("...") < 0  )
                        ship = true; 
                    
                     if (  ( sp.equals("1213") ) && (  Matname.indexOf("DICBP") >= 0 ) )
                        ship = true; 
                    
                    if (  ( sp.equals("131D") ) && (  Matname.indexOf("NM TN") >= 0 ) && ( WbID.indexOf("1511")>=0 && mode.indexOf("nh") >= 0 ) && mymode.indexOf("Nhập")>=0 && mymode.indexOf("...") < 0  )
                        ship = true; 
                    
                  if (  ( sp.equals("131D") ) && (  Matname.indexOf("NM TN") >= 0 ) && ( WbID.indexOf("1111")>=0 && mode.indexOf("nh") >= 0 ) && mymode.indexOf("Nhập")>=0 && mymode.indexOf("...") < 0  )
                        ship = true; 
                    
                     if (mymode.indexOf("...")>=0)
                          ship = false;
                     */     
                  //Modified by Tuan Nguyen at Tafico Jsc 23/12/2014
                    
                    float fCount = 0; 
                    String pDoNumber = val[k];
                    String pWplant = WeighBridgeApp.getApplication().getConfig().getwPlant();

                    List wts1 = wTRegRepository.checkDoExist(pDoNumber, pWplant);

                    if (wts1 != null) {
                        fCount = Float.parseFloat(wts1.get(0).toString());
                    } else {
                        fCount = 2;
                    }
                    if (fCount > 0) {
                        validDO = false;
                        outb = null;
                        String msg = "D.O \" " + val[k] + " \" đã được sử dụng , vui lòng liên hệ NPP hoặc DVKH đổi mã khác. Giao dịch lỗi này của người dùng đã được hệ thống lưu nhật ký";
                        setMessage(msg);
                        JOptionPane.showMessageDialog(rootPane, msg);
                    }
                    int klmax = wTRegRepository.getSPVar(WbID, sp, outb.getMatnr().toString().trim());

                    ship = (klmax <= 0) ? false : true;
                    if (ship == false) {
                        validDO = false;
                        outb = null;
                        String msg = "D.O \" " + val[k] + " \" không được " + mymode + " hàng ở điểm nhận hàng này!, vui lòng liên hệ dịch vụ khách hàng Hotline 0919 49 59 69 để được hỗ trợ. ";
                        setMessage(msg);
                        JOptionPane.showMessageDialog(rootPane, msg);
                    }
                }
                //20121217
                if (validDO && outb != null) {
                    mat_numb = outb.getMatnr().trim();
                }
                //end 20121217
                if (validDO && outb != null) {
                    newWeightTicket.setItem(outb.getDelivItem());
                    newWeightTicket.setMatnrRef(outb.getMatnr());
                    newWeightTicket.setRegItemText(outb.getArktx());
                    newWeightTicket.setUnit(outb.getVrkme());
                    newWeightTicket.setKunnr(outb.getKunnr());
                    txtRegItem.setText(outb.getArktx());
                    txtRegItem1.setSelectedItem(outb.getArktx());
                    BigDecimal regqty = BigDecimal.ZERO;
                    List<OutbDetailsV2> detail = new ArrayList<OutbDetailsV2>();
                    OutbDetailsV2 item = null;
                    String[] do_list = txtDelNum.getText().trim().split("-");
                    for (int i = 0; i < do_list.length; i++) {
                        String doNum = do_list[i];
                        WeightTicketJpaController conWTicket = new WeightTicketJpaController();
                        try {
                            detail = conWTicket.findByMandtDelivNumb(doNum);
                        } catch (Exception ex) {
                            java.util.logging.Logger.getLogger(WTRegView.class.getName()).log(Level.SEVERE, null, ex);
                        }
                        for (int j = 0; j < detail.size(); j++) {
                            item = detail.get(j);
                            regqty = regqty.add(item.getLfimg());
                        }
                    }
                    txfRegQty.setValue(regqty.doubleValue());
                    outbDel = outb;
                }
                setProgress(4, 1, 4);
                continue;
            }
            return null;
        }

        @Override
        protected void failed(Throwable cause) {
            validDO = false;
            if (cause instanceof HibersapException && cause.getCause() instanceof JCoException) {
                cause = cause.getCause();
            }
            logger.error(null, cause);
            JOptionPane.showMessageDialog(rootPane, cause.getMessage());
        }

        @Override
        protected void finished() {
        }
    }

    private class CheckDOOFFTask extends org.jdesktop.application.Task<Object, Void> {

        private OutbDel outb = null;
        private OutbDelPK outbPK = null;
        private String mode = null;
        private Customer kunnr = null;
        private Customer kunag = null;
        private Vendor lifnr = null;
        private Customer sapKunnr = null;
        private Customer sapKunag = null;
        private Vendor sapLifnr = null;
        private String ship_point = null;

        CheckDOOFFTask(org.jdesktop.application.Application app) {
            // Runs on the EDT.  Copy GUI state that
            // doInBackground() depends on from parameters
            // to CheckDOTask fields, here.
            super(app);
            outbDel = null;
        }

        @Override
        protected Object doInBackground() {
            String oldKunnr = "";
            String oldSoxe = "";
            String[] val = txtDelNum.getText().trim().split("-");
            for (int k = 0; k < val.length; k++) {
                setMessage(resourceMapMsg.getString("msg.checkDOInDb"));
                setProgress(1, 1, 4);
                //+20100106 convert DO number to SAP format
//            System.out.println(val);
//            System.out.println(val.length());
                val[k] = Conversion_Exit.Conv_output_num(val[k], 10);
//                System.out.println(val[k]);
                //+20100106 convert DO number to SAP format
//            System.out.println(val);
//            System.out.println(val.length());
                outbPK = new OutbDelPK(WeighBridgeApp.getApplication().getConfig().getsClient(), val[k]);
                outb = entityManager.find(OutbDel.class, outbPK);
                /*HLD18
                setMessage("Kiểm tra D.O trong SAP ...");
                setProgress(2, 1, 4);
                OutbDel sapOutb = SAP2Local.getOutboundDelivery(val[k], true);
                if (sapOutb != null) {
                    if (sapOutb.getKunnr() != null && !sapOutb.getKunnr().trim().isEmpty()) {
                        kunnr = entityManager.find(
                                Customer.class,
                                new CustomerPK(WeighBridgeApp.getApplication().getConfig().getsClient(), sapOutb.getKunnr()));
                        sapKunnr = SAP2Local.getCustomer(sapOutb.getKunnr());
                    }
                    if (sapOutb.getKunag() != null && !sapOutb.getKunag().trim().isEmpty()) {
                        kunag = entityManager.find(
                                Customer.class,
                                new CustomerPK(WeighBridgeApp.getApplication().getConfig().getsClient(), sapOutb.getKunag()));
                        sapKunag = SAP2Local.getCustomer(sapOutb.getKunag());
                    }
                    if (sapOutb.getLifnr() != null && !sapOutb.getLifnr().trim().isEmpty()) {
                        lifnr = entityManager.find(
                                Vendor.class,
                                new VendorPK(WeighBridgeApp.getApplication().getConfig().getsClient(), sapOutb.getLifnr()));
                        sapLifnr = SAP2Local.getVendor(sapOutb.getLifnr());
                        // abbr = sapLifnr.getVendorPK().getLifnr();
                    }

                }
                setMessage("Lưu dữ liệu D.O xuống CSDL ...");
                setProgress(3, 1, 4);
                if (!entityManager.getTransaction().isActive()) {
                    entityManager.getTransaction().begin();
                }
                //Store Ship to party Info
                if (sapKunnr != null && kunnr == null) {
                    entityManager.persist(sapKunnr);
                } else if (sapKunnr != null && kunnr != null) {
                    entityManager.merge(sapKunnr);
                } else if (sapKunnr == null && kunnr != null) {
                    entityManager.remove(kunnr);
                }
                //Store Sold to party Info
                if (sapKunag != null && kunag == null && !sapOutb.getKunnr().equalsIgnoreCase(sapOutb.getKunag())) {
                    entityManager.persist(sapKunag);
                } else if (sapKunag != null && kunag != null) {
                    entityManager.merge(sapKunag);
                } else if (sapKunag == null && kunag != null && !sapOutb.getKunnr().equalsIgnoreCase(sapOutb.getKunag())) {
                    entityManager.remove(kunag);
                }
                //Store Vendor Info
                if (sapLifnr != null && lifnr == null) {
                    entityManager.persist(sapLifnr);
                } else if (sapLifnr != null && lifnr != null) {
                    entityManager.merge(sapLifnr);
                } else if (sapLifnr == null && lifnr != null) {
                    entityManager.remove(lifnr);
                }
                 *                 
                if (sapOutb != null && outb == null) {
                    entityManager.persist(sapOutb);
                    outb = sapOutb;
                    validDO = true;
                } else if (sapOutb != null && outb != null) {
                    entityManager.merge(sapOutb);
                    outb = sapOutb;
                    validDO = true;
                } else {
                    if (outb != null) {
                        entityManager.remove(outb);
                        outb = null;
                    }
                    validDO = false;
                    String msg = "Số D.O \" " + val[k] + " \" không tồn tại!";
                    setMessage(msg);
                    JOptionPane.showMessageDialog(rootPane, msg);
                }
                 * 
                 */
                if (outb != null) {
                    validDO = true;
                } else {                    
                    validDO = false;
                    String msg = "Số D.O \" " + val[k] + " \" không tồn tại!";
                    setMessage(msg);
                    JOptionPane.showMessageDialog(rootPane, msg);
                }
               // entityManager.getTransaction().commit();
               // entityManager.clear();
//                Check kunnr
                if (outb != null &&
                        !oldKunnr.equals("") &&
                        !oldKunnr.equals(outb.getKunnr())) {
                    validDO = false;
                    String msg = resourceMapMsg.getString("msg.notDuplicateCode");
                    setMessage(msg);
                    JOptionPane.showMessageDialog(rootPane, msg);
                } else if (outb != null) {
                    oldKunnr = outb.getKunnr();
                }
//                Check bien so xe
                if (outb != null &&
                        !oldSoxe.equals("") &&
                        !oldSoxe.equals(outb.getTraid())) {
                    validDO = false;
                    String msg = resourceMapMsg.getString("msg.notDuplicateLicensePlate");
                    setMessage(msg);
                    JOptionPane.showMessageDialog(rootPane, msg);
                } else if (outb != null) {
                    oldSoxe = outb.getTraid();
                }                                        
                
                //Set Mode
                if (validDO && outb != null) {
                    /**
                     * At this screen, if enter D.O type LF => Outward mode
                     * Otherwise, Inward mode.
                     */
                    if (outb.getLfart().equalsIgnoreCase("LF") || outb.getLfart().equalsIgnoreCase("ZTLF")) {
//                    rbtOutward.setSelected(true);
                        mode = "xuất";
                    } else {
//                    rbtInward.setSelected(true);
                        mode = "nhập";
                    }
                }
                //Check suitable plant from D.O for In/Outward mode against working plant.
                if (validDO && outb != null) {
                    String msg = null;
                    //{-20101203#01 - comment logic to check plant
                /*
                    if (((outb.getLfart().equalsIgnoreCase("LF") || outb.getLfart().equalsIgnoreCase("LR")||outb.getLfart().equalsIgnoreCase("ZTLF") || outb.getLfart().equalsIgnoreCase("ZTLR")) && (outb.getWerks() != null && !outb.getWerks().equalsIgnoreCase(WeighBridgeApp.getApplication().getConfig().getwPlant())))
                    || ((!outb.getLfart().equalsIgnoreCase("LF") && !outb.getLfart().equalsIgnoreCase("LR") && !outb.getLfart().equalsIgnoreCase("ZTLF") && !outb.getLfart().equalsIgnoreCase("ZTLR")) && (outb.getRecvPlant() != null && !outb.getRecvPlant().equalsIgnoreCase(WeighBridgeApp.getApplication().getConfig().getwPlant())))) {
                    
                    
                    msg = "D.O \" " + val + " \" không được phép dùng để " + mode
                    + " hàng trong Plant \" "
                    + WeighBridgeApp.getApplication().getConfig().getwPlant() + " \" !";
                    setMessage(msg);
                    JOptionPane.showMessageDialog(rootPane, msg);
                    validDO = false;
                    outb = null;
                    } */
                    //}-20101203#01 - comment logic to check plant
                }
                //Check if D.O was used already or not???
                if (validDO && outb != null) {
                    WeightTicket wt = null;
                    String client = WeighBridgeApp.getApplication().getConfig().getsClient();
                    String plant = WeighBridgeApp.getApplication().getConfig().getwPlant();
                    String delivNumb = outb.getOutbDelPK().getDelivNumb();
                    wt = weightTicketRepository.findByMandtWPlantDelivNumb(client, plant, delivNumb);
                    String Lfart;
                    try {
                        Lfart = outb.getLfart();

                    } catch (Exception ex) {
                    }

                    if ((wt != null && (wt.getDissolved() == null || wt.getDissolved() == false))) {
                        validDO = false;
                        outb = null;
                        String msg = "D.O \" " + val[k] + " \" đã được dùng để " + mode + " hàng, vui lòng tự  kiểm tra trước khi liên hệ đường dây nóng Dịch vụ khách hàng 0919 49 59 69 ";
                        setMessage(msg);
                        JOptionPane.showMessageDialog(rootPane, msg);
                    } else {
                        flag_revert = true;
                        outb_number = outb.getOutbDelPK().getDelivNumb().toString().trim();
                    }
                }
//<< 20120712#01 - check shipping point -------
                
              
                if (validDO && outb != null) {
                    // Tạm thời sử dụng đầu tây ninh
                    //ship_point = "(?i).*" + outb.getShipPoint() + "*";
                    // if (WeighBridgeApp.getApplication().getConfig().getShId().toString().matches(ship_point)){
                    //--------- Tuấn sửa ngày 050812  ------------------    
                    ship_point = outb.getShipPoint();
                    String tmpShippoint = WeighBridgeApp.getApplication().getConfig().getShId().toString(); 
                    String WbID = WeighBridgeApp.getApplication().getConfig().getWbId().toString();
                    
                    String Matname  = outb.getArktx().toUpperCase();
                   
                    String sp =  ship_point.toString(); 
                    Boolean ship =true  ;
                     //--------- Tuấn sửa ngày 04.04.2013  ------------------ 
                    //-- Checking SALE ORDER wrong material - plant 
                    
                    String mymode = "";
                    
                    if( rbtInward.isSelected()==true ) 
                        
                            mymode = "Nhập"; 
                    else 
                       if (rbtOutward.isSelected()==true) 
                            mymode = "Xuất"; 
                       else 
                           mymode = "..."; 
                    
                    if (mymode.indexOf("...")>=0)
                    {
                         String msg = resourceMapMsg.getString("msg.plzChooseIO");
                            setMessage(msg);
                            JOptionPane.showMessageDialog(rootPane, msg);
                    }
            /*       
                    if (tmpShippoint.indexOf(sp) < 0) 
                    {                        
                        ship = false ;
                    }
                    if ( Matname.indexOf("XI")>=0 ) 
                        {                               
                           if ( ((sp.equals("1208") || sp.equals("141D")) && ( Matname.indexOf("NM FICO") < 0 ) )   
                                   ||    ((sp.equals("1208") || sp.equals("141D")) && ( Matname.indexOf("NMFICO") < 0 ) )
                              || ( sp.equals("131D")  && ( Matname.indexOf("NM TN") < 0)  ) 
                              || ( sp.equals("1201")  && ( Matname.indexOf("GC DIC") < 0)  ) 
                              || ( !sp.equals("1201")  && ( Matname.indexOf("GC DIC") >= 0)  )
                              || ( sp.equals("1213")  && ( Matname.indexOf("DICBP") < 0)  )  
                              || ( ! sp.equals("1213")  && ( Matname.indexOf("DICBP") >= 0)  )
                              || ( ( sp.equals("1209") ||sp.equals("151D") ) && (  Matname.indexOf("NM TN") < 0 )   ) 
                               
                            )
                                   ship = false ; 
                                                      
                          }   
                    if (  ( sp.equals("131D") ) && (  Matname.indexOf("NM TN") >= 0 ) && ( WbID.indexOf("1511")>=0 && mode.indexOf("nh") >= 0 ) && mymode.indexOf("Nhập")>=0 && mymode.indexOf("...") < 0  )
                        ship = true; 
                    
                     if (  ( sp.equals("1213") ) && (  Matname.indexOf("DICBP") >= 0 ) )
                        ship = true; 
                    
                    if (  ( sp.equals("131D") ) && (  Matname.indexOf("NM TN") >= 0 ) && ( WbID.indexOf("1511")>=0 && mode.indexOf("nh") >= 0 ) && mymode.indexOf("Nhập")>=0 && mymode.indexOf("...") < 0  )
                        ship = true; 
                    
                  if (  ( sp.equals("131D") ) && (  Matname.indexOf("NM TN") >= 0 ) && ( WbID.indexOf("1111")>=0 && mode.indexOf("nh") >= 0 ) && mymode.indexOf("Nhập")>=0 && mymode.indexOf("...") < 0  )
                        ship = true; 
                    
                     if (mymode.indexOf("...")>=0)
                          ship = false;
                     */     
                  //Modified by Tuan Nguyen at Tafico Jsc 23/12/2014
                    
                    float fCount = 0;
                    String pDoNumber = val[k];
                    String pWplant = WeighBridgeApp.getApplication().getConfig().getwPlant();
                    List wts1 = wTRegRepository.checkDoExist(pDoNumber, pWplant);
                    try {
                        fCount = Float.parseFloat(wts1.get(0).toString());
                    } catch (Throwable cause) {
                        fCount = 2;
                    }

                    if (fCount > 0) {
                        validDO = false;
                        outb = null;
                        String msg = "D.O \" " + val[k] + " \" đã được sử dụng , vui lòng liên hệ NPP hoặc DVKH đổi mã khác. Giao dịch lỗi này của người dùng đã được hệ thống lưu nhật ký";
                        setMessage(msg);
                        JOptionPane.showMessageDialog(rootPane, msg);
                    }
                    int klmax = -1;
                    int temp = wTRegRepository.getSPVar(WbID, sp, outb.getMatnr().toString().trim());
                    if (temp > 0) {
                        klmax = temp;
                    }
                    ship = (klmax <= 0) ? false : true;
                    if (ship == false) {
                        validDO = false;
                        outb = null;
                        String msg = "D.O \" " + val[k] + " \" không được " + mymode + " hàng ở điểm nhận hàng này!, vui lòng liên hệ dịch vụ khách hàng Hotline 0919 49 59 69 để được hỗ trợ. ";
                        setMessage(msg);
                        JOptionPane.showMessageDialog(rootPane, msg);
                    }
                }
                
                //  -------------------------------------------->> 
                //20121217
                if (validDO && outb != null) {
                    mat_numb = outb.getMatnr().trim();
                }
                //end 20121217
                if (validDO && outb != null) {
                    newWeightTicket.setItem(outb.getDelivItem());
                    newWeightTicket.setMatnrRef(outb.getMatnr());
                    newWeightTicket.setRegItemText(outb.getArktx());
                    newWeightTicket.setUnit(outb.getVrkme());
                    newWeightTicket.setKunnr(outb.getKunnr());
                    txtRegItem.setText(outb.getArktx());
                    txtRegItem1.setSelectedItem(outb.getArktx());
                    BigDecimal regqty = BigDecimal.ZERO;
                    List<OutbDetailsV2> detail = new ArrayList<OutbDetailsV2>();
                    OutbDetailsV2 item = null;
                    String[] do_list = txtDelNum.getText().trim().split("-");
                    for (int i = 0; i < do_list.length; i++) {
                        String doNum = do_list[i];
                        WeightTicketJpaController conWTicket = new WeightTicketJpaController();
                        try {
                            detail = conWTicket.findByMandtDelivNumb(doNum);
                        } catch (Exception ex) {
                            java.util.logging.Logger.getLogger(WTRegView.class.getName()).log(Level.SEVERE, null, ex);
                        }
                        for (int j = 0; j < detail.size(); j++) {
                            item = detail.get(j);
                            regqty = regqty.add(item.getLfimg());
                        }
                    }
//                if (outb.getFreeQty() != null) {
//                    regqty = outb.getLfimg().add(outb.getFreeQty());
//                } else {
//                    regqty = outb.getLfimg();
//                }
                    txfRegQty.setValue(regqty.doubleValue());
                    outbDel = outb;
                }
                setProgress(4, 1, 4);
                continue;
//                return null;  // return your result
            }
            return null;
        }

        @Override
        protected void failed(Throwable cause) {
            validDO = false;
            if (cause instanceof HibersapException && cause.getCause() instanceof JCoException) {
                cause = cause.getCause();
            }
            logger.error(null, cause);
            JOptionPane.showMessageDialog(rootPane, cause.getMessage());
        }

        @Override
        protected void finished() {
//            if (validDO) {
//                lblDelNum.setForeground(Color.black);
//            } else {
//                lblDelNum.setForeground(Color.red);
//            }
////            setRbtEnabled(!validDO);
//            setSaveNeeded(isValidated() && validDO);
        }
    }

   
    private class SaveRecordTask extends org.jdesktop.application.Task<Object, Void> {

        SaveRecordTask(org.jdesktop.application.Application app) {
            // Runs on the EDT.  Copy GUI state that
            // doInBackground() depends on from parameters
            // to SaveRecordTask fields, here.
            
            super(app);
            setSaveNeeded(false);
            setClearable(false);
        }

        @Override
        protected Object doInBackground() {

            WeightTicketJpaController wCon = new WeightTicketJpaController();
            Date now = wCon.getServerDate();
           
            if (now == null) {
                now = Calendar.getInstance().getTime();                 
                             
            }
            SimpleDateFormat formatter = new SimpleDateFormat();
            AppConfig sap = WeighBridgeApp.getApplication().getConfig();
            int seqBDay = wCon.getNewSeqBDay();
            int seqBMonth = wCon.getNewSeqBMonth();
            
            formatter.applyPattern("yyMMddHHmm");
            String id = formatter.format(now);

            formatter.applyPattern("yyyy");
          //   if (entityManager.
            String sPlant  = "";         
         
            sPlant =  WeighBridgeApp.getApplication().getConfig().getwPlant().toString();
            Calendar currdate = Calendar.getInstance();
            String yearplus = "";
            int y = 0;
            String nam = id.substring(0, 2);
            String pWbId = WeighBridgeApp.getApplication().getConfig().getWbId().trim();

            int iplus = wTRegRepository.getTicketInCre(pWbId);

            y = Integer.parseInt(nam) + iplus;
            id = Integer.toString(y) + id.substring(2, id.length());
            int year = Integer.parseInt(formatter.format(now));
            String sId = id + String.format("%03d", seqBDay);
            int iCount = wTRegRepository.checkExist(sId);
            if (iCount > 0) {
                seqBDay = seqBDay + iCount;
            }
            newWeightTicket.setWeightTicketPK(new WeightTicketPK(sap.getsClient(), sap.getwPlant().toString(), id, seqBDay));
            newWeightTicket.setSeqByMonth(seqBMonth);
            newWeightTicket.setCreateDate(now);
            formatter.applyPattern("HHmmss");
            newWeightTicket.setCreateTime(formatter.format(now));
            newWeightTicket.setCreator(WeighBridgeApp.getApplication().getLogin().getUserPK().getId());
            newWeightTicket.setOfflineMode(WeighBridgeApp.getApplication().isOfflineMode());
            newWeightTicket.setRegCategory(rbtInward.isSelected() ? 'I' : 'O');
            newWeightTicket.setRegItemQty(new BigDecimal(((Number) txfRegQty.getValue()).doubleValue()));
            newWeightTicket.setWbId(sap.getWbId().toString());
            newWeightTicket.setAbbr(abbr);
//            System.out.println(WeighBridgeApp.getApplication().isOfflineMode());
//            if(WeighBridgeApp.getApplication().isOfflineMode()){
            newWeightTicket.setDocYear(year);
            newWeightTicket.setPosted(0);
            newWeightTicket.setSoRomooc(txtSoRomooc.getText().trim());
//            }
            if (newWeightTicket.getDelivNumb() != null && newWeightTicket.getDelivNumb().trim().isEmpty()) {
                newWeightTicket.setDelivNumb(null);
                newWeightTicket.setItem(null);
                newWeightTicket.setMatnrRef(null);
                newWeightTicket.setRegItemText(txtRegItem.getText().trim());
                newWeightTicket.setUnit(null);
            }
            //+20100113#01
            newWeightTicket.setKunnr(null);
            if (newWeightTicket.getDelivNumb() != null && !newWeightTicket.getDelivNumb().trim().isEmpty()) {
                String val = newWeightTicket.getDelivNumb().trim();
                val = Conversion_Exit.Conv_output_num(val, 10);
                newWeightTicket.setDelivNumb(val);
                if (outbDel != null) {
                    newWeightTicket.setKunnr(outbDel.getKunnr());
                }
            }
            //+20100113#01
            //set du lieu cho do detail
            List<OutbDetailsV2> detail = new ArrayList<OutbDetailsV2>();
            OutbDetailsV2 item = null;
            if (WeighBridgeApp.getApplication().isOfflineMode() && !txtDelNum.getText().equals("")) {
                newWeightTicket.setDelivNumb(txtDelNum.getText());
            } else if (!WeighBridgeApp.getApplication().isOfflineMode()) {
                if (!txtDelNum.getText().equals("")) {
                    String[] do_list = txtDelNum.getText().trim().split("-");
                    for (int i = 0; i < do_list.length; i++) {
                        String doNum = do_list[i];
                        WeightTicketJpaController conWTicket = new WeightTicketJpaController();
                        try {
                            detail = conWTicket.findByMandtDelivNumb(doNum);
                        } catch (Exception ex) {
                            java.util.logging.Logger.getLogger(WTRegView.class.getName()).log(Level.SEVERE, null, ex);
                        }
                        for (int j = 0; j < detail.size(); j++) {
                            item = detail.get(j);
                            String zero = "0";
                            String n = String.valueOf(seqBDay);
                            while (n.length() < 3) {
                                n = zero.concat(n);
                            }
                            item.setWtId(id + n);
                            if (!entityManager.getTransaction().isActive()) {
                                entityManager.getTransaction().begin();
                            }
                            entityManager.merge(item);
                            entityManager.getTransaction().commit();
                        }
                    }
                }
            }
            if (!WeighBridgeApp.getApplication().getConfig().getModeNormal()) {
                newWeightTicket.setCreator(WeighBridgeApp.getApplication().getCurrent_user());
            }
            setMessage(resourceMapMsg.getString("msg.saveData"));
            if (!entityManager.getTransaction().isActive()) {
                entityManager.getTransaction().begin();
            }
            entityManager.persist(newWeightTicket);
            entityManager.getTransaction().commit();
            
            
             
            try {
                setMessage(resourceMapMsg.getString("msg.printing"));
                txtSodangtai.setText(newWeightTicket.getWeightTicketPK().getId().toString()
                        + String.format("%03d", newWeightTicket.getWeightTicketPK().getSeqByDay())); //+20100303
                
                // tuanna -  update tai trong vao phieu can 
               //  newWeightTicket.get
               //  con  = null ; 
                 
                
                printWT(newWeightTicket, false);

                // tuanna add -- copy ticket ID to clipboard. 28.11.2012 

                StringSelection stringSelection = new StringSelection(txtSodangtai.getText());
                Clipboard clipboard = Toolkit.getDefaultToolkit().getSystemClipboard();
                clipboard.setContents(stringSelection, null);
            } catch (Exception ex) {
                 btnSave.setEnabled(true); 
            }
            ListWeightTicketsTask t = new ListWeightTicketsTask(this.getApplication());
            t.execute();
            return null;  // return your result
        }

        @Override
        protected void failed(Throwable cause) {
            entityManager.getTransaction().rollback();
            setSaveNeeded(true);
        }

        @Override
        protected void finished() {
            setMessage(resourceMapMsg.getString("msg.finished"));
            entityManager.clear();
            cleanData();
            setCreatable(true);
            setFormEditable(false);
            setRbtEnabled(false);
            setClearable(false);
            setSaveNeeded(false);
            if (flag_revert) {
                String client = WeighBridgeApp.getApplication().getConfig().getsClient();
                String plant = WeighBridgeApp.getApplication().getConfig().getwPlant();
                List<WeightTicket> wt = weightTicketRepository.getListByMandtWPlantDelivNumb(client, plant, outb_number);
                WeightTicket item = null;
                for (int i = 0; i < wt.size() - 1; i++) {
                    item = wt.get(i);
                    item.setPosted(-1);
                    if (!entityManager.getTransaction().isActive()) {
                        entityManager.getTransaction().begin();
                    }
                    entityManager.persist(item);
                    entityManager.getTransaction().commit();
                }
            }
        }
    }
    // </editor-fold>
    // <editor-fold defaultstate="collapsed" desc="Form's properties">
    private boolean creatable = false;

    public boolean isCreatable() {
        return creatable;
    }

    public void setCreatable(boolean b) {
        boolean old = isCreatable();
        this.creatable = b;
        firePropertyChange("creatable", old, isCreatable());
    }
    private boolean clearable = false;

    public boolean isClearable() {
        return clearable;
    }

    public void setClearable(boolean b) {
        boolean old = isClearable();
        this.clearable = b;
        firePropertyChange("clearable", old, isClearable());
    }
    private boolean saveNeeded = false;

    public boolean isSaveNeeded() {
        return saveNeeded;
    }

    public void setSaveNeeded(boolean b) {
        boolean old = isSaveNeeded();
        this.saveNeeded = b;
        firePropertyChange("saveNeeded", old, isSaveNeeded());
    }

    public boolean isValidated() {
        boolean bDriName = false, bCMNDBL = false, bLicPlate = false,
                bRegCat = false, bRegITxt = false, bRegIQty = false,
                bResult = false;
        bDriName = !(txtDName.getText() == null || txtDName.getText().trim().isEmpty());
        if (bDriName) {
            lblDName.setForeground(Color.black);
        } else {
            lblDName.setForeground(Color.red);
        }
        bCMNDBL = !(txtCMNDBL.getText() == null || txtCMNDBL.getText().trim().isEmpty() || txtCMNDBL.getText().trim().length() > 9);
        if (bCMNDBL) {
            lblCMNDBL.setForeground(Color.black);
        } else {
            lblCMNDBL.setForeground(Color.red);
        }
        Matcher m = Constants.WTRegView.patLicPlate.matcher(txtLicPlate.getText().trim());
        Matcher m_new = Constants.WTRegView.patLicPlatenew.matcher(txtLicPlate.getText().trim());

        bLicPlate = !(txtLicPlate.getText().trim().isEmpty());// || !(m.matches() || m_new.matches()));
        // 

        if (bLicPlate) {
            if (txtDelNum.getText().trim().isEmpty() || outbDel == null) {
                bLicPlate = checkLicPlate(null, null);
            } else {
                bLicPlate = checkLicPlate(outbDel.getLfart(), outbDel.getTraid());
            }
        }
        if (bLicPlate && rbtInward.isSelected()) {
            if (outbDel != null) {
                String soXe_tmp = txtLicPlate.getText().trim();
                int indexRomooc = -1;
                if (outbDel.getTraid() != null && !outbDel.getTraid().equals("")) {                    
                    indexRomooc = outbDel.getTraid().indexOf("|");
                    if (indexRomooc >= 0) {
                        soXe_tmp = soXe_tmp.concat("|").concat(txtSoRomooc.getText().trim());
                    }                            
                }
                if (!soXe_tmp.equals(outbDel.getTraid().trim())) {                    
                    if (outbDel.getTraid() != null 
                            && indexRomooc >= 0 
                            && indexRomooc != (outbDel.getTraid().trim().length() -1)
                            && txtSoRomooc.getText().trim().equals("")) {
                        JOptionPane.showMessageDialog(rootPane, 
                            resourceMapMsg.getString("msg.plzInputRomoc"));
                    } else {
                    JOptionPane.showMessageDialog(rootPane, 
                            resourceMapMsg.getString("msg.errorLicensePlate"));
                    }
                }
               
            }
        }
        if (bLicPlate) {
            lblLicPlate.setForeground(Color.black);
        } else {
            lblLicPlate.setForeground(Color.red);
        }
        bRegCat = rbtInward.isSelected() || rbtOutward.isSelected();
        if (bRegCat) {
            lblRegCat.setForeground(Color.black);
        } else {
            lblRegCat.setForeground(Color.red);
        }
        bRegITxt = !(txtRegItem.getText() == null || txtRegItem.getText().trim().isEmpty());
        if (bRegITxt) {
            lblRegItem.setForeground(Color.black);
        } else {
            lblRegItem.setForeground(Color.red);
        }
        bRegIQty = !(txfRegQty.getValue() == null || ((Number) txfRegQty.getValue()).doubleValue() <= 0d);
        if (bRegIQty) {
            lblRegQty.setForeground(Color.black);
        } else {
            lblRegQty.setForeground(Color.red);
        }

        bResult = bDriName && bCMNDBL && bLicPlate && bRegCat && bRegITxt && bRegIQty;
        setFormValid(bResult);
//        return bResult && validDO;
        boolean r;
        if (txtDelNum.getText() != null || !txtDelNum.getText().equals("")) {
            r = bResult && validDO && flag_check;
        } else {
            r = bResult && validDO;
        }
        return r;
    }

    private void printWT(WeightTicket wt, boolean reprint) throws Exception {
        try {
            AppConfig config = WeighBridgeApp.getApplication().getConfig();
            Map<String, Object> map = new HashMap<String, Object>();
            map.put("P_CLIENT", WeighBridgeApp.getApplication().getConfig().getsClient());
            map.put("P_WPLANT", WeighBridgeApp.getApplication().getConfig().getwPlant());
            map.put("P_ID", wt.getWeightTicketPK().getId());
            map.put("P_DAYSEQ", wt.getWeightTicketPK().getSeqByDay());
            map.put("P_REPRINT", reprint);
            map.put("P_ADDRESS", config.getRptId());
            String reportName = null;
            if (WeighBridgeApp.getApplication().getConfig().getModeNormal()) {
                //reportName = "./rpt/rptBT/RegWT_HP.jasper";
                reportName = "./rpt/rptBT/RegWT_HP.jrxml";
            } else {
                //reportName = "./rpt/rptPQ/RegWT.jasper";
                reportName = "./rpt/rptPQ/RegWT.jrxml";
            }
            Connection connect = JReportConnector.getInstance();
            JasperReport jasperReport = JasperCompileManager.compileReport(reportName);
            JasperPrint jasperPrint = JasperFillManager.fillReport(jasperReport, map, connect);
            JasperViewer jv = new JasperViewer(jasperPrint, false);
            jv.setVisible(true);
        } catch (Exception ex) {
            logger.error(null, ex);
            throw ex;
        }
    }

    private boolean checkLicPlate(String lfart, String traid) {
        boolean result = false;
        //20121217
        Material mat_tmp = null;
        Boolean ximang_tmp = false;
        WeightTicketJpaController con = new WeightTicketJpaController();
        try {
            
            mat_tmp = con.CheckPOSTO(mat_numb);            
            if (mat_tmp.getXimang() != null) {
                ximang_tmp = true;
            } else {
                ximang_tmp = false;
            }
        } catch (Exception ex) {
            java.util.logging.Logger.getLogger(WeightTicketView.class.getName()).log(Level.SEVERE, null, ex);
        }
        //if (lfart != null && ( lfart.equalsIgnoreCase("LF") || lfart.equalsIgnoreCase("ZTLF") ) ) {
        if (lfart != null && ximang_tmp && (lfart.equalsIgnoreCase("ZTLF") || lfart.equalsIgnoreCase("NL"))) {
            String txt = traid;
            String doLicPlate = null;
            int idx1 = txt.indexOf("|");
            int idx2 = txt.indexOf("\\");
            if (idx1 >= 0 || idx2 >= 0) {
                int splitPos = idx1 < 0 ? idx2 : idx1;
                int bIdx = splitPos - 8;
                int eIdx = -1;
                if (bIdx < 0) {
                    bIdx = 0;
                }
                doLicPlate = txt.substring(bIdx, splitPos);
                splitPos++;
                eIdx = splitPos + 8;
                if (eIdx >= txt.length()) {
                    eIdx = txt.length() - 1;
                }
                if (splitPos < eIdx) {
//                            outb.setSoRomooc(txt.substring(splitPos, eIdx));
                }
            } else {
                int countSpace = 0;
                int[] pos = new int[3];
                char[] chars = txt.toCharArray();
                for (int x = 0; x < chars.length; x++) {
                    char c = chars[x];
                    if (c == ' ') {
                        pos[countSpace] = x;
                        countSpace++;
                    }
                }
                if (countSpace == 3) {
                    int splitPos = pos[1];
                    int bIdx = splitPos - 8;
                    int eIdx = -1;
                    if (bIdx < 0) {
                        bIdx = 0;
                    }
                    doLicPlate = txt.substring(bIdx, splitPos);
                    splitPos++;
                    eIdx = splitPos + 8;
                    if (eIdx >= txt.length()) {
                        eIdx = txt.length() - 1;
                    }
                    if (splitPos < eIdx) {
//                        outb.setSoRomooc(txt.substring(splitPos, eIdx));
                    }
                } else {
                    doLicPlate = traid;
                }
            }
            if (doLicPlate.equalsIgnoreCase(newWeightTicket.getSoXe())) {
                result = true;
            } else {
                result = false;
                JOptionPane.showMessageDialog(rootPane, "Số xe \"" + newWeightTicket.getSoXe()
                        + "\" không khớp với số được đăng ký trong D.O: " + doLicPlate);
            }
        } else {
            //Do local check for entered Truck's License Plate
            SAPSetting sapSetting = WeighBridgeApp.getApplication().getSapSetting();
            Vehicle v = entityManager.find(Vehicle.class, newWeightTicket.getSoXe());

            if (v == null && !ximang_tmp
                    && (sapSetting.getCheckTalp() != null && sapSetting.getCheckTalp().booleanValue() == true)) {
                result = false;
                JOptionPane.showMessageDialog(rootPane, "Số xe \" " + newWeightTicket.getSoXe()
                        + " \" chưa được đăng ký để xuất/nhập hàng!");
            } else {

                result = true;
                //-----------------
                if (sapSetting.getCheckTalp() != null && sapSetting.getCheckTalp().booleanValue() == true) {
                    boolean l_not_valid = false;
                    VehicleValid vh = new VehicleValid();
                    VehicleValidPK vhPK = new VehicleValidPK();
                    //EntityManager entityManager = java.beans.Beans.isDesignTime() ? null : WeighBridgeApp.getApplication().getEm();
                    AppConfig lconfig = WeighBridgeApp.getApplication().getConfig();
                    //Tuanna 201800904
                    if ( txtDName1.getText().startsWith("N") )
                         abbr = sVendor; 
                    else 
                   
                            abbr = (v != null ? v.getTaAbbr() : ""); //"vendor"
                    
                   //End --Tuanna 201800904 
                    //vhPK.setMandt(lconfig.getsClient().toString());
                    vhPK.setWPlant(lconfig.getwPlant().toString());
                    vhPK.setSoXe(newWeightTicket.getSoXe());
                    vh.setVehicleValidPK(vhPK);
                    vh = entityManager.find(VehicleValid.class, vh.getVehicleValidPK());
                    if (vh != null) {
                        try {
                            l_not_valid = vh.getNotValid();
                            //if (l_valid == true){
                            //chk_not_valid.setSelected(l_valid);
                            //                }
                        } catch (Exception e) {
                        }
                    }

                    entityManager.clear();
                    if (l_not_valid == true) {
                        result = false;
                        JOptionPane.showMessageDialog(rootPane, "Số xe \" " + newWeightTicket.getSoXe()
                                + " \" đang bị cấm xuất/nhập hàng!");
                    }
                }
                //-----------------
            }

        }
        return result;
    }

    private void cleanData() {
        newWeightTicket.setWeightTicketPK(null);
        outbDel = null;
        txtDName.setText("");
        txtCMNDBL.setText("");
        txtLicPlate.setText("");
        txtSoRomooc.setText("");
        txtDName1.setText("");
        rbtRegCatGroup.clearSelection();
        rbtInward.setEnabled(true);
        rbtOutward.setEnabled(true);
        txtRegItem.setText("");
        txtRegItem1.setSelectedItem("");
        txfRegQty.setValue(null);
        txfRegQty1.setValue(null);
        txtDelNum.setText("");

        lblDName.setForeground(Color.black);
        lblCMNDBL.setForeground(Color.black);
        lblLicPlate.setForeground(Color.black);
        lblTrailerPlate.setForeground(Color.black);
        lblRegCat.setForeground(Color.black);
        lblRegItem.setForeground(Color.black);
        lblRegQty.setForeground(Color.black);
        lblDelNum.setForeground(Color.black);
        
        //20180722 Tuanna 
        
        cPara.G_POSTO = "";
        
        validDO = true;
    }

    private List<WeightTicket> filterHours(List<WeightTicket> data, String timefrom, String timeto) {
        List<WeightTicket> result = new ArrayList<WeightTicket>();
        int n1 = Integer.parseInt(timefrom);
        double n2 = Integer.parseInt(timeto) + 0.99;
        if (!data.isEmpty()) {
            for (int i = 0; i < data.size(); i++) {
                WeightTicket item = null;
                item = data.get(i);

                String ct = item.getCreateTime();
//                System.out.println(ct);
                Character c0 = ct.charAt(0);
                Character c1 = ct.charAt(1);
                String ct1 = c0.toString().concat(c1.toString());
                int cTime = Integer.parseInt(ct1);
//                System.out.println(cTime);
                if (cTime >= n1 && cTime <= n2) {
                    if (WeighBridgeApp.getApplication().getConfig().getModeNormal()) {
                        result.add(item);
                    } else {
                        //filter sloc
                        String[] sloc_item = WeighBridgeApp.getApplication().getSloc().split("-");
                        if (sloc_item.length > 0) {
                            for (int j = 0; j < sloc_item.length; j++) {
                                String current_sloc = sloc_item[j].toString().trim();
                                if (item.getLgort() == null) {
                                    result.add(item);
                                    break;
                                } else if (item.getLgort().equals(current_sloc)) {
                                    result.add(item);
                                }
                            }
                        }

                    }

                }
            }
        }
        return result;
    }
    // </editor-fold>
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnCheckDO;
    private javax.swing.JButton btnClear;
    private javax.swing.JButton btnFind;
    private javax.swing.JButton btnMany;
    private javax.swing.JButton btnNew;
    private javax.swing.JButton btnPrintRpt;
    private javax.swing.JButton btnReprint;
    private javax.swing.JButton btnSave;
    private javax.swing.ButtonGroup buttonGroup1;
    private javax.swing.JComboBox cbxTimeFrom;
    private javax.swing.JComboBox cbxTimeTo;
    private javax.swing.JComboBox cbxType;
    private org.jdesktop.swingx.JXDatePicker dpFrom;
    private org.jdesktop.swingx.JXDatePicker dpTo;
    private javax.swing.JButton jButton1;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JSeparator jSeparator1;
    private javax.swing.JTextField jTextField1;
    private javax.swing.JLabel lblBienSo;
    private javax.swing.JLabel lblCMNDBL;
    private javax.swing.JLabel lblDName;
    private javax.swing.JLabel lblDName1;
    private javax.swing.JLabel lblDelNum;
    private javax.swing.JLabel lblFrom;
    private javax.swing.JLabel lblGio;
    private javax.swing.JLabel lblGioden;
    private javax.swing.JLabel lblLicPlate;
    private javax.swing.JLabel lblLicPlate1;
    private javax.swing.JLabel lblRegCat;
    private javax.swing.JLabel lblRegItem;
    private javax.swing.JLabel lblRegQty;
    private javax.swing.JLabel lblState;
    private javax.swing.JLabel lblTo;
    private javax.swing.JLabel lblTrailerPlate;
    private javax.swing.JLabel lblType;
    private javax.swing.JLabel lblType1;
    private javax.swing.JLabel lblType2;
    private javax.swing.JLabel lblUnit;
    private com.gcs.wb.jpa.entity.WeightTicket newWeightTicket;
    private com.gcs.wb.jpa.entity.OutbDel outbDel;
    private javax.swing.JPanel pnControl;
    private javax.swing.JPanel pnFilter;
    private javax.swing.JPanel pnPrintControl;
    private javax.swing.JPanel pnWTicket;
    private javax.swing.JScrollPane pnWTs;
    private javax.swing.JRadioButton rbtDissolved;
    private javax.swing.JRadioButton rbtInward;
    private javax.swing.JRadioButton rbtOutward;
    private javax.swing.JRadioButton rbtPosted;
    private javax.swing.ButtonGroup rbtRegCatGroup;
    private javax.swing.JRadioButton rbtStateAll;
    private com.gcs.wb.jpa.entity.WeightTicket selectedRow;
    private org.jdesktop.swingx.JXTable tabWTs;
    private javax.swing.JFormattedTextField txfRegQty;
    private javax.swing.JFormattedTextField txfRegQty1;
    private javax.swing.JTextField txtBienSo;
    private javax.swing.JTextField txtCMNDBL;
    private javax.swing.JTextField txtDName;
    private javax.swing.JTextField txtDName1;
    private javax.swing.JTextField txtDelNum;
    private javax.swing.JTextField txtLicPlate;
    private javax.swing.JTextField txtNguoitao;
    private javax.swing.JTextField txtRegItem;
    private javax.swing.JComboBox txtRegItem1;
    private javax.swing.JTextField txtSoRomooc;
    private javax.swing.JTextField txtSodangtai;
    private javax.swing.JTextField txtTaixe;
    private org.jdesktop.beansbinding.BindingGroup bindingGroup;
    // End of variables declaration//GEN-END:variables
    private static Logger logger = Logger.getLogger(WTRegView.class);
    private java.util.List<WeightTicket> weightTicketList;
    private boolean validDO = true;
    private boolean formValid;
    public static final String MODE_REG = "MODE_REG";
    public static final String MODE_RPT = "MODE_RPT";
    private String mode = null;
    private String abbr;
    private boolean flag_revert = false;
    private String outb_number = null;
    private boolean flag_check = false;
    private String mat_numb = null;

    /**
     * Get the value of mode
     *
     * @return the value of mode
     */
    public String getMode() {
        return mode;
    }

    /**
     * Set the value of mode
     *
     * @param mode new value of mode
     */
    public void setMode(String mode) {
        this.mode = mode;
    }

    /**
     * Get the value of formValid
     *
     * @return the value of formValid
     */
    public boolean isFormValid() {
        return formValid;
    }

    /**
     * Set the value of formValid
     *
     * @param formValid new value of formValid
     */
    public void setFormValid(boolean formValid) {
        boolean oldFormValid = this.formValid;
        this.formValid = formValid;
        firePropertyChange(Constants.WTRegView.PROP_FORMVALID, oldFormValid, formValid);
    }
    private boolean formEditable;

    /**
     * Get the value of formEditable
     *
     * @return the value of formEditable
     */
    public boolean isFormEditable() {
        return formEditable;
    }

    /**
     * Set the value of formEditable
     *
     * @param formEditable new value of formEditable
     */
    public void setFormEditable(boolean formEditable) {
        boolean oldFormEditable = this.formEditable;
        this.formEditable = formEditable;
        firePropertyChange(Constants.WTRegView.PROP_FORMEDITABLE, oldFormEditable, formEditable);
    }
    private boolean rbtEnabled;

    /**
     * Get the value of rbtEnabled
     *
     * @return the value of rbtEnabled
     */
    public boolean isRbtEnabled() {
        return rbtEnabled;
    }

    /**
     * Set the value of rbtEnabled
     *
     * @param rbtEnabled new value of rbtEnabled
     */
    public void setRbtEnabled(boolean rbtEnabled) {
        boolean oldRbtEnabled = this.rbtEnabled;
        this.rbtEnabled = rbtEnabled;
        firePropertyChange(Constants.WTRegView.PROP_RBTENABLED, oldRbtEnabled, rbtEnabled);
    }
    
    private boolean[] editable = null;
    Object[][] wtData = null;
    Object[] wtCols = new String[]{
        "Số tài",
        "Tên tài xế",
        "CMND/BL",
        "B.S Xe",
        "B.S Rơmoóc",
        "Nhập/Xuất (I/O)",
        "Loại hàng đăng ký",
        "Trọng lượng đăng ký",
        "Số D.O",
        "Người tạo",
        "Số Phiếu trong tháng",
        "Ngày",
        "Giờ",
        "Hủy",
        "SAP Posted"};
    Class[] wtTypes = new Class[]{
        Integer.class,
        String.class,
        String.class,
        String.class,
        String.class,
        Character.class,
        String.class,
        BigDecimal.class,
        String.class,
        String.class,
        Integer.class,
        Date.class,
        String.class,
        Boolean.class,
        Boolean.class};
    Object[][] wtRptData = null;
    Object[] wtRptCols = new String[]{
        "STT",
        "S.Đ.Tài",
        "Tên tài xế",
        "CMND/BL",
        "Số Xe",
        "Số Rơmoóc",
        "Người tạo",
        "Ngày giờ tạo",
        "Nhập/Xuất(I/O)",
        "Loại hàng",
        "Ngày giờ vào",
        "T.L vào",
        "Ngày giờ ra",
        "T.L ra",
        "T.L Hàng",
        "Số D.O",
        "Số chứng từ SAP",
        "Hủy",
        "SAP Posted",
        "Đơn vị vân chuyển",
        "Số P.O"};
    Class[] wtRptTypes = new Class[]{
        Integer.class,
        Integer.class,
        String.class,
        String.class,
        String.class,
        String.class,
        String.class,
        Date.class,
        Character.class,
        String.class,
        Date.class,
        BigDecimal.class,
        Date.class,
        BigDecimal.class,
        BigDecimal.class,
        String.class,
        String.class,
        Boolean.class,
        Boolean.class,
        String.class,
        String.class};
    public org.jdesktop.application.ResourceMap resourceMapMsg = org.jdesktop.application.Application.getInstance(com.gcs.wb.WeighBridgeApp.class).getContext().getResourceMap(WTRegView.class);
}
