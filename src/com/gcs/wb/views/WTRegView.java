/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

/*
 * WTRegView.java
 *
 * Created on 10-04-2010, 10:06:26
 */
package com.gcs.wb.views;

import com.gcs.wb.WeighBridgeApp;
import com.gcs.wb.bapi.service.SAPService;
import com.gcs.wb.base.constant.Constants;
import com.gcs.wb.base.enums.MaterialEnum;
import com.gcs.wb.base.enums.StatusEnum;
import com.gcs.wb.base.util.StringUtil;
import com.gcs.wb.controller.WeightTicketRegistarationController;
import com.gcs.wb.jpa.JPAConnector;
import com.gcs.wb.jpa.entity.*;
import com.gcs.wb.model.AppConfig;
import com.sap.conn.jco.JCoException;
import org.apache.log4j.Logger;
import org.hibersap.HibersapException;
import org.jdesktop.application.Action;
import org.jdesktop.application.ResourceMap;
import org.jdesktop.application.Task;

import javax.persistence.EntityManager;
import javax.persistence.EntityTransaction;
import javax.swing.*;
import java.awt.*;
import java.awt.datatransfer.Clipboard;
import java.awt.datatransfer.StringSelection;
import java.awt.event.KeyEvent;
import java.math.BigDecimal;
import java.text.SimpleDateFormat;
import java.util.*;
import java.util.List;
import java.util.logging.Level;

public class WTRegView extends javax.swing.JInternalFrame {
    public String sVendor = "";
    public String sPO = "";
    public double dKldk = 0;

    EntityManager entityManager = JPAConnector.getInstance();
    EntityTransaction entityTransaction = entityManager.getTransaction();

    SAPService sapService = new SAPService();

    WeightTicketRegistarationController weightTicketRegistarationController = new WeightTicketRegistarationController();

    private static final Logger logger = Logger.getLogger(WTRegView.class);
    private final List<WeightTicket> weightTicketList;
    private boolean validDO = true;
    private boolean formValid;
    private String abbr;
    private boolean flag_revert = false;
    private String outb_number = null;
    private boolean flag_check = false;
    private String mat_numb = null;
    private com.gcs.wb.jpa.entity.WeightTicket newWeightTicket;
    private com.gcs.wb.jpa.entity.OutboundDelivery outbDel;
    private com.gcs.wb.jpa.entity.WeightTicket selectedRow;
    private boolean[] editable = null;
    Object[][] wtData = null;
    Object[] wtCols = Constants.WTRegView.WEIGHTTICKET_COLUMS;
    Class[] wtTypes = Constants.WTRegView.WEIGHTTICKET_TYPES;
    public ResourceMap resourceMapMsg = org.jdesktop.application.Application.getInstance(com.gcs.wb.WeighBridgeApp.class).getContext().getResourceMap(WTRegView.class);

    public WTRegView() {
        newWeightTicket = new com.gcs.wb.jpa.entity.WeightTicket();
        selectedRow = new com.gcs.wb.jpa.entity.WeightTicket();
        outbDel = new com.gcs.wb.jpa.entity.OutboundDelivery();
        initComponents();
        weightTicketList = new ArrayList<>();
        ListWeightTicketsTask t = new ListWeightTicketsTask(WeighBridgeApp.getApplication());
        t.execute();

        cbxHourTo.setSelectedIndex(23);
        txtNMaterial.setVisible(false);
        cbxNMaterial.setModel(weightTicketRegistarationController.getListMaterial());
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {
        bindingGroup = new org.jdesktop.beansbinding.BindingGroup();

        rbtRegCatGroup = new javax.swing.ButtonGroup();
        jTextField1 = new javax.swing.JTextField();
        buttonGroup1 = new javax.swing.ButtonGroup();
        pnFilter = new javax.swing.JPanel();
        lblDateFrom = new javax.swing.JLabel();
        dpDateFrom = new org.jdesktop.swingx.JXDatePicker();
        lblDateTo = new javax.swing.JLabel();
        dpDateTo = new org.jdesktop.swingx.JXDatePicker();
        lblMaterialType = new javax.swing.JLabel();
        cbxMaterialType = new javax.swing.JComboBox();
        lblHourFrom = new javax.swing.JLabel();
        cbxHourFrom = new javax.swing.JComboBox();
        lblHourTo = new javax.swing.JLabel();
        cbxHourTo = new javax.swing.JComboBox();
        lblCreator = new javax.swing.JLabel();
        txtCreator = new javax.swing.JTextField();
        lblDriverName = new javax.swing.JLabel();
        txtDriverName = new javax.swing.JTextField();
        lblPlateNo = new javax.swing.JLabel();
        txtPlateNo = new javax.swing.JTextField();
        btnFind = new javax.swing.JButton();
        lblStatus = new javax.swing.JLabel();
        cbxStatus = new javax.swing.JComboBox();
        spnResult = new javax.swing.JScrollPane();
        tabResults = new org.jdesktop.swingx.JXTable();
        pnPrintControl = new javax.swing.JPanel();
        btnReprint = new javax.swing.JButton();
        pnWTicket = new javax.swing.JPanel();
        pnNLeft = new javax.swing.JPanel();
        lblNDriverName = new javax.swing.JLabel();
        txtNDriverName = new javax.swing.JTextField();
        lblNCMNDBL = new javax.swing.JLabel();
        txtNCMNDBL = new javax.swing.JTextField();
        lblNPlateNo = new javax.swing.JLabel();
        txtNPlateNo = new javax.swing.JTextField();
        lblNTrailerPlate = new javax.swing.JLabel();
        txtNTrailerPlate = new javax.swing.JTextField();
        pnNRight = new javax.swing.JPanel();
        lblNRegCat = new javax.swing.JLabel();
        rbtNInward = new javax.swing.JRadioButton();
        rbtNOutward = new javax.swing.JRadioButton();
        txtNMaterial = new javax.swing.JTextField();
        lblNMaterial = new javax.swing.JLabel();
        cbxNMaterial = new javax.swing.JComboBox();
        lblNWeight = new javax.swing.JLabel();
        txtNWeight = new javax.swing.JFormattedTextField();
        lblNWeightUnit = new javax.swing.JLabel();
        lblNDONum = new javax.swing.JLabel();
        txtNDONum = new javax.swing.JTextField();
        btnCheckDO = new javax.swing.JButton();
        pnControl = new javax.swing.JPanel();
        btnNew = new javax.swing.JButton();
        btnClear = new javax.swing.JButton();
        btnMany = new javax.swing.JButton();
        btnSave = new javax.swing.JButton();
        lblWeightTicketNo = new javax.swing.JLabel();
        txtWeightTicketNo = new javax.swing.JTextField();
        btnSo = new javax.swing.JButton();

        org.jdesktop.application.ResourceMap resourceMap = org.jdesktop.application.Application.getInstance(com.gcs.wb.WeighBridgeApp.class).getContext().getResourceMap(WTRegView.class);
        jTextField1.setText(resourceMap.getString("jTextField1.text")); // NOI18N
        jTextField1.setName("jTextField1"); // NOI18N

        setClosable(true);
        setMaximizable(true);
        setResizable(true);
        setTitle(resourceMap.getString("Form.title")); // NOI18N
        setName("Form"); // NOI18N

        pnFilter.setBorder(javax.swing.BorderFactory.createTitledBorder(resourceMap.getString("pnFilter.border.title"))); // NOI18N
        pnFilter.setMinimumSize(new java.awt.Dimension(12, 35));
        pnFilter.setName("pnFilter"); // NOI18N
        pnFilter.setPreferredSize(new java.awt.Dimension(315, 35));

        lblDateFrom.setText(resourceMap.getString("lblDateFrom.text")); // NOI18N
        lblDateFrom.setName("lblDateFrom"); // NOI18N

        dpDateFrom.setDate(Calendar.getInstance().getTime());
        dpDateFrom.setName("dpDateFrom"); // NOI18N
        dpDateFrom.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                dpDateFromActionPerformed(evt);
            }
        });

        lblDateTo.setText(resourceMap.getString("lblDateTo.text")); // NOI18N
        lblDateTo.setName("lblDateTo"); // NOI18N

        dpDateTo.setDate(Calendar.getInstance().getTime());
        dpDateTo.setName("dpDateTo"); // NOI18N

        lblMaterialType.setLabelFor(cbxMaterialType);
        lblMaterialType.setText(resourceMap.getString("lblMaterialType.text")); // NOI18N
        lblMaterialType.setName("lblMaterialType"); // NOI18N

        cbxMaterialType.setModel(getMatsModel());
        cbxMaterialType.setName("cbxMaterialType"); // NOI18N
        cbxMaterialType.setRenderer(new DefaultListCellRenderer() {
            @Override
            public Component getListCellRendererComponent(
                JList list, Object value, int index, boolean isSelected, boolean cellHasFocus) {
                super.getListCellRendererComponent(list, value, index, isSelected, cellHasFocus);
                if (value instanceof Material) {
                    Material mat = (Material)value;
                    setText(mat.getMaktx());
                    setToolTipText(mat.getMatnr());
                }
                return this;
            }
        });

        lblHourFrom.setText(resourceMap.getString("lblHourFrom.text")); // NOI18N
        lblHourFrom.setName("lblHourFrom"); // NOI18N

        cbxHourFrom.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "00", "01", "02", "03", "04", "05", "06", "07", "08", "09", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23" }));
        cbxHourFrom.setName("cbxHourFrom"); // NOI18N

        lblHourTo.setText(resourceMap.getString("lblHourTo.text")); // NOI18N
        lblHourTo.setName("lblHourTo"); // NOI18N

        cbxHourTo.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "00", "01", "02", "03", "04", "05", "06", "07", "08", "09", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23" }));
        cbxHourTo.setName("cbxHourTo"); // NOI18N
        cbxHourTo.addItemListener(new java.awt.event.ItemListener() {
            public void itemStateChanged(java.awt.event.ItemEvent evt) {
                cbxHourToItemStateChanged(evt);
            }
        });

        lblCreator.setLabelFor(txtCreator);
        lblCreator.setText(resourceMap.getString("lblCreator.text")); // NOI18N
        lblCreator.setName("lblCreator"); // NOI18N

        txtCreator.setName("txtCreator"); // NOI18N

        lblDriverName.setLabelFor(txtCreator);
        lblDriverName.setText(resourceMap.getString("lblDriverName.text")); // NOI18N
        lblDriverName.setName("lblDriverName"); // NOI18N

        txtDriverName.setName("txtDriverName"); // NOI18N

        lblPlateNo.setText(resourceMap.getString("lblPlateNo.text")); // NOI18N
        lblPlateNo.setName("lblPlateNo"); // NOI18N

        txtPlateNo.setName("txtPlateNo"); // NOI18N

        javax.swing.ActionMap actionMap = org.jdesktop.application.Application.getInstance(com.gcs.wb.WeighBridgeApp.class).getContext().getActionMap(WTRegView.class, this);
        btnFind.setAction(actionMap.get("listWeightTickets")); // NOI18N
        btnFind.setText(resourceMap.getString("btnFind.text")); // NOI18N
        btnFind.setName("btnFind"); // NOI18N

        lblStatus.setText(resourceMap.getString("lblStatus.text")); // NOI18N
        lblStatus.setName("lblStatus"); // NOI18N

        cbxStatus.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Tất cả", "Hoàn tất" }));
        cbxStatus.setName("cbxStatus"); // NOI18N

        javax.swing.GroupLayout pnFilterLayout = new javax.swing.GroupLayout(pnFilter);
        pnFilter.setLayout(pnFilterLayout);
        pnFilterLayout.setHorizontalGroup(
            pnFilterLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pnFilterLayout.createSequentialGroup()
                .addGap(35, 35, 35)
                .addGroup(pnFilterLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addGroup(pnFilterLayout.createSequentialGroup()
                        .addGroup(pnFilterLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(lblDriverName)
                            .addComponent(lblDateFrom))
                        .addGap(33, 33, 33))
                    .addGroup(pnFilterLayout.createSequentialGroup()
                        .addComponent(lblMaterialType, javax.swing.GroupLayout.PREFERRED_SIZE, 69, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)))
                .addGroup(pnFilterLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(btnFind, javax.swing.GroupLayout.PREFERRED_SIZE, 69, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(pnFilterLayout.createSequentialGroup()
                        .addGroup(pnFilterLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addComponent(cbxMaterialType, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(txtDriverName)
                            .addComponent(dpDateFrom, javax.swing.GroupLayout.DEFAULT_SIZE, 178, Short.MAX_VALUE))
                        .addGap(31, 31, 31)
                        .addGroup(pnFilterLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addGroup(pnFilterLayout.createSequentialGroup()
                                .addComponent(lblStatus)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(cbxStatus, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                            .addGroup(pnFilterLayout.createSequentialGroup()
                                .addComponent(lblDateTo)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(dpDateTo, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                            .addGroup(pnFilterLayout.createSequentialGroup()
                                .addComponent(lblPlateNo)
                                .addGap(18, 18, 18)
                                .addComponent(txtPlateNo, javax.swing.GroupLayout.PREFERRED_SIZE, 178, javax.swing.GroupLayout.PREFERRED_SIZE)))
                        .addGap(32, 32, 32)
                        .addGroup(pnFilterLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(lblCreator)
                            .addComponent(lblHourFrom))
                        .addGap(4, 4, 4)
                        .addGroup(pnFilterLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                            .addGroup(pnFilterLayout.createSequentialGroup()
                                .addComponent(cbxHourFrom, javax.swing.GroupLayout.PREFERRED_SIZE, 63, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGap(18, 18, 18)
                                .addComponent(lblHourTo)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(cbxHourTo, javax.swing.GroupLayout.PREFERRED_SIZE, 62, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addComponent(txtCreator))))
                .addGap(178, 178, 178))
        );
        pnFilterLayout.setVerticalGroup(
            pnFilterLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pnFilterLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(pnFilterLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(pnFilterLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(lblHourTo)
                        .addComponent(cbxHourTo, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(lblHourFrom)
                        .addComponent(cbxHourFrom, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(pnFilterLayout.createSequentialGroup()
                        .addGroup(pnFilterLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(lblDateFrom)
                            .addComponent(dpDateFrom, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(10, 10, 10)
                        .addGroup(pnFilterLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(pnFilterLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                .addComponent(txtPlateNo, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addComponent(lblCreator)
                                .addComponent(txtCreator, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(pnFilterLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                .addComponent(txtDriverName, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addComponent(lblPlateNo, javax.swing.GroupLayout.PREFERRED_SIZE, 20, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addComponent(lblDriverName, javax.swing.GroupLayout.PREFERRED_SIZE, 20, javax.swing.GroupLayout.PREFERRED_SIZE))))
                    .addGroup(pnFilterLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(lblDateTo)
                        .addComponent(dpDateTo, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(pnFilterLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(cbxMaterialType, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(lblStatus)
                    .addComponent(cbxStatus, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(lblMaterialType))
                .addGap(18, 18, 18)
                .addComponent(btnFind, javax.swing.GroupLayout.DEFAULT_SIZE, 37, Short.MAX_VALUE)
                .addGap(26, 26, 26))
        );

        spnResult.setBorder(javax.swing.BorderFactory.createTitledBorder(resourceMap.getString("spnResult.border.title"))); // NOI18N
        spnResult.setName("spnResult"); // NOI18N

        tabResults.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {},
                {},
                {},
                {}
            },
            new String [] {

            }
        ));
        tabResults.setEditable(false);
        tabResults.setName("tabResults"); // NOI18N
        tabResults.setShowGrid(true);
        spnResult.setViewportView(tabResults);

        pnPrintControl.setName("pnPrintControl"); // NOI18N
        pnPrintControl.setLayout(new javax.swing.BoxLayout(pnPrintControl, javax.swing.BoxLayout.LINE_AXIS));

        btnReprint.setAction(actionMap.get("reprintRecord")); // NOI18N
        btnReprint.setText(resourceMap.getString("btnReprint.text")); // NOI18N
        btnReprint.setName("btnReprint"); // NOI18N
        pnPrintControl.add(btnReprint);

        pnWTicket.setName("pnWTicket"); // NOI18N
        pnWTicket.setLayout(new javax.swing.BoxLayout(pnWTicket, javax.swing.BoxLayout.LINE_AXIS));

        pnNLeft.setName("pnNLeft"); // NOI18N

        lblNDriverName.setText(resourceMap.getString("lblNDriverName.text")); // NOI18N
        lblNDriverName.setName("lblNDriverName"); // NOI18N

        txtNDriverName.setName("txtNDriverName"); // NOI18N

        org.jdesktop.beansbinding.Binding binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ_WRITE, this, org.jdesktop.beansbinding.ELProperty.create("${formEditable}"), txtNDriverName, org.jdesktop.beansbinding.BeanProperty.create("enabled"));
        bindingGroup.addBinding(binding);

        txtNDriverName.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtNDriverNameActionPerformed(evt);
            }
        });
        txtNDriverName.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                txtNDriverNameFocusLost(evt);
            }
        });

        lblNCMNDBL.setText(resourceMap.getString("lblNCMNDBL.text")); // NOI18N
        lblNCMNDBL.setName("lblNCMNDBL"); // NOI18N

        txtNCMNDBL.setName("txtNCMNDBL"); // NOI18N

        binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ_WRITE, this, org.jdesktop.beansbinding.ELProperty.create("${formEditable}"), txtNCMNDBL, org.jdesktop.beansbinding.BeanProperty.create("enabled"));
        bindingGroup.addBinding(binding);

        txtNCMNDBL.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtNCMNDBLActionPerformed(evt);
            }
        });
        txtNCMNDBL.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                txtNCMNDBLFocusLost(evt);
            }
        });

        lblNPlateNo.setText(resourceMap.getString("lblNPlateNo.text")); // NOI18N
        lblNPlateNo.setName("lblNPlateNo"); // NOI18N

        txtNPlateNo.setName("txtNPlateNo"); // NOI18N

        binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ_WRITE, this, org.jdesktop.beansbinding.ELProperty.create("${formEditable}"), txtNPlateNo, org.jdesktop.beansbinding.BeanProperty.create("enabled"));
        bindingGroup.addBinding(binding);

        txtNPlateNo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtNPlateNoActionPerformed(evt);
            }
        });
        txtNPlateNo.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                txtNPlateNoFocusLost(evt);
            }
        });

        lblNTrailerPlate.setText(resourceMap.getString("lblNTrailerPlate.text")); // NOI18N
        lblNTrailerPlate.setName("lblNTrailerPlate"); // NOI18N

        txtNTrailerPlate.setName("txtNTrailerPlate"); // NOI18N

        binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ_WRITE, this, org.jdesktop.beansbinding.ELProperty.create("${formEditable}"), txtNTrailerPlate, org.jdesktop.beansbinding.BeanProperty.create("enabled"));
        bindingGroup.addBinding(binding);

        txtNTrailerPlate.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtNTrailerPlateActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout pnNLeftLayout = new javax.swing.GroupLayout(pnNLeft);
        pnNLeft.setLayout(pnNLeftLayout);
        pnNLeftLayout.setHorizontalGroup(
            pnNLeftLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pnNLeftLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(pnNLeftLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(lblNTrailerPlate)
                    .addComponent(lblNDriverName)
                    .addComponent(lblNCMNDBL)
                    .addComponent(lblNPlateNo))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(pnNLeftLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(txtNCMNDBL)
                    .addComponent(txtNPlateNo)
                    .addComponent(txtNTrailerPlate)
                    .addComponent(txtNDriverName, javax.swing.GroupLayout.PREFERRED_SIZE, 274, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap(72, Short.MAX_VALUE))
        );
        pnNLeftLayout.setVerticalGroup(
            pnNLeftLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pnNLeftLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(pnNLeftLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblNDriverName)
                    .addComponent(txtNDriverName, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(pnNLeftLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(lblNCMNDBL)
                    .addComponent(txtNCMNDBL, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(pnNLeftLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(lblNPlateNo)
                    .addComponent(txtNPlateNo, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(pnNLeftLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblNTrailerPlate)
                    .addComponent(txtNTrailerPlate, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap(50, Short.MAX_VALUE))
        );

        pnWTicket.add(pnNLeft);

        pnNRight.setName("pnNRight"); // NOI18N

        lblNRegCat.setText(resourceMap.getString("lblNRegCat.text")); // NOI18N
        lblNRegCat.setName("lblNRegCat"); // NOI18N

        rbtRegCatGroup.add(rbtNInward);
        rbtNInward.setSelected(true);
        rbtNInward.setText(resourceMap.getString("rbtNInward.text")); // NOI18N
        rbtNInward.setName("rbtNInward"); // NOI18N

        binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ_WRITE, this, org.jdesktop.beansbinding.ELProperty.create("${rbtEnabled}"), rbtNInward, org.jdesktop.beansbinding.BeanProperty.create("enabled"));
        bindingGroup.addBinding(binding);

        rbtNInward.addItemListener(new java.awt.event.ItemListener() {
            public void itemStateChanged(java.awt.event.ItemEvent evt) {
                rbtNInwardItemStateChanged(evt);
            }
        });

        rbtRegCatGroup.add(rbtNOutward);
        rbtNOutward.setText(resourceMap.getString("rbtNOutward.text")); // NOI18N
        rbtNOutward.setName("rbtNOutward"); // NOI18N

        binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ_WRITE, this, org.jdesktop.beansbinding.ELProperty.create("${rbtEnabled}"), rbtNOutward, org.jdesktop.beansbinding.BeanProperty.create("enabled"));
        bindingGroup.addBinding(binding);

        rbtNOutward.addItemListener(new java.awt.event.ItemListener() {
            public void itemStateChanged(java.awt.event.ItemEvent evt) {
                rbtNOutwardItemStateChanged(evt);
            }
        });

        txtNMaterial.setName("txtNMaterial"); // NOI18N

        binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ_WRITE, this, org.jdesktop.beansbinding.ELProperty.create("${formEditable}"), txtNMaterial, org.jdesktop.beansbinding.BeanProperty.create("enabled"));
        bindingGroup.addBinding(binding);

        txtNMaterial.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtNMaterialActionPerformed(evt);
            }
        });
        txtNMaterial.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txtNMaterialKeyReleased(evt);
            }
        });

        lblNMaterial.setText(resourceMap.getString("lblNMaterial.text")); // NOI18N
        lblNMaterial.setName("lblNMaterial"); // NOI18N

        cbxNMaterial.setEditable(true);
        cbxNMaterial.setModel(new javax.swing.DefaultComboBoxModel(new String[] { " " }));
        cbxNMaterial.setName("cbxNMaterial"); // NOI18N

        binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ_WRITE, this, org.jdesktop.beansbinding.ELProperty.create("${formEditable}"), cbxNMaterial, org.jdesktop.beansbinding.BeanProperty.create("enabled"));
        bindingGroup.addBinding(binding);

        cbxNMaterial.addItemListener(new java.awt.event.ItemListener() {
            public void itemStateChanged(java.awt.event.ItemEvent evt) {
                cbxNMaterialItemStateChanged(evt);
            }
        });
        cbxNMaterial.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cbxNMaterialActionPerformed(evt);
            }
        });
        cbxNMaterial.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                cbxNMaterialKeyReleased(evt);
            }
        });

        lblNWeight.setText(resourceMap.getString("lblNWeight.text")); // NOI18N
        lblNWeight.setName("lblNWeight"); // NOI18N

        txtNWeight.setFormatterFactory(new javax.swing.text.DefaultFormatterFactory(new javax.swing.text.NumberFormatter()));
        txtNWeight.setName("txtNWeight"); // NOI18N

        binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ_WRITE, this, org.jdesktop.beansbinding.ELProperty.create("${formEditable}"), txtNWeight, org.jdesktop.beansbinding.BeanProperty.create("enabled"));
        bindingGroup.addBinding(binding);

        txtNWeight.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtNWeightActionPerformed(evt);
            }
        });
        txtNWeight.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txtNWeightKeyReleased(evt);
            }
        });

        lblNWeightUnit.setText(resourceMap.getString("lblNWeightUnit.text")); // NOI18N
        lblNWeightUnit.setName("lblNWeightUnit"); // NOI18N

        lblNDONum.setText(resourceMap.getString("lblNDONum.text")); // NOI18N
        lblNDONum.setName("lblNDONum"); // NOI18N

        txtNDONum.setEditable(false);
        txtNDONum.setAction(actionMap.get("checkDO")); // NOI18N
        txtNDONum.setName("txtNDONum"); // NOI18N

        binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ_WRITE, this, org.jdesktop.beansbinding.ELProperty.create("${formEditable}"), txtNDONum, org.jdesktop.beansbinding.BeanProperty.create("enabled"));
        bindingGroup.addBinding(binding);

        txtNDONum.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtNDONumActionPerformed(evt);
            }
        });
        txtNDONum.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txtNDONumKeyReleased(evt);
            }
        });

        btnCheckDO.setAction(actionMap.get("checkDO")); // NOI18N
        btnCheckDO.setText(resourceMap.getString("btnCheckDO.text")); // NOI18N
        btnCheckDO.setName("btnCheckDO"); // NOI18N
        btnCheckDO.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnCheckDOActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout pnNRightLayout = new javax.swing.GroupLayout(pnNRight);
        pnNRight.setLayout(pnNRightLayout);
        pnNRightLayout.setHorizontalGroup(
            pnNRightLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pnNRightLayout.createSequentialGroup()
                .addGap(31, 31, 31)
                .addGroup(pnNRightLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(pnNRightLayout.createSequentialGroup()
                        .addGroup(pnNRightLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addComponent(lblNDONum)
                            .addComponent(lblNWeight))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED))
                    .addGroup(pnNRightLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addGroup(pnNRightLayout.createSequentialGroup()
                            .addGap(11, 11, 11)
                            .addComponent(lblNMaterial))
                        .addGroup(pnNRightLayout.createSequentialGroup()
                            .addGap(17, 17, 17)
                            .addComponent(lblNRegCat, javax.swing.GroupLayout.DEFAULT_SIZE, 51, Short.MAX_VALUE))))
                .addGroup(pnNRightLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addGroup(javax.swing.GroupLayout.Alignment.LEADING, pnNRightLayout.createSequentialGroup()
                        .addComponent(rbtNInward)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(rbtNOutward)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(txtNMaterial, javax.swing.GroupLayout.PREFERRED_SIZE, 60, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(cbxNMaterial, 0, 281, Short.MAX_VALUE)
                    .addComponent(txtNDONum, javax.swing.GroupLayout.DEFAULT_SIZE, 281, Short.MAX_VALUE)
                    .addComponent(txtNWeight, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, 281, Short.MAX_VALUE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(pnNRightLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(lblNWeightUnit)
                    .addComponent(btnCheckDO, javax.swing.GroupLayout.PREFERRED_SIZE, 73, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(31, 31, 31))
        );
        pnNRightLayout.setVerticalGroup(
            pnNRightLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pnNRightLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(pnNRightLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lblNRegCat)
                    .addComponent(rbtNInward)
                    .addComponent(rbtNOutward)
                    .addComponent(txtNMaterial, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(pnNRightLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(cbxNMaterial, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(lblNMaterial))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(pnNRightLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(txtNWeight, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(lblNWeightUnit)
                    .addComponent(lblNWeight))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(pnNRightLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(txtNDONum, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(lblNDONum)
                    .addComponent(btnCheckDO))
                .addContainerGap(47, Short.MAX_VALUE))
        );

        pnWTicket.add(pnNRight);

        pnControl.setName("pnControl"); // NOI18N

        btnNew.setAction(actionMap.get("newRecord")); // NOI18N
        btnNew.setText(resourceMap.getString("btnNew.text")); // NOI18N
        btnNew.setName("btnNew"); // NOI18N

        btnClear.setAction(actionMap.get("clearForm")); // NOI18N
        btnClear.setText(resourceMap.getString("btnClear.text")); // NOI18N
        btnClear.setName("btnClear"); // NOI18N

        btnMany.setText(resourceMap.getString("btnMany.text")); // NOI18N
        btnMany.setEnabled(false);
        btnMany.setName("btnMany"); // NOI18N
        btnMany.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnManyActionPerformed(evt);
            }
        });

        btnSave.setAction(actionMap.get("saveRecord")); // NOI18N
        btnSave.setText(resourceMap.getString("btnSave.text")); // NOI18N
        btnSave.setName("btnSave"); // NOI18N
        btnSave.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnSaveActionPerformed(evt);
            }
        });

        lblWeightTicketNo.setText(resourceMap.getString("lblWeightTicketNo.text")); // NOI18N
        lblWeightTicketNo.setName("lblWeightTicketNo"); // NOI18N

        txtWeightTicketNo.setEditable(false);
        txtWeightTicketNo.setAutoscrolls(false);
        txtWeightTicketNo.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        txtWeightTicketNo.setName("txtWeightTicketNo"); // NOI18N

        btnSo.setText(resourceMap.getString("btnSo.text")); // NOI18N
        btnSo.setEnabled(false);
        btnSo.setName("btnSo"); // NOI18N
        btnSo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnSoActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout pnControlLayout = new javax.swing.GroupLayout(pnControl);
        pnControl.setLayout(pnControlLayout);
        pnControlLayout.setHorizontalGroup(
            pnControlLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pnControlLayout.createSequentialGroup()
                .addComponent(btnNew)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(btnClear)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(btnMany)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(btnSo)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(btnSave)
                .addGap(29, 29, 29)
                .addComponent(lblWeightTicketNo)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(txtWeightTicketNo, javax.swing.GroupLayout.PREFERRED_SIZE, 273, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(129, 129, 129))
        );
        pnControlLayout.setVerticalGroup(
            pnControlLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pnControlLayout.createSequentialGroup()
                .addGap(1, 1, 1)
                .addGroup(pnControlLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(btnNew)
                    .addComponent(btnClear)
                    .addComponent(btnMany)
                    .addComponent(btnSo)
                    .addComponent(btnSave)
                    .addComponent(txtWeightTicketNo, javax.swing.GroupLayout.PREFERRED_SIZE, 26, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(lblWeightTicketNo)))
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(pnFilter, javax.swing.GroupLayout.DEFAULT_SIZE, 915, Short.MAX_VALUE)
                    .addComponent(spnResult, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, 915, Short.MAX_VALUE)
                    .addComponent(pnPrintControl, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, 915, Short.MAX_VALUE)
                    .addComponent(pnWTicket, javax.swing.GroupLayout.DEFAULT_SIZE, 915, Short.MAX_VALUE)
                    .addComponent(pnControl, javax.swing.GroupLayout.DEFAULT_SIZE, 915, Short.MAX_VALUE))
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(pnFilter, javax.swing.GroupLayout.PREFERRED_SIZE, 198, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(spnResult, javax.swing.GroupLayout.PREFERRED_SIZE, 241, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(pnPrintControl, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(pnWTicket, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(pnControl, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(27, Short.MAX_VALUE))
        );

        bindingGroup.bind();

        pack();
    }// </editor-fold>//GEN-END:initComponents

    // <editor-fold defaultstate="collapsed" desc="Old Code">
// </editor-fold>
    // <editor-fold defaultstate="collapsed" desc="Event methods">
    private void rbtNInwardItemStateChanged(java.awt.event.ItemEvent evt) {//GEN-FIRST:event_rbtNInwardItemStateChanged
        setSaveNeeded(isValidated());
    }//GEN-LAST:event_rbtNInwardItemStateChanged

    private void rbtNOutwardItemStateChanged(java.awt.event.ItemEvent evt) {//GEN-FIRST:event_rbtNOutwardItemStateChanged
        setSaveNeeded(isValidated());
    }//GEN-LAST:event_rbtNOutwardItemStateChanged

    private void txtNMaterialKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtNMaterialKeyReleased
        setSaveNeeded(isValidated());
    }//GEN-LAST:event_txtNMaterialKeyReleased

    private void txtNWeightKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtNWeightKeyReleased
        setSaveNeeded(isValidated());
    }//GEN-LAST:event_txtNWeightKeyReleased

    private void txtNDONumKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtNDONumKeyReleased
        if (WeighBridgeApp.getApplication().isOfflineMode()) {
            return;
        }

        if (txtNDONum.getText().trim() == null) {
            return;
        }
        int DOLength = txtNDONum.getText().trim().length();
        if (DOLength == 0 || (validDO && DOLength >= 7 && validDO && DOLength <= 10)) {
            if ((evt.isControlDown() && evt.getKeyCode() == KeyEvent.VK_V) || (evt.isShiftDown() && evt.getKeyCode() == KeyEvent.VK_INSERT)) {
                validDO = false;
                txtNDONum.setForeground(Color.red);
            } else {
                txtNDONum.setForeground(Color.black);
            }
        } else {
            validDO = false;
            txtNDONum.setForeground(Color.red);
        }

        if (DOLength == 0) {
            validDO = true;
            setRbtEnabled(true);
            txtNMaterial.setEditable(true);
            txtNWeight.setEditable(true);
        } else {
            txtNMaterial.setEditable(false);
            txtNWeight.setEditable(false);
        }

        if (validDO) {
            setSaveNeeded(isValidated());
        }
    }//GEN-LAST:event_txtNDONumKeyReleased

    private void txtNPlateNoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtNPlateNoActionPerformed
        setSaveNeeded(isValidated());
    }//GEN-LAST:event_txtNPlateNoActionPerformed

    private void txtNDriverNameActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtNDriverNameActionPerformed
        setSaveNeeded(isValidated());
    }//GEN-LAST:event_txtNDriverNameActionPerformed

    private void txtNCMNDBLActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtNCMNDBLActionPerformed
        setSaveNeeded(isValidated());
    }//GEN-LAST:event_txtNCMNDBLActionPerformed

    private void txtNMaterialActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtNMaterialActionPerformed
        setSaveNeeded(isValidated());
    }//GEN-LAST:event_txtNMaterialActionPerformed

    private void txtNWeightActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtNWeightActionPerformed
        setSaveNeeded(isValidated());
    }//GEN-LAST:event_txtNWeightActionPerformed

    private void txtNDONumActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtNDONumActionPerformed
        setSaveNeeded(isValidated());
    }//GEN-LAST:event_txtNDONumActionPerformed

    private void txtNTrailerPlateActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtNTrailerPlateActionPerformed
    }//GEN-LAST:event_txtNTrailerPlateActionPerformed

    private void cbxHourToItemStateChanged(java.awt.event.ItemEvent evt) {//GEN-FIRST:event_cbxHourToItemStateChanged
        if (cbxHourTo.getSelectedIndex() < cbxHourFrom.getSelectedIndex()) {
            cbxHourTo.setSelectedIndex(cbxHourFrom.getSelectedIndex());
        }
    }//GEN-LAST:event_cbxHourToItemStateChanged

    private void cbxNMaterialActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cbxNMaterialActionPerformed
        txtNMaterial.setText(cbxNMaterial.getSelectedItem().toString());
        setSaveNeeded(isValidated());
    }//GEN-LAST:event_cbxNMaterialActionPerformed

    private void cbxNMaterialItemStateChanged(java.awt.event.ItemEvent evt) {//GEN-FIRST:event_cbxNMaterialItemStateChanged
        txtNMaterial.setText(cbxNMaterial.getSelectedItem().toString());
        setSaveNeeded(isValidated());
    }//GEN-LAST:event_cbxNMaterialItemStateChanged

    private void cbxNMaterialKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_cbxNMaterialKeyReleased
        txtNMaterial.setText(cbxNMaterial.getSelectedItem().toString());
        setSaveNeeded(isValidated());
    }//GEN-LAST:event_cbxNMaterialKeyReleased

    private void btnManyActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnManyActionPerformed
        String soDO = JOptionPane.showInputDialog(this.getRootPane(), resourceMapMsg.getString("msg.inputDO"));
        boolean isNumber = true;
        if (StringUtil.isNotEmptyString(soDO)) {
            soDO = soDO.trim();
            for (int i = 0; i < soDO.length(); i++) {
                if (!Character.isDigit(soDO.charAt(i))) {
                    isNumber = false;
                    break;
                }
            }

            if (isNumber && StringUtil.hasLengthInRange(soDO, 8, 10)) {
                if (txtNDONum.getText().equals("")) {
                    txtNDONum.setText(StringUtil.paddingZero(soDO, 10));
                } else {
                    String inputDO = (soDO.length() == 8) ? StringUtil.paddingZero(soDO, 8) : StringUtil.paddingZero(soDO, 10);
                    if (!StringUtil.contains(txtNDONum.getText(), inputDO)) {
                        txtNDONum.setText(txtNDONum.getText() + "-" + inputDO);
                    } else {
                        JOptionPane.showMessageDialog(this.getRootPane(), resourceMapMsg.getString("msg.duplicateDo"));
                    }
                }
            } else {
                JOptionPane.showMessageDialog(this.getRootPane(), resourceMapMsg.getString("msg.falseDo"));
                txtNDONum.setText("");
            }

        }
    }//GEN-LAST:event_btnManyActionPerformed

    private void btnCheckDOActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnCheckDOActionPerformed
        setSaveNeeded(isValidated());
        flag_check = true;
    }//GEN-LAST:event_btnCheckDOActionPerformed


    private void btnSaveActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnSaveActionPerformed
    }//GEN-LAST:event_btnSaveActionPerformed

    private void dpDateFromActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_dpDateFromActionPerformed
    }//GEN-LAST:event_dpDateFromActionPerformed

    private void txtNPlateNoFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtNPlateNoFocusLost
        setSaveNeeded(isValidated());
    }//GEN-LAST:event_txtNPlateNoFocusLost

    private void txtNDriverNameFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtNDriverNameFocusLost
        setSaveNeeded(isValidated());
    }//GEN-LAST:event_txtNDriverNameFocusLost

    private void txtNCMNDBLFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtNCMNDBLFocusLost
        setSaveNeeded(isValidated());
    }//GEN-LAST:event_txtNCMNDBLFocusLost

    private void btnSoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnSoActionPerformed
        String soSO = JOptionPane.showInputDialog(this.getRootPane(), resourceMapMsg.getString("msg.inputSO"));
        boolean isNumber = false;
        if (soSO == null) {
            isNumber = false;
        } else if (soSO != null || !soSO.equals("")) {
            soSO = soSO.trim();
            for (int i = 0; i < soSO.length(); i++) {
                if (!Character.isDigit(soSO.charAt(i))) {
                    isNumber = false;
                } else {
                    isNumber = true;
                }
            }
            if (isNumber && soSO.length() >= 8 && soSO.length() <= 10) {
                if (txtNDONum.getText().equals("")) {
                    txtNDONum.setText(StringUtil.paddingZero(soSO, 10));

                } else {
                    String inputDO = (soSO.length() == 8) ? StringUtil.paddingZero(soSO, 8) : StringUtil.paddingZero(soSO, 10);
                    // String inputDO2 = StringUtil.paddingZero(soDO, 8);
                    if (txtNDONum.getText().indexOf(inputDO) == -1) {
                        txtNDONum.setText(txtNDONum.getText() + "-" + inputDO);
                    } else {
                        JOptionPane.showMessageDialog(this.getRootPane(), resourceMapMsg.getString("msg.duplicateDo"));
                    }
                }
            } else {
                JOptionPane.showMessageDialog(this.getRootPane(), resourceMapMsg.getString("msg.falseDo"));
                txtNDONum.setText("");
            }

        }
    }//GEN-LAST:event_btnSoActionPerformed

    private DefaultComboBoxModel getMatsModel() {
        return weightTicketRegistarationController.getMatsModel();
    }

    @Action(block = Task.BlockingScope.ACTION)
    public Task listWeightTickets() {

        return new ListWeightTicketsTask(WeighBridgeApp.getApplication());
    }

    @Action(block = Task.BlockingScope.ACTION)
    public Task reprintRecord() {
        if (tabResults.getSelectedRow() == -1) {
            return null;
        } else {
            return new ReprintRecordTask(WeighBridgeApp.getApplication());
        }
    }

    @Action(block = Task.BlockingScope.ACTION)
    public Task printReport() {
        if (tabResults.getModel().getRowCount() == 0) {
            return null;

        } else {
            return new PrintReportTask(org.jdesktop.application.Application.getInstance(com.gcs.wb.WeighBridgeApp.class));
        }
    }

    @Action(block = Task.BlockingScope.ACTION)
    public Task checkDO() {
        txtNPlateNo.setText(txtNPlateNo.getText().trim().toUpperCase());
        txtNDriverName.setText(txtNDriverName.getText().trim().toUpperCase());
        txtNCMNDBL.setText(txtNCMNDBL.getText().trim().toUpperCase());

        if (WeighBridgeApp.getApplication().isOfflineMode()) {
            return new CheckDOOFFTask(WeighBridgeApp.getApplication());
        } else {
            String val[] = txtNDONum.getText().trim().split("-");
            for (int i = 0; i < val.length; i++) {
                if (val[i].length() > 0) {
                    val[i] = StringUtil.paddingZero(val[i], 10);
                    return new CheckDOTask(WeighBridgeApp.getApplication());
                } else if (val[i].length() == 0) {
                    lblNDONum.setForeground(Color.black);
                    validDO = true;
                    setSaveNeeded(isValidated() && validDO);
                    return null;
                } else {
                    lblNDONum.setForeground(Color.red);
                    validDO = false;
                    setSaveNeeded(isValidated() && validDO);
                }
                continue;
            }
            return null;
        }
    }

    @Action(enabledProperty = "creatable")
    public void newRecord() {
        setFormEditable(true);
        setRbtEnabled(true);
        setCreatable(false);
        setClearable(true);
        setSaveNeeded(isValidated());
        txtWeightTicketNo.setText("");
        txtNMaterial.setEditable(true);
        cbxNMaterial.setEditable(true);
        txtNWeight.setEditable(true);
        btnMany.setEnabled(true);
        btnSo.setEnabled(true);
        btnCheckDO.setEnabled(true);
        btnSave.setEnabled(false);
    }

    @Action(enabledProperty = "clearable")
    public void clearForm() {
        cleanData();
        setCreatable(true);
        setFormEditable(false);
        setRbtEnabled(false);
        setSaveNeeded(false);
        setClearable(false);
        btnMany.setEnabled(false);
        btnSo.setEnabled(false);
        btnCheckDO.setEnabled(false);
        sVendor = "";
        sPO = "";
        dKldk = 0;

    }

    @Action(enabledProperty = "saveNeeded")
    public Task saveRecord() {
        btnMany.setEnabled(false);
        btnSo.setEnabled(false);
        btnCheckDO.setEnabled(false);
        btnSave.setEnabled(false);

        if (!(isValidated() && validDO)) {
            return null;
        }
        int answer = JOptionPane.YES_OPTION;
        if (StringUtil.isEmptyString(txtNDONum.getText())) {
            answer = JOptionPane.showConfirmDialog(
                    this.getRootPane(),
                    resourceMapMsg.getString("msg.questtionSaveDO"),
                    JOptionPane.OPTIONS_PROPERTY,
                    JOptionPane.YES_NO_OPTION,
                    JOptionPane.QUESTION_MESSAGE);
        }

        if (answer == JOptionPane.YES_OPTION) {
            btnSave.setEnabled(false);
            return new SaveWeightTicketTask(WeighBridgeApp.getApplication());

        } else {
            btnMany.setEnabled(true);
            btnSo.setEnabled(true);
            btnCheckDO.setEnabled(true);
            btnSave.setEnabled(true);
            return null;
        }
    }
    // </editor-fold>
    // <editor-fold defaultstate="collapsed" desc="Task Classes">

    private class ListWeightTicketsTask extends org.jdesktop.application.Task<Object, Void> {

        ListWeightTicketsTask(org.jdesktop.application.Application app) {
            super(app);
        }

        private List<WeightTicket> getWeightTicketWithOtherType(String from, String to) throws Exception {
            List<WeightTicket> data = null;
            if (cbxStatus.getSelectedIndex() == StatusEnum.POSTED.VALUE) {
                data = weightTicketRegistarationController.findByDatePostedNull(from, to, txtCreator.getText().trim(), txtDriverName.getText().trim(), txtPlateNo.getText().trim());
            } else if (cbxStatus.getSelectedIndex() == StatusEnum.ALL.VALUE) {
                data = weightTicketRegistarationController.findByDateAllNull(from, to, txtCreator.getText().trim(), txtDriverName.getText().trim(), txtPlateNo.getText().trim());
            }

            return filterHours(data, cbxHourFrom.getSelectedItem().toString(), cbxHourTo.getSelectedItem().toString());
        }

        private List<WeightTicket> getWeightTicketWithAllType(String from, String to) throws Exception {
            List<WeightTicket> data = null;
            if (cbxStatus.getSelectedIndex() == StatusEnum.POSTED.VALUE) {
                data = weightTicketRegistarationController.findByDatePostedNullAll(from, to, txtCreator.getText().trim(), txtDriverName.getText().trim(), txtPlateNo.getText().trim());
            } else if (cbxStatus.getSelectedIndex() == StatusEnum.ALL.VALUE) {
                data = weightTicketRegistarationController.findByDateAllNullAll(from, to, txtCreator.getText().trim(), txtDriverName.getText().trim(), txtPlateNo.getText().trim());
            }

            return filterHours(data, cbxHourFrom.getSelectedItem().toString(), cbxHourTo.getSelectedItem().toString());
        }

        private List<WeightTicket> getWeightTicketWithSelectedType(String from, String to, String matnr) throws Exception {
            List<WeightTicket> data = null;
            if (cbxStatus.getSelectedIndex() == StatusEnum.POSTED.VALUE) {
                data = weightTicketRegistarationController.findByDatePosted(from, to, txtCreator.getText().trim(), txtDriverName.getText().trim(), matnr, txtPlateNo.getText().trim());
            } else if (cbxStatus.getSelectedIndex() == StatusEnum.ALL.VALUE) {
                data = weightTicketRegistarationController.findByDateAll(from, to, txtCreator.getText().trim(), txtDriverName.getText().trim(), matnr, txtPlateNo.getText().trim());
            }

            return filterHours(data, cbxHourFrom.getSelectedItem().toString(), cbxHourTo.getSelectedItem().toString());
        }

        private void setWeightTicketData() {
            for (int i = 0; i < weightTicketList.size(); i++) {
                WeightTicket item = weightTicketList.get(i);
                WeightTicketDetail weightTicketDetail = item.getWeightTicketDetail();
                wtData[i][0] = item.getSeqDay();
                wtData[i][1] = item.getDriverName();
                wtData[i][2] = item.getDriverIdNo();
                wtData[i][3] = item.getPlateNo();
                wtData[i][4] = item.getTrailerId();
                wtData[i][5] = item.getRegType();
                wtData[i][6] = weightTicketDetail.getRegItemDescription();
                wtData[i][7] = weightTicketDetail.getRegItemQuantity();
                wtData[i][8] = weightTicketDetail.getDeliveryOrderNo();
                wtData[i][9] = item.getCreator();
                wtData[i][10] = item.getSeqMonth();

                SimpleDateFormat dateFormat = new SimpleDateFormat("dd/MM/yyyy");
                wtData[i][11] = dateFormat.format(item.getCreatedDate());
                String time = item.getCreatedTime().replaceAll(":", "");
                String hh = time.substring(0, 2);
                String mm = time.substring(2, 4);
                String ss = time.substring(4, 6);
                wtData[i][12] = hh + ":" + mm + ":" + ss;
                if (item.isPosted()) {
                    wtData[i][13] = true;
                } else {
                    wtData[i][13] = false;
                }
            }
        }

        @SuppressWarnings("unchecked")
        @Override
        protected Object doInBackground() {
            try {
                setProgress(0, 0, 4);
                weightTicketList.clear();

                setProgress(1, 0, 4);
                setMessage(resourceMapMsg.getString("msg.getData"));

                Object[] select = cbxMaterialType.getSelectedObjects();
                com.gcs.wb.jpa.entity.Material material = (com.gcs.wb.jpa.entity.Material) select[0];
                SimpleDateFormat format = new SimpleDateFormat("yyyy-MM-dd");
                String fFrom = format.format(dpDateFrom.getDate());
                String fTo = format.format(dpDateTo.getDate());
                List<WeightTicket> result;

                if (material.getMatnr().equals(MaterialEnum.OTHER.VALUE)) {
                    result = getWeightTicketWithOtherType(fFrom, fTo);
                } else if (material.getMatnr().equals(MaterialEnum.ALL.VALUE)) {
                    result = getWeightTicketWithAllType(fFrom, fTo);
                } else {
                    result = getWeightTicketWithSelectedType(fFrom, fTo, material.getMatnr());
                }

                setProgress(2, 0, 4);
                setMessage(resourceMapMsg.getString("msg.handleDate"));
                weightTicketList.addAll(result);
                wtData = new Object[weightTicketList.size()][wtCols.length];

                setWeightTicketData();

                setProgress(3, 0, 4);
                editable = new boolean[wtCols.length];
                for (int i = 0; i < editable.length; i++) {
                    editable[i] = false;
                }
                setProgress(4, 0, 4);
            } catch (Exception ex) {
                failed(ex);
            }
            return null;
        }

        @Override
        protected void succeeded(Object result) {
        }

        @Override
        protected void finished() {
            setMessage(resourceMapMsg.getString("msg.finished"));
            WeighBridgeApp.getApplication().bindJTableModel(tabResults, wtData, wtCols, wtTypes, editable);

            setCreatable(true);
            setFormEditable(false);
            setClearable(false);
            setSaveNeeded(false);
            clearForm();
        }

        @Override
        protected void failed(Throwable cause) {
            logger.error(null, cause);
            JOptionPane.showMessageDialog(rootPane, cause.getMessage());
        }
    }

    private class ReprintRecordTask extends org.jdesktop.application.Task<Object, Void> {

        ReprintRecordTask(org.jdesktop.application.Application app) {
            super(app);
        }

        @Override
        protected Object doInBackground() {
            selectedRow = weightTicketList.get(tabResults.convertRowIndexToModel(tabResults.getSelectedRow()));
            if (selectedRow != null) {
                try {
                    if (!selectedRow.isDissolved()) {
                        setMessage(resourceMapMsg.getString("msg.rePrinting"));
                        txtWeightTicketNo.setText(selectedRow.getId() + "");
                        StringSelection stringSelection = new StringSelection(txtWeightTicketNo.getText());
                        Clipboard clipboard = Toolkit.getDefaultToolkit().getSystemClipboard();
                        clipboard.setContents(stringSelection, null);
                        printWT(selectedRow, true);
                    } else {
                        setMessage(resourceMapMsg.getString("msg.ticketDestroy"));
                    }
                } catch (Exception ex) {
                    failed(ex);
                }
            }
            return null;
        }

        @Override
        protected void failed(Throwable cause) {
            JOptionPane.showMessageDialog(rootPane, cause);
        }

        @Override
        protected void succeeded(Object result) {
        }

        @Override
        protected void finished() {
            setMessage(resourceMapMsg.getString("msg.finished"));
        }
    }

    private class PrintReportTask extends org.jdesktop.application.Task<Object, Void> {

        PrintReportTask(org.jdesktop.application.Application app) {
            super(app);
        }

        @Override
        protected Object doInBackground() {
            try {
                SimpleDateFormat format = new SimpleDateFormat("yyyy-MM-dd");
                String kFrom = format.format(dpDateFrom.getDate());
                String kTo = format.format(dpDateTo.getDate());
                Map<String, Object> params = weightTicketRegistarationController.getPrintReport(kFrom, kTo);
                String reportName = weightTicketRegistarationController.getReportName();
                weightTicketRegistarationController.printReport(params, reportName);
            } catch (Exception ex) {
                failed(ex);
            }
            return null;
        }

        @Override
        protected void failed(Throwable cause) {
            logger.error(null, cause);
            JOptionPane.showMessageDialog(rootPane, cause.getMessage());
        }
    }

    private class CheckDOTask extends org.jdesktop.application.Task<Object, Void> {
        private OutboundDelivery outb = null;
        private String mode = null;
        private Customer kunnr = null;
        private Customer kunag = null;
        private Vendor lifnr = null;
        private Customer sapKunnr = null;
        private Customer sapKunag = null;
        private Vendor sapLifnr = null;
        private String ship_point = null;

        CheckDOTask(org.jdesktop.application.Application app) {
            super(app);
            outbDel = null;
        }

        @Override
        protected Object doInBackground() throws Exception {
            String oldKunnr = "";
            String oldSoxe = "";
            String[] listDO = txtNDONum.getText().trim().split("-");
            for (int index = 0; index < listDO.length; index++) {
                setStep(1, resourceMapMsg.getString("msg.checkDOInDB"));
                listDO[index] = StringUtil.paddingZero(listDO[index], 10);
                outb = weightTicketRegistarationController.findByDeliveryOrderNumber(listDO[index]);

                setStep(2, resourceMapMsg.getString("checkDOInSap"));
                OutboundDelivery sapOutb = sapService.getOutboundDelivery(listDO[index]);
                if (sapOutb != null) {
                    fetchCustomerByKunnr(sapOutb);
                    fetchCustomerByKunag(sapOutb);
                    fetchVendor(sapOutb);
                }

                setStep(3, resourceMapMsg.getString("msg.saveDataToDb"));
                startTransaction();
                syncCustomerByKunnr();
                syncCustomerByKunag(sapOutb);
                syncVendor();
                syncOutboundDelivery(listDO[index], sapOutb);
                finishTransaction();

                oldKunnr = checkKunnr(oldKunnr);
                oldSoxe = checkPlate(oldSoxe);

                setMode();

                checkDOInUsed(listDO[index]);
                checkShippingPoint(listDO[index]);

                setMaterialNumber();

                updateWeightTicket();

                setStep(4, null);
                continue;
            }

            return null;
        }

        private void setMaterialNumber() {
            if (validDO && outb != null) {
                mat_numb = outb.getMatnr().trim();
            }
        }

        private void setStep(int step, String msg) {
            if (StringUtil.isNotEmptyString(msg)) {
                setMessage(msg);
            }
            setProgress(step, 1, 4);
        }

        private void updateWeightTicket() {
            if (validDO && outb != null) {
                WeightTicketDetail weightTicketDetail = newWeightTicket.getWeightTicketDetail();
                weightTicketDetail.setItem(outb.getDeliveryItem());
                weightTicketDetail.setMatnrRef(outb.getMatnr());
                weightTicketDetail.setRegItemDescription(outb.getArktx());
                weightTicketDetail.setUnit(outb.getVrkme());
                weightTicketDetail.setKunnr(outb.getKunnr());

                txtNMaterial.setText(outb.getArktx());
                cbxNMaterial.setSelectedItem(outb.getArktx());
                BigDecimal regqty = BigDecimal.ZERO;
                List<OutboundDeliveryDetail> detail = new ArrayList<>();
                OutboundDeliveryDetail item = null;
                String[] do_list = txtNDONum.getText().trim().split("-");
                for (int i = 0; i < do_list.length; i++) {
                    String doNum = do_list[i];
                    try {
                        detail = weightTicketRegistarationController.findByMandtDelivNumb(doNum);
                    } catch (Exception ex) {
                        java.util.logging.Logger.getLogger(WTRegView.class.getName()).log(Level.SEVERE, null, ex);
                    }
                    for (int j = 0; j < detail.size(); j++) {
                        item = detail.get(j);
                        regqty = regqty.add(item.getLfimg());
                        weightTicketDetail.setDeliveryOrderNo(doNum);
                    }
                }
                txtNWeight.setValue(regqty.doubleValue());
                outbDel = outb;
            }
        }

        private String getSelectedMode() {
            String selectedMode = "";
            if (rbtNInward.isSelected()) {
                selectedMode = Constants.WTRegView.INPUT;
            }

            if (rbtNOutward.isSelected()) {
                selectedMode = Constants.WTRegView.OUTPUT;
            }

            return selectedMode;
        }

        private void handleUnselectedMode(String selectedMode) {
            if (StringUtil.isEmptyString(selectedMode)) {
                String msg = resourceMapMsg.getString("msg.plzChooseIO");
                setMessage(msg);
                JOptionPane.showMessageDialog(rootPane, msg);
            }
        }

        private void handleDOCheckExist(String doNumber) {
            boolean isInUsedDO = false;
            isInUsedDO = weightTicketRegistarationController.checkExistDO(doNumber);
            if (isInUsedDO) {
                validDO = false;
                outb = null;
                String msg = resourceMapMsg.getString("msg.checkExistDO", doNumber);
                setMessage(msg);
                JOptionPane.showMessageDialog(rootPane, msg);
            }

        }

        private void handleShippingPointVar(String doNumber, String selectedMode) {
            if (outb != null) {
                int klmax = weightTicketRegistarationController.shippingPointVar(ship_point, outb.getMatnr().toString().trim());
                Boolean ship = (klmax <= 0) ? false : true;
                if (ship == false) {
                    validDO = false;
                    outb = null;
                    String msg = resourceMapMsg.getString("msg.shippingPointVar", doNumber, selectedMode);
                    setMessage(msg);
                    JOptionPane.showMessageDialog(rootPane, msg);
                }
            }
        }

        private void checkShippingPoint(String doNumber) {
            if (validDO && outb != null) {
                ship_point = outb.getShipPoint();
                String selectedMode = getSelectedMode();
                handleUnselectedMode(selectedMode);
                handleDOCheckExist(doNumber);
                // TODO uncomment for Shipping Point Handling if new req.
                //handleShippingPointVar(doNumber, selectedMode);
            }
        }

        private void checkDOInUsed(String doNumber) {
            if (validDO && outb != null) {
                WeightTicket wt = null;
                String delivNumb = outb.getDeliveryOrderNo();
                wt = weightTicketRegistarationController.findByDeliveryOrderNo(delivNumb);
                String wplant = "";
                wplant = WeighBridgeApp.getApplication().getConfig().getwPlant();
                String sDoType = Constants.WTRegView.DO_TYPES;
                String Lfart = "";
                try {
                    Lfart = outb.getLfart();

                } catch (Exception ex) {
                }

                if ((sDoType.indexOf(Lfart) >= 0 && outb.getWbstk() == 'X' && outb.getWerks().toString().equalsIgnoreCase(wplant))
                        || (wt != null && !wt.isDissolved())) {
                    validDO = false;
                    outb = null;
                    String msg = resourceMapMsg.getString("msg.typeDO", doNumber, mode);
                    setMessage(msg);
                    JOptionPane.showMessageDialog(rootPane, msg);
                } else {
                    flag_revert = true;
                    outb_number = outb.getDeliveryOrderNo().toString().trim();
                }
            }
        }

        private void setMode() {
            if (validDO && outb != null) {
                if (outb.getLfart().equalsIgnoreCase("LF") || outb.getLfart().equalsIgnoreCase("ZTLF")) {
                    mode = Constants.WTRegView.OUTPUT_LOWCASE;
                } else {
                    mode = Constants.WTRegView.INPUT_LOWCASE;
                }
            }
        }

        private String checkPlate(String oldSoxe) {
            if (outb != null
                    && !oldSoxe.equals("")
                    && !oldSoxe.equals(outb.getTraid())) {
                validDO = false;
                String msg = resourceMapMsg.getString("msg.notDuplicateLicensePlate");
                setMessage(msg);
                JOptionPane.showMessageDialog(rootPane, msg);
            } else if (outb != null) {
                oldSoxe = outb.getTraid();
            }
            return oldSoxe;
        }

        private String checkKunnr(String oldKunnr) {
            if (outb != null
                    && !oldKunnr.equals("")
                    && !oldKunnr.equals(outb.getKunnr())) {
                validDO = false;
                String msg = resourceMapMsg.getString("msg.notDuplicateCode");
                setMessage(msg);
                JOptionPane.showMessageDialog(rootPane, msg);
            } else if (outb != null) {
                oldKunnr = outb.getKunnr();
            }
            return oldKunnr;
        }

        private void syncOutboundDelivery(String val, OutboundDelivery sapOutb) {
            if (sapOutb != null && outb == null) {
                entityManager.persist(sapOutb);
                outb = sapOutb;
                validDO = true;
            } else if (sapOutb != null && outb != null) {
                sapOutb.setId(outb.getId());
                entityManager.merge(sapOutb);
                outb = sapOutb;
                validDO = true;
            } else {
                if (outb != null) {
                    entityManager.remove(outb);
                    outb = null;
                }
                validDO = false;
                String msg = resourceMapMsg.getString("msg.dONotExitst", val);
                setMessage(msg);
                JOptionPane.showMessageDialog(rootPane, msg);
            }
        }

        private void finishTransaction() {
            if (entityTransaction.isActive()) {
                entityTransaction.commit();
                entityManager.clear();
            }
        }

        private void startTransaction() {
            entityTransaction = entityManager.getTransaction();
            if (!entityTransaction.isActive()) {
                entityTransaction.begin();
            }
        }

        private void syncVendor() {
            if (sapLifnr != null && lifnr == null) {
                entityManager.persist(sapLifnr);
            } else if (sapLifnr != null && lifnr != null) {
                sapLifnr.setId(lifnr.getId());
                entityManager.merge(sapLifnr);
            } else if (sapLifnr == null && lifnr != null) {
                entityManager.remove(lifnr);
            }
        }

        private void syncCustomerByKunag(OutboundDelivery sapOutb) {
            if (sapKunag != null && kunag == null && !sapOutb.getKunnr().equalsIgnoreCase(sapOutb.getKunag())) {
                entityManager.persist(sapKunag);
            } else if (sapKunag != null && kunag != null) {
                sapKunag.setId(kunag.getId());
                entityManager.merge(sapKunag);
            } else if (sapKunag == null && kunag != null && !sapOutb.getKunnr().equalsIgnoreCase(sapOutb.getKunag())) {
                entityManager.remove(kunag);
            }
        }

        private void syncCustomerByKunnr() {
            if (sapKunnr != null && kunnr == null) {
                entityManager.persist(sapKunnr);
            } else if (sapKunnr != null && kunnr != null) {
                sapKunnr.setId(kunnr.getId());
                entityManager.merge(sapKunnr);
            } else if (sapKunnr == null && kunnr != null) {
                entityManager.remove(kunnr);
            }
        }

        private void fetchVendor(OutboundDelivery sapOutb) {
            if (StringUtil.isNotEmptyString(sapOutb.getLifnr())) {
                lifnr = weightTicketRegistarationController.findByLifnr(sapOutb.getLifnr());
                sapLifnr = sapService.getVendor(sapOutb.getLifnr());
            }
        }

        private void fetchCustomerByKunag(OutboundDelivery sapOutb) {
            if (StringUtil.isNotEmptyString(sapOutb.getKunag())) {
                kunag = weightTicketRegistarationController.findByKunnr(sapOutb.getKunag());
                sapKunag = sapService.getCustomer(sapOutb.getKunag());
            }
        }

        private void fetchCustomerByKunnr(OutboundDelivery sapOutb) {
            if (StringUtil.isNotEmptyString(sapOutb.getKunnr())) {
                kunnr = weightTicketRegistarationController.findByKunnr(sapOutb.getKunnr());
                sapKunnr = sapService.getCustomer(sapOutb.getKunnr());
            }
        }

        @Override
        protected void failed(Throwable cause) {
            validDO = false;
            if (cause instanceof HibersapException && cause.getCause() instanceof JCoException) {
                cause = cause.getCause();
            }
            logger.error(null, cause);
            JOptionPane.showMessageDialog(rootPane, cause.getMessage());

            if (entityTransaction.isActive()) {
                entityTransaction.rollback();
            }
        }

        @Override
        protected void finished() {
        }
    }

    private class CheckDOOFFTask extends org.jdesktop.application.Task<Object, Void> {

        private OutboundDelivery outb = null;
        private String mode = null;
        private String ship_point = null;

        CheckDOOFFTask(org.jdesktop.application.Application app) {
            super(app);
            outbDel = null;
        }

        private void setStep(int step, String msg) {
            if (StringUtil.isNotEmptyString(msg)) {
                setMessage(msg);
            }
            setProgress(step, 1, 4);
        }

        private String checkKunnr(String oldKunnr) {
            //Check kunnr
            if (outb != null
                    && !oldKunnr.equals("")
                    && !oldKunnr.equals(outb.getKunnr())) {
                validDO = false;
                String msg = resourceMapMsg.getString("msg.notDuplicateCode");
                setMessage(msg);
                JOptionPane.showMessageDialog(rootPane, msg);
            } else if (outb != null) {
                oldKunnr = outb.getKunnr();
            }

            return oldKunnr;
        }

        private String checkPlate(String oldSoxe) {
            if (outb != null
                    && !oldSoxe.equals("")
                    && !oldSoxe.equals(outb.getTraid())) {
                validDO = false;
                String msg = resourceMapMsg.getString("msg.notDuplicateLicensePlate");
                setMessage(msg);
                JOptionPane.showMessageDialog(rootPane, msg);
            } else if (outb != null) {
                oldSoxe = outb.getTraid();
            }

            return oldSoxe;
        }

        private void setMode() {
            if (validDO && outb != null) {
                if (outb.getLfart().equalsIgnoreCase("LF") || outb.getLfart().equalsIgnoreCase("ZTLF")) {
                    mode = Constants.WTRegView.OUTPUT_LOWCASE;
                } else {
                    mode = Constants.WTRegView.INPUT_LOWCASE;
                }
            }
        }

        private void checkDOInUsed(String doNumber) {
            if (validDO && outb != null) {
                WeightTicket wt = null;
                String delivNumb = outb.getDeliveryOrderNo();
                wt = weightTicketRegistarationController.findByDeliveryOrderNo(delivNumb);

                if (wt != null && !wt.isDissolved()) {
                    validDO = false;
                    outb = null;
                    String msg = resourceMapMsg.getString("msg.typeDO", doNumber, mode);
                    setMessage(msg);
                    JOptionPane.showMessageDialog(rootPane, msg);
                } else {
                    flag_revert = true;
                    outb_number = outb.getDeliveryOrderNo().trim();
                }
            }
        }

        private String getSelectedMode() {
            String selectedMode = "";
            if (rbtNInward.isSelected()) {
                selectedMode = Constants.WTRegView.INPUT;
            }

            if (rbtNOutward.isSelected()) {
                selectedMode = Constants.WTRegView.OUTPUT;
            }

            return selectedMode;
        }

        private void handleUnselectedMode(String selectedMode) {
            if (StringUtil.isEmptyString(selectedMode)) {
                String msg = resourceMapMsg.getString("msg.plzChooseIO");
                setMessage(msg);
                JOptionPane.showMessageDialog(rootPane, msg);
            }
        }

        private void handleDOCheckExist(String doNumber) {
            boolean isInUsedDO = false;
            isInUsedDO = weightTicketRegistarationController.checkExistDO(doNumber);

            if (isInUsedDO) {
                validDO = false;
                outb = null;
                String msg = resourceMapMsg.getString("msg.checkExistDO", doNumber);
                setMessage(msg);
                JOptionPane.showMessageDialog(rootPane, msg);
            }

        }

        private void handleShippingPointVar(String doNumber, String selectedMode) {
            if (outb != null) {
                int klmax = weightTicketRegistarationController.shippingPointVar(ship_point, outb.getMatnr().toString().trim());
                Boolean ship = (klmax <= 0) ? false : true;
                if (ship == false) {
                    validDO = false;
                    outb = null;
                    String msg = resourceMapMsg.getString("msg.shippingPointVar", doNumber, selectedMode);
                    setMessage(msg);
                    JOptionPane.showMessageDialog(rootPane, msg);
                }
            }
        }

        private void checkShippingPoint(String doNumber) {
            if (validDO && outb != null) {
                ship_point = outb.getShipPoint();
                String selectedMode = getSelectedMode();
                handleUnselectedMode(selectedMode);
                handleDOCheckExist(doNumber);
                // TODO uncomment for Shipping Point Handling if new req.
                //handleShippingPointVar(doNumber, selectedMode);
            }
        }

        private void setMaterialNumber() {
            if (validDO && outb != null) {
                mat_numb = outb.getMatnr().trim();
            }
        }

        private void updateWeightTicket() {
            if (validDO && outb != null) {
                WeightTicketDetail weightTicketDetail = newWeightTicket.getWeightTicketDetail();
                weightTicketDetail.setItem(outb.getDeliveryItem());
                weightTicketDetail.setMatnrRef(outb.getMatnr());
                weightTicketDetail.setRegItemDescription(outb.getArktx());
                weightTicketDetail.setUnit(outb.getVrkme());
                weightTicketDetail.setKunnr(outb.getKunnr());
                txtNMaterial.setText(outb.getArktx());
                cbxNMaterial.setSelectedItem(outb.getArktx());
                BigDecimal regqty = BigDecimal.ZERO;
                List<OutboundDeliveryDetail> detail = new ArrayList<>();
                OutboundDeliveryDetail item = null;
                String[] do_list = txtNDONum.getText().trim().split("-");
                for (int i = 0; i < do_list.length; i++) {
                    String doNum = do_list[i];
                    try {
                        detail = weightTicketRegistarationController.findByMandtDelivNumb(doNum);
                    } catch (Exception ex) {
                        java.util.logging.Logger.getLogger(WTRegView.class.getName()).log(Level.SEVERE, null, ex);
                    }
                    for (int j = 0; j < detail.size(); j++) {
                        item = detail.get(j);
                        regqty = regqty.add(item.getLfimg());
                    }
                }
                txtNWeight.setValue(regqty.doubleValue());
                outbDel = outb;
            }
        }

        private void checkValidDO(String doNumber) {
            if (outb != null) {
                validDO = true;
            } else {
                validDO = false;
                String msg = resourceMapMsg.getString("msg.dONotExitst", doNumber);
                setMessage(msg);
                JOptionPane.showMessageDialog(rootPane, msg);
            }
        }

        @Override
        protected Object doInBackground() {
            String oldKunnr = "";
            String oldSoxe = "";
            String[] listDO = txtNDONum.getText().trim().split("-");
            for (int index = 0; index < listDO.length; index++) {
                setStep(1, resourceMapMsg.getString("msg.checkDOInDB"));
                listDO[index] = StringUtil.paddingZero(listDO[index], 10);

                outb = weightTicketRegistarationController.findByDeliveryOrderNumber(listDO[index]);

                checkValidDO(listDO[index]);

                oldKunnr = checkKunnr(oldKunnr);
                oldSoxe = checkPlate(oldSoxe);

                setMode();

                checkDOInUsed(listDO[index]);

                checkShippingPoint(listDO[index]);

                setMaterialNumber();

                updateWeightTicket();

                setProgress(4, 1, 4);
                continue;
            }

            return null;
        }

        @Override
        protected void failed(Throwable cause) {
            validDO = false;
            if (cause instanceof HibersapException && cause.getCause() instanceof JCoException) {
                cause = cause.getCause();
            }
            logger.error(null, cause);
            JOptionPane.showMessageDialog(rootPane, cause.getMessage());
        }

        @Override
        protected void finished() {
        }
    }

    private class SaveWeightTicketTask extends org.jdesktop.application.Task<Object, Void> {

        SaveWeightTicketTask(org.jdesktop.application.Application app) {
            super(app);
            setSaveNeeded(false);
            setClearable(false);
        }

        @Override
        protected Object doInBackground() {
            Date now = weightTicketRegistarationController.getServerDate();

            if (now == null) {
                now = Calendar.getInstance().getTime();

            }
            SimpleDateFormat formatter = new SimpleDateFormat();
            AppConfig sap = WeighBridgeApp.getApplication().getConfig();
            int seqBDay = weightTicketRegistarationController.getNewSeqBDay() + 1;
            int seqBMonth = weightTicketRegistarationController.getNewSeqBMonth() + 1;

            formatter.applyPattern("yyyy");

            int year = Integer.parseInt(formatter.format(now));
            WeightTicketDetail weightTicketDetail = newWeightTicket.getWeightTicketDetail();
            newWeightTicket.setMandt(sap.getsClient());
            newWeightTicket.setWplant(sap.getwPlant());
            newWeightTicket.setSeqDay(seqBDay);
            newWeightTicket.setSeqMonth(seqBMonth);
            newWeightTicket.setCreatedDate(new java.sql.Date(now.getTime()));
            formatter.applyPattern("HH:mm:ss");
            newWeightTicket.setCreatedTime(formatter.format(now));
            newWeightTicket.setCreator(WeighBridgeApp.getApplication().getLogin().getUid());
            newWeightTicket.setOfflineMode(WeighBridgeApp.getApplication().isOfflineMode());
            newWeightTicket.setRegType(rbtNInward.isSelected() ? 'I' : 'O');
            weightTicketDetail.setRegItemDescription(txtNMaterial.getText().trim());
            weightTicketDetail.setRegItemQuantity(BigDecimal.valueOf(Double.valueOf(txtNWeight.getValue().toString())));
            newWeightTicket.setWbId(sap.getWbId());
            newWeightTicket.setAbbr(abbr);
            newWeightTicket.setPlateNo(txtNPlateNo.getText().trim());
            newWeightTicket.setDriverIdNo(txtNCMNDBL.getText().trim());
            newWeightTicket.setDriverName(txtNDriverName.getText().trim());
            weightTicketDetail.setDocYear(year);
            newWeightTicket.setPosted(false);
            newWeightTicket.setTrailerId(txtNTrailerPlate.getText().trim());
            if (weightTicketDetail.getDeliveryOrderNo() != null && weightTicketDetail.getDeliveryOrderNo().trim().isEmpty()) {
                weightTicketDetail.setDeliveryOrderNo(null);
                weightTicketDetail.setItem(null);
                weightTicketDetail.setMatnrRef(null);
                weightTicketDetail.setRegItemDescription(txtNMaterial.getText().trim());
                weightTicketDetail.setUnit(null);
            }
            weightTicketDetail.setKunnr(null);
            if (weightTicketDetail.getDeliveryOrderNo() != null && !weightTicketDetail.getDeliveryOrderNo().trim().isEmpty()) {
                String val = weightTicketDetail.getDeliveryOrderNo().trim();
                val = StringUtil.paddingZero(val, 10);
                weightTicketDetail.setDeliveryOrderNo(val);
                if (outbDel != null) {
                    weightTicketDetail.setKunnr(outbDel.getKunnr());
                }
            }
            List<OutboundDeliveryDetail> detail = new ArrayList<>();
            OutboundDeliveryDetail item = null;
            if (WeighBridgeApp.getApplication().isOfflineMode() && !txtNDONum.getText().equals("")) {
                weightTicketDetail.setDeliveryOrderNo(txtNDONum.getText());
            } else if (!WeighBridgeApp.getApplication().isOfflineMode()) {
                if (!txtNDONum.getText().equals("")) {
                    String[] do_list = txtNDONum.getText().trim().split("-");
                    for (int i = 0; i < do_list.length; i++) {
                        String doNum = do_list[i];
                        try {
                            detail = weightTicketRegistarationController.findByMandtDelivNumb(doNum);
                        } catch (Exception ex) {
                            java.util.logging.Logger.getLogger(WTRegView.class.getName()).log(Level.SEVERE, null, ex);
                        }
                        for (int j = 0; j < detail.size(); j++) {
                            item = detail.get(j);
                            String zero = "0";
                            String n = String.valueOf(seqBDay);
                            while (n.length() < 3) {
                                n = zero.concat(n);
                            }
                            //item.setWtId(id + n);
                            if (!entityTransaction.isActive()) {
                                entityTransaction.begin();
                            }
                            entityManager.merge(item);
                            entityTransaction.commit();
                            entityManager.clear();
                        }
                    }
                }
            }
            if (!WeighBridgeApp.getApplication().getConfig().getModeNormal()) {
                newWeightTicket.setCreator(WeighBridgeApp.getApplication().getCurrent_user());
            }
            setMessage(resourceMapMsg.getString("msg.saveData"));
            try {
                if (!entityTransaction.isActive()) {
                    entityTransaction.begin();
                }
                entityManager.persist(newWeightTicket);
                entityTransaction.commit();
                entityManager.clear();
            } catch (Exception ex) {
                if (entityTransaction.isActive()) {
                    entityTransaction.rollback();
                }
                throw ex;
            }

            try {
                setMessage(resourceMapMsg.getString("msg.printing"));
                txtWeightTicketNo.setText(newWeightTicket.getId() + "");
                printWT(newWeightTicket, false);
                StringSelection stringSelection = new StringSelection(txtWeightTicketNo.getText());
                Clipboard clipboard = Toolkit.getDefaultToolkit().getSystemClipboard();
                clipboard.setContents(stringSelection, null);
            } catch (Exception ex) {
                btnSave.setEnabled(true);
            }
            ListWeightTicketsTask t = new ListWeightTicketsTask(this.getApplication());
            t.execute();
            return null;
        }

        @Override
        protected void failed(Throwable cause) {
            if (entityTransaction.isActive()) {
                entityTransaction.rollback();
            }
            setSaveNeeded(true);
        }

        @Override
        protected void finished() {
            setMessage(resourceMapMsg.getString("msg.finished"));
            entityManager.clear();
            cleanData();
            setCreatable(true);
            setFormEditable(false);
            setRbtEnabled(false);
            setClearable(false);
            setSaveNeeded(false);
            if (flag_revert) {
                List<WeightTicket> wt = weightTicketRegistarationController.getListByDeliveryOrderNo(outb_number);
                WeightTicket item = null;
                for (int i = 0; i < wt.size() - 1; i++) {
                    item = wt.get(i);
                    item.setPosted(false);
                    if (!entityTransaction.isActive()) {
                        entityTransaction.begin();
                    }
                    entityManager.persist(item);
                    entityTransaction.commit();
                }
            }
            entityManager.clear();
        }
    }
// </editor-fold>
// <editor-fold defaultstate="collapsed" desc="Form's properties">
    private boolean creatable = false;

    public boolean isCreatable() {
        return creatable;
    }

    public void setCreatable(boolean b) {
        boolean old = isCreatable();
        this.creatable = b;
        firePropertyChange("creatable", old, isCreatable());
    }
    private boolean clearable = false;

    public boolean isClearable() {
        return clearable;
    }

    public void setClearable(boolean b) {
        boolean old = isClearable();
        this.clearable = b;
        firePropertyChange("clearable", old, isClearable());
    }
    private boolean saveNeeded = false;

    public boolean isSaveNeeded() {
        return saveNeeded;
    }

    public void setSaveNeeded(boolean b) {
        boolean old = isSaveNeeded();
        this.saveNeeded = b;
        firePropertyChange("saveNeeded", old, isSaveNeeded());
    }

    private boolean validateDriver() {
        boolean isValid = !(txtNDriverName.getText() == null || txtNDriverName.getText().trim().isEmpty());
        if (isValid) {
            lblNDriverName.setForeground(Color.black);
        } else {
            lblNDriverName.setForeground(Color.red);
        }

        return isValid;
    }

    private boolean validateDriverNoId() {
        boolean isValid = !(txtNCMNDBL.getText() == null || txtNCMNDBL.getText().trim().isEmpty() || txtNCMNDBL.getText().trim().length() > 9);
        if (isValid) {
            lblNCMNDBL.setForeground(Color.black);
        } else {
            lblNCMNDBL.setForeground(Color.red);
        }

        return isValid;
    }

    private boolean validatePlate() {
        boolean isValid = !(txtNPlateNo.getText().trim().isEmpty());
        if (isValid) {
            if (txtNDONum.getText().trim().isEmpty() || outbDel == null) {
                isValid = validateLicensePlate(null, null);
            } else {
                isValid = validateLicensePlate(outbDel.getLfart(), outbDel.getTraid());
            }
        }

        if (isValid && rbtNInward.isSelected()) {
            if (outbDel != null) {
                String soXe_tmp = txtNPlateNo.getText().trim();
                int indexRomooc = -1;
                if (outbDel.getTraid() != null && !outbDel.getTraid().equals("")) {
                    indexRomooc = outbDel.getTraid().indexOf("|");
                    if (indexRomooc >= 0) {
                        soXe_tmp = soXe_tmp.concat("|").concat(txtNTrailerPlate.getText().trim());
                    }
                }
                if (!soXe_tmp.equals(outbDel.getTraid().trim())) {
                    if (outbDel.getTraid() != null
                            && indexRomooc >= 0
                            && indexRomooc != (outbDel.getTraid().trim().length() - 1)
                            && txtNTrailerPlate.getText().trim().equals("")) {
                        JOptionPane.showMessageDialog(rootPane,
                                resourceMapMsg.getString("msg.plzInputRomoc"));
                    } else {
                        JOptionPane.showMessageDialog(rootPane,
                                resourceMapMsg.getString("msg.errorLicensePlate"));
                    }
                }

            }
        }

        if (isValid) {
            lblNPlateNo.setForeground(Color.black);
        } else {
            lblNPlateNo.setForeground(Color.red);
        }

        return isValid;
    }

    private boolean validateRegisteredCategory() {
        boolean isValid = rbtNInward.isSelected() || rbtNOutward.isSelected();
        if (isValid) {
            lblNRegCat.setForeground(Color.black);
        } else {
            lblNRegCat.setForeground(Color.red);
        }
        return isValid;
    }

    private boolean validateMaterial() {
        boolean isValid = !(txtNMaterial.getText() == null || txtNMaterial.getText().trim().isEmpty());
        if (isValid) {
            lblNMaterial.setForeground(Color.black);
        } else {
            lblNMaterial.setForeground(Color.red);
        }
        return isValid;
    }

    private boolean validateQuantity() {
        boolean isValid = !(txtNWeight.getText().isEmpty() || Double.parseDouble(txtNWeight.getText()) <= 0d);
        if (isValid) {
            lblNWeight.setForeground(Color.black);
        } else {
            lblNWeight.setForeground(Color.red);
        }

        return isValid;
    }

    public boolean isValidated() {
        boolean isValidDriverName = validateDriver();
        boolean isValidDriverNoId = validateDriverNoId();
        boolean isValidPlateNo = validatePlate();
        boolean isValidRegisteredCategory = validateRegisteredCategory();
        boolean isValidRegisteredMaterial = validateMaterial();
        boolean isValidRegisteredQuantity = validateQuantity();
        boolean result = isValidDriverName && isValidDriverNoId && isValidPlateNo && isValidRegisteredCategory && isValidRegisteredMaterial && isValidRegisteredQuantity;
        setFormValid(result);

        boolean isValid;
        if (StringUtil.isNotEmptyString(txtNDONum.getText())) {
            isValid = result && validDO && flag_check;
        } else {
            isValid = result && validDO;
        }
        return isValid;
    }

    private void printWT(WeightTicket wt, boolean reprint) throws Exception {
        try {
            weightTicketRegistarationController.printRegWT(wt, reprint);
        } catch (Exception ex) {
            logger.error(null, ex);
            throw ex;
        }
    }

    private boolean validateLicensePlate(String lfart, String traid) {
        boolean result = false;
        if (lfart != null && traid != null && (lfart.equalsIgnoreCase("ZTLF") || lfart.equalsIgnoreCase("NL"))) {
            String txt = traid;
            String doLicPlate;
            int idx1 = txt.indexOf("|");
            int idx2 = txt.indexOf("\\");
            if (idx1 >= 0 || idx2 >= 0) {
                int splitPos = idx1 < 0 ? idx2 : idx1;
                int bIdx = splitPos - 8;
                if (bIdx < 0) {
                    bIdx = 0;
                }
                doLicPlate = txt.substring(bIdx, splitPos);
                splitPos++;
            } else {
                int countSpace = 0;
                int[] pos = new int[3];
                char[] chars = txt.toCharArray();
                for (int x = 0; x < chars.length; x++) {
                    char c = chars[x];
                    if (c == ' ') {
                        pos[countSpace] = x;
                        countSpace++;
                    }
                }
                if (countSpace == 3) {
                    int splitPos = pos[1];
                    int bIdx = splitPos - 8;
                    if (bIdx < 0) {
                        bIdx = 0;
                    }
                    doLicPlate = txt.substring(bIdx, splitPos);
                    splitPos++;
                } else {
                    doLicPlate = traid;
                }
            }
            if (doLicPlate.equalsIgnoreCase(newWeightTicket.getPlateNo())) {
                result = true;
            } else {
                result = false;
                JOptionPane.showMessageDialog(rootPane, resourceMapMsg.getString("msg.errorLicensePlate", newWeightTicket.getPlateNo(), doLicPlate));
            }
        } else if (newWeightTicket != null) {
            Vehicle vehicle = weightTicketRegistarationController.findByPlateNo(txtNPlateNo.getText().trim());
            if (vehicle == null) {
                result = false;
                JOptionPane.showMessageDialog(rootPane, resourceMapMsg.getString("msg.errorLicensePlate", txtNPlateNo.getText().trim()));
            } else {
                result = true;
                if (vehicle.isProhibit()) {
                    result = false;
                    JOptionPane.showMessageDialog(rootPane, resourceMapMsg.getString("msg.errorLicensePlate", txtNPlateNo.getText().trim()));
                }

                List<TransportAgentVehicle> transportAgentVehicles = weightTicketRegistarationController.findByVehicleId(vehicle.getId());
                if (transportAgentVehicles != null && transportAgentVehicles.size() == 1) {
                    abbr = transportAgentVehicles.get(0).getTransportAgent().getAbbr();
                }
            }
        }
        return result;
    }

    private void cleanData() {
        newWeightTicket = new com.gcs.wb.jpa.entity.WeightTicket();
        outbDel = null;
        txtNDriverName.setText("");
        txtNCMNDBL.setText("");
        txtNPlateNo.setText("");
        txtNTrailerPlate.setText("");
        rbtRegCatGroup.clearSelection();
        rbtNInward.setEnabled(true);
        rbtNOutward.setEnabled(true);
        txtNMaterial.setText("");
        cbxNMaterial.setSelectedItem("");
        txtNWeight.setValue(null);
        txtNDONum.setText("");

        lblNDriverName.setForeground(Color.black);
        lblNCMNDBL.setForeground(Color.black);
        lblNPlateNo.setForeground(Color.black);
        lblNTrailerPlate.setForeground(Color.black);
        lblNRegCat.setForeground(Color.black);
        lblNMaterial.setForeground(Color.black);
        lblNWeight.setForeground(Color.black);
        lblNDONum.setForeground(Color.black);
        validDO = true;
    }

    private List<WeightTicket> filterHours(List<WeightTicket> data, String timeFrom, String timeTo) {
        List<WeightTicket> result = new ArrayList<>();
        int startTime = Integer.parseInt(timeFrom);
        double endTime = Integer.parseInt(timeTo) + 0.99;
        if (!data.isEmpty()) {
            for (int index = 0; index < data.size(); index++) {
                WeightTicket item = data.get(index);
                int createTime = Integer.parseInt(item.getCreatedTime().substring(0, 2));
                if (startTime <= createTime && createTime <= endTime)
                {
                    result.add(item);
                }
            }
        }
        
        return result;
    }
    // </editor-fold>
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnCheckDO;
    private javax.swing.JButton btnClear;
    private javax.swing.JButton btnFind;
    private javax.swing.JButton btnMany;
    private javax.swing.JButton btnNew;
    private javax.swing.JButton btnReprint;
    private javax.swing.JButton btnSave;
    private javax.swing.JButton btnSo;
    private javax.swing.ButtonGroup buttonGroup1;
    private javax.swing.JComboBox cbxHourFrom;
    private javax.swing.JComboBox cbxHourTo;
    private javax.swing.JComboBox cbxMaterialType;
    private javax.swing.JComboBox cbxNMaterial;
    private javax.swing.JComboBox cbxStatus;
    private org.jdesktop.swingx.JXDatePicker dpDateFrom;
    private org.jdesktop.swingx.JXDatePicker dpDateTo;
    private javax.swing.JTextField jTextField1;
    private javax.swing.JLabel lblCreator;
    private javax.swing.JLabel lblDateFrom;
    private javax.swing.JLabel lblDateTo;
    private javax.swing.JLabel lblDriverName;
    private javax.swing.JLabel lblHourFrom;
    private javax.swing.JLabel lblHourTo;
    private javax.swing.JLabel lblMaterialType;
    private javax.swing.JLabel lblNCMNDBL;
    private javax.swing.JLabel lblNDONum;
    private javax.swing.JLabel lblNDriverName;
    private javax.swing.JLabel lblNMaterial;
    private javax.swing.JLabel lblNPlateNo;
    private javax.swing.JLabel lblNRegCat;
    private javax.swing.JLabel lblNTrailerPlate;
    private javax.swing.JLabel lblNWeight;
    private javax.swing.JLabel lblNWeightUnit;
    private javax.swing.JLabel lblPlateNo;
    private javax.swing.JLabel lblStatus;
    private javax.swing.JLabel lblWeightTicketNo;
    private javax.swing.JPanel pnControl;
    private javax.swing.JPanel pnFilter;
    private javax.swing.JPanel pnNLeft;
    private javax.swing.JPanel pnNRight;
    private javax.swing.JPanel pnPrintControl;
    private javax.swing.JPanel pnWTicket;
    private javax.swing.JRadioButton rbtNInward;
    private javax.swing.JRadioButton rbtNOutward;
    private javax.swing.ButtonGroup rbtRegCatGroup;
    private javax.swing.JScrollPane spnResult;
    private org.jdesktop.swingx.JXTable tabResults;
    private javax.swing.JTextField txtCreator;
    private javax.swing.JTextField txtDriverName;
    private javax.swing.JTextField txtNCMNDBL;
    private javax.swing.JTextField txtNDONum;
    private javax.swing.JTextField txtNDriverName;
    private javax.swing.JTextField txtNMaterial;
    private javax.swing.JTextField txtNPlateNo;
    private javax.swing.JTextField txtNTrailerPlate;
    private javax.swing.JFormattedTextField txtNWeight;
    private javax.swing.JTextField txtPlateNo;
    private javax.swing.JTextField txtWeightTicketNo;
    private org.jdesktop.beansbinding.BindingGroup bindingGroup;
    // End of variables declaration//GEN-END:variables

    /**
     * Get the value of formValid
     *
     * @return the value of formValid
     */
    public boolean isFormValid() {
        return formValid;
    }

    /**
     * Set the value of formValid
     *
     * @param formValid new value of formValid
     */
    public void setFormValid(boolean formValid) {
        boolean oldFormValid = this.formValid;
        this.formValid = formValid;
        firePropertyChange(Constants.WTRegView.PROP_FORMVALID, oldFormValid, formValid);
    }
    private boolean formEditable;

    /**
     * Get the value of formEditable
     *
     * @return the value of formEditable
     */
    public boolean isFormEditable() {
        return formEditable;
    }

    /**
     * Set the value of formEditable
     *
     * @param formEditable new value of formEditable
     */
    public void setFormEditable(boolean formEditable) {
        boolean oldFormEditable = this.formEditable;
        this.formEditable = formEditable;
        firePropertyChange(Constants.WTRegView.PROP_FORMEDITABLE, oldFormEditable, formEditable);
    }
    private boolean rbtEnabled;

    /**
     * Get the value of rbtEnabled
     *
     * @return the value of rbtEnabled
     */
    public boolean isRbtEnabled() {
        return rbtEnabled;
    }

    /**
     * Set the value of rbtEnabled
     *
     * @param rbtEnabled new value of rbtEnabled
     */
    public void setRbtEnabled(boolean rbtEnabled) {
        boolean oldRbtEnabled = this.rbtEnabled;
        this.rbtEnabled = rbtEnabled;
        firePropertyChange(Constants.WTRegView.PROP_RBTENABLED, oldRbtEnabled, rbtEnabled);
    }
}
